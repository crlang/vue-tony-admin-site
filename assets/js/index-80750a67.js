var Q=Object.defineProperty,Z=Object.defineProperties;var x=Object.getOwnPropertyDescriptors;var P=Object.getOwnPropertySymbols;var ee=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable;var L=(e,o,a)=>o in e?Q(e,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[o]=a,U=(e,o)=>{for(var a in o||(o={}))ee.call(o,a)&&L(e,a,o[a]);if(P)for(var a of P(o))oe.call(o,a)&&L(e,a,o[a]);return e},Y=(e,o)=>Z(e,x(o));var V=(e,o,a)=>new Promise((m,p)=>{var f=n=>{try{r(a.next(n))}catch(i){p(i)}},v=n=>{try{r(a.throw(n))}catch(i){p(i)}},r=n=>n.done?m(n.value):Promise.resolve(n.value).then(f,v);r((a=a.apply(e,o)).next())});import{u as D,_ as O,I as X,e as _,i as te,f as ae,w as q}from"./index-c76c27a8.js";import{y as N,a as w,l as k,q as ne,an as le,u as re,z as E,A as M,I as se,J as ie,K as S,Y as B,L as b,w as G,b as H,Z as h,G as W,H as s,R as t,P as j,Q as F,O as A}from"./ex-pkg-@vue-6f720869.js";import{co as pe}from"./ex-pkg-vendor-ad21d406.js";import{u as ce}from"./ex-pkg-@vueuse-7c1f2694.js";import{d as de}from"./base64Conver-6d09fa87.js";import{ac as ue,ag as me,N as fe,u as J,_ as ve,an as ge}from"./ex-pkg-element-plus-387a9e67.js";const ye={aspectRatio:1,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,autoCrop:!0,background:!0,highlight:!0,center:!0,responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,scalable:!0,modal:!0,guides:!0,movable:!0,rotatable:!0},be=N({name:"CropperImage",props:{src:{type:String,required:!0},alt:{type:String},circled:{type:Boolean,default:!1},realTimePreview:{type:Boolean,default:!0},size:{type:Number,default:300},crossorigin:{type:String,default:void 0},imageStyle:{type:Object,default:()=>({})},options:{type:Object,default:()=>({})}},emits:["cropend","ready","cropendError"],setup(e,{attrs:o,emit:a}){const m=w(),p=w(),f=w(!1),{prefixCls:v}=D("cropper-image"),r=ce(C,80),n=k(()=>U({height:e.size,maxWidth:"100%"},e.imageStyle)),i=k(()=>[v,o.class,{[`${v}--circled`]:e.circled}]),I=k(()=>{const{size:u}=e;return{height:e.size+"px",width:u+"px"}});ne(T),le(()=>{var u;(u=p.value)==null||u.destroy()});function T(){return V(this,null,function*(){const u=re(m);!u||(p.value=new pe(u,U(Y(U({},ye),{ready:()=>{f.value=!0,C(),a("ready",p.value)},crop(){r()},zoom(){r()},cropmove(){r()}}),e.options)))})}function C(){e.realTimePreview&&y()}function y(){if(!p.value)return;const u=p.value.getData();(e.circled?g():p.value.getCroppedCanvas()).toBlob(l=>{if(!l)return;const c=new FileReader;c.readAsDataURL(l),c.onloadend=d=>{var z,R;a("cropend",{imgBase64:(R=(z=d.target)==null?void 0:z.result)!=null?R:"",imgInfo:u})},c.onerror=()=>{a("cropendError")}},"image/png")}function g(){const u=p.value.getCroppedCanvas(),$=document.createElement("canvas"),l=$.getContext("2d"),c=u.width,d=u.height;return $.width=c,$.height=d,l.imageSmoothingEnabled=!0,l.drawImage(u,0,0,c,d),l.globalCompositeOperation="destination-in",l.beginPath(),l.arc(c/2,d/2,Math.min(c,d)/2,0,2*Math.PI,!0),l.fill(),$}return{getClass:i,imgElRef:m,getWrapperStyle:I,getImageStyle:n,isReady:f,croppered:y}}}),Ce=["src","alt","crossorigin"];function he(e,o,a,m,p,f){return E(),M("div",{class:b(e.getClass),style:B(e.getWrapperStyle)},[se(S("img",{ref:"imgElRef",src:e.src,alt:e.alt,crossorigin:e.crossorigin,style:B(e.getImageStyle)},null,12,Ce),[[ie,e.isReady]])],6)}var K=O(be,[["render",he]]);const Se=N({name:"CropperModal",components:{ElDialog:ue,ElUpload:me,ElTooltip:fe,ElButton:J,ElAvatar:ve,ElSpace:ge,CropperImage:K,Icon:X},props:{circled:{type:Boolean,default:!0},uploadApi:{type:Function},uploadName:{type:String,default:"file"},visible:{type:Boolean,default:!1}},emits:["update:visible","fail","success"],setup(e,{emit:o}){let a="";const m=w(""),p=w(""),f=w();let v=1;const r=w(e.visible||!1);let n=1;const{prefixCls:i}=D("cropper-am"),{t:I}=_();G(()=>{r.value=e.visible||!1}),H(()=>r.value,l=>{o("update:visible",l)});function T(l){const c=new FileReader;return c.readAsDataURL(l),m.value="",p.value="",c.onload=function(d){var z,R;m.value=(R=(z=d.target)==null?void 0:z.result)!=null?R:"",a=l.name},!1}function C({imgBase64:l}){p.value=l}function y(l){f.value=l}function g(l,c){var d,z;l==="scaleX"&&(v=c=v===-1?1:-1),l==="scaleY"&&(n=c=n===-1?1:-1),(z=(d=f==null?void 0:f.value)==null?void 0:d[l])==null||z.call(d,c)}function u(){return V(this,null,function*(){const l=e.uploadApi;if(l&&te(l)){const c=de(p.value);try{const d=yield l({name:e.uploadName,file:c,filename:a});o("success",{source:p.value,data:d.data})}catch(d){console.error("Upload Fail",d)}$()}})}function $(){r.value=!1}return{prefixCls:i,src:m,previewSource:p,sourceVisible:r,t:I,handleBeforeUpload:T,handleCropend:C,handleReady:y,handlerToolbar:g,handleClose:$,handleOk:u}}}),we=["src","alt"],$e={class:"dialog-footer"};function ze(e,o,a,m,p,f){const v=h("CropperImage"),r=h("Icon"),n=h("ElButton"),i=h("ElTooltip"),I=h("ElUpload"),T=h("ElSpace"),C=h("ElAvatar"),y=h("ElDialog");return E(),W(y,{modelValue:e.sourceVisible,"onUpdate:modelValue":o[9]||(o[9]=g=>e.sourceVisible=g),title:e.t("component.cropper.modalTitle"),"destroy-on-close":"","show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:s(()=>[S("span",$e,[t(n,{onClick:o[7]||(o[7]=g=>e.handleClose())},{default:s(()=>[j(F(e.t("common.cancelText")),1)]),_:1}),t(n,{type:"primary",disabled:!e.previewSource,onClick:o[8]||(o[8]=g=>e.handleOk())},{default:s(()=>[j(F(e.t("component.cropper.confirmText")),1)]),_:1},8,["disabled"])])]),default:s(()=>[S("div",{class:b(e.prefixCls)},[S("div",{class:b(`${e.prefixCls}-left`)},[S("div",{class:b(`${e.prefixCls}-cropper`)},[e.src?(E(),W(v,{key:0,src:e.src,height:300,circled:e.circled,onCropend:e.handleCropend,onReady:e.handleReady},null,8,["src","circled","onCropend","onReady"])):A("",!0)],2),S("div",{class:b(`${e.prefixCls}-toolbar`)},[t(I,{"file-list":[],accept:"image/*",action:"blockit","before-upload":e.handleBeforeUpload},{default:s(()=>[t(i,{content:e.t("component.cropper.selectImage"),placement:"bottom"},{default:s(()=>[t(n,{type:"success"},{default:s(()=>[t(r,{icon:"ep:upload-filled"})]),_:1})]),_:1},8,["content"])]),_:1},8,["before-upload"]),t(T,null,{default:s(()=>[t(i,{content:e.t("component.cropper.btn_reset"),placement:"bottom"},{default:s(()=>[t(n,{type:"primary",size:"small",disabled:!e.src,onClick:o[0]||(o[0]=g=>e.handlerToolbar("reset"))},{default:s(()=>[t(r,{icon:"ep:refresh-right"})]),_:1},8,["disabled"])]),_:1},8,["content"]),t(i,{content:e.t("component.cropper.btn_rotate_left"),placement:"bottom"},{default:s(()=>[t(n,{type:"primary",size:"small",disabled:!e.src,onClick:o[1]||(o[1]=g=>e.handlerToolbar("rotate",-45))},{default:s(()=>[t(r,{icon:"ic:baseline-rotate-90-degrees-ccw"})]),_:1},8,["disabled"])]),_:1},8,["content"]),t(i,{content:e.t("component.cropper.btn_rotate_right"),placement:"bottom"},{default:s(()=>[t(n,{type:"primary",size:"small",disabled:!e.src,onClick:o[2]||(o[2]=g=>e.handlerToolbar("rotate",45))},{default:s(()=>[t(r,{icon:"ic:baseline-rotate-90-degrees-ccw"})]),_:1},8,["disabled"])]),_:1},8,["content"]),t(i,{content:e.t("component.cropper.btn_scale_x"),placement:"bottom"},{default:s(()=>[t(n,{type:"primary",size:"small",disabled:!e.src,onClick:o[3]||(o[3]=g=>e.handlerToolbar("scaleX"))},{default:s(()=>[t(r,{icon:"vaadin:arrows-long-h"})]),_:1},8,["disabled"])]),_:1},8,["content"]),t(i,{content:e.t("component.cropper.btn_scale_y"),placement:"bottom"},{default:s(()=>[t(n,{type:"primary",size:"small",disabled:!e.src,onClick:o[4]||(o[4]=g=>e.handlerToolbar("scaleY"))},{default:s(()=>[t(r,{icon:"vaadin:arrows-long-v"})]),_:1},8,["disabled"])]),_:1},8,["content"]),t(i,{content:e.t("component.cropper.btn_zoom_in"),placement:"bottom"},{default:s(()=>[t(n,{type:"primary",size:"small",disabled:!e.src,onClick:o[5]||(o[5]=g=>e.handlerToolbar("zoom",.1))},{default:s(()=>[t(r,{icon:"ep:zoom-in"})]),_:1},8,["disabled"])]),_:1},8,["content"]),t(i,{content:e.t("component.cropper.btn_zoom_out"),placement:"bottom"},{default:s(()=>[t(n,{type:"primary",size:"small",disabled:!e.src,onClick:o[6]||(o[6]=g=>e.handlerToolbar("zoom",-.1))},{default:s(()=>[t(r,{icon:"ep:zoom-out"})]),_:1},8,["disabled"])]),_:1},8,["content"])]),_:1})],2)],2),S("div",{class:b(`${e.prefixCls}-right`)},[S("div",{class:b(`${e.prefixCls}-preview`)},[e.previewSource?(E(),M("img",{key:0,src:e.previewSource,alt:e.t("component.cropper.preview")},null,8,we)):A("",!0)],2),e.previewSource?(E(),M("div",{key:0,class:b(`${e.prefixCls}-group`)},[t(C,{src:e.previewSource,size:64},null,8,["src"]),t(C,{src:e.previewSource,size:48},null,8,["src"]),t(C,{src:e.previewSource,size:72},null,8,["src"]),t(C,{src:e.previewSource,size:96},null,8,["src"])],2)):A("",!0)],2)],2)]),_:1},8,["modelValue","title"])}var ke=O(Se,[["render",ze]]);const Ee=N({name:"CropperAvatar",components:{ElButton:J,CopperModal:ke,Icon:X},props:{size:{type:Number,default:200},value:{type:String},showBtn:{type:Boolean,default:!0},btnType:{type:String,default:""},btnText:{type:String,default:""},uploadName:{type:String,default:"file"},uploadApi:{type:Function}},emits:["update:value","change"],setup(e,{emit:o}){const a=w(e.value||""),{prefixCls:m}=D("cropper-avatar"),p=w(!1),{createMessage:f}=ae(),{t:v}=_(),r=k(()=>[m]),n=k(()=>{const{size:y}=e;return y+"px"}),i=k(()=>parseInt(n.value)/2),I=k(()=>({width:n.value})),T=k(()=>({width:n.value,height:n.value}));G(()=>{a.value=e.value||""}),H(()=>a.value,y=>{o("update:value",y)});function C(y){a.value=y.source,o("change",y),f.success(v("component.cropper.uploadSuccess"))}return{t:v,prefixCls:m,openModal:p,getIconWidth:i,sourceValue:a,getClass:r,getImageWrapperStyle:T,getStyle:I,handleUploadSuccess:C}}}),Ie=["src"];function Te(e,o,a,m,p,f){const v=h("Icon"),r=h("ElButton"),n=h("CopperModal");return E(),M("div",{class:b(e.getClass),style:B(e.getStyle)},[S("div",{class:b(`${e.prefixCls}-image-wrapper`),style:B(e.getImageWrapperStyle),onClick:o[0]||(o[0]=i=>e.openModal=!0)},[S("div",{class:b(`${e.prefixCls}-image-mask`),style:B(e.getImageWrapperStyle)},[t(v,{icon:"ep:upload-filled",size:e.getIconWidth,style:B(e.getImageWrapperStyle),color:"#d6d6d6"},null,8,["size","style"])],6),e.sourceValue?(E(),M("img",{key:0,src:e.sourceValue,alt:"avatar"},null,8,Ie)):A("",!0)],6),e.showBtn?(E(),W(r,{key:0,class:b(`${e.prefixCls}-upload-btn`),onClick:o[1]||(o[1]=i=>e.openModal=!0),type:e.btnType},{default:s(()=>[j(F(e.btnText||e.t("component.cropper.selectImage")),1)]),_:1},8,["class","type"])):A("",!0),t(n,{visible:e.openModal,"onUpdate:visible":o[2]||(o[2]=i=>e.openModal=i),onSuccess:e.handleUploadSuccess,uploadApi:e.uploadApi},null,8,["visible","onSuccess","uploadApi"])],6)}var Be=O(Ee,[["render",Te]]);const Ne=q(K),We=q(Be);export{Ne as C,We as a};
