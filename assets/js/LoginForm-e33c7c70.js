var S=(x,o,r)=>new Promise((m,p)=>{var c=a=>{try{u(r.next(a))}catch(i){p(i)}},f=a=>{try{u(r.throw(a))}catch(i){p(i)}},u=a=>a.done?m(a.value):Promise.resolve(a.value).then(c,f);u((r=r.apply(x,o)).next())});import{y as h,a as g,_ as C,l as F,u as e,I as D,J as I,z as N,G as B,H as l,R as t,a9 as M,P as y,Q as w,ak as T}from"./ex-pkg-@vue-6f720869.js";import{e as U,f as z,h as G}from"./index-c76c27a8.js";import{u as K,a as P,L as E,b as $}from"./useLogin-727dd1de.js";import{C as j,D as k,z as V,F as O,u as _,y as A,G as H}from"./ex-pkg-element-plus-387a9e67.js";import"./ex-pkg-vendor-ad21d406.js";import"./ex-pkg-mockjs-d5ed3ada.js";import"./ex-pkg-@element-plus-8be47ecc.js";import"./ex-pkg-@vueuse-7c1f2694.js";import"./ex-pkg-@iconify-9ec765d0.js";import"./ex-pkg-@popperjs-d61e97fc.js";const te=h({setup(x){const{t:o}=U(),{notification:r}=z(),m=G(),{setLoginState:p,getLoginState:c}=K(),{getFormRules:f}=P(),u=g(),a=g(!1),i=g(!1),n=C({account:"",password:""}),{validForm:R}=$(u),L=F(()=>e(c)===E.LOGIN);function v(){return S(this,null,function*(){if(!!(yield R()))try{a.value=!0;const s=yield m.login(T({password:n.password,username:n.account,mode:"none"}));s&&r.success({title:o("sys.login.loginSuccessTitle"),message:`${o("sys.login.loginSuccessDesc")}: ${s.realName}`,duration:3e3})}catch(s){r.error({title:o("sys.api.errorTip"),message:s.message||o("sys.api.networkExceptionMsg")})}finally{a.value=!1}})}return(b,s)=>D((N(),B(e(H),{model:e(n),rules:e(f),ref_key:"formRef",ref:u},{default:l(()=>[t(e(k),{prop:"account"},{default:l(()=>[t(e(j),{modelValue:e(n).account,"onUpdate:modelValue":s[0]||(s[0]=d=>e(n).account=d),placeholder:e(o)("sys.login.userNameEg")},null,8,["modelValue","placeholder"])]),_:1}),t(e(k),{prop:"password",class:"mb-1"},{default:l(()=>[t(e(j),{modelValue:e(n).password,"onUpdate:modelValue":s[1]||(s[1]=d=>e(n).password=d),placeholder:e(o)("sys.login.passwordEg"),onKeypress:M(v,["enter"])},null,8,["modelValue","placeholder","onKeypress"])]),_:1}),t(e(A),{class:"mt-3"},{default:l(()=>[t(e(V),{span:12},{default:l(()=>[t(e(O),{modelValue:i.value,"onUpdate:modelValue":s[2]||(s[2]=d=>i.value=d),size:"small"},{default:l(()=>[y(w(e(o)("sys.login.rememberMe")),1)]),_:1},8,["modelValue"])]),_:1}),t(e(V),{span:12,class:"text-right"},{default:l(()=>[t(e(_),{type:"text",onClick:s[3]||(s[3]=d=>e(p)(e(E).RESET_PASSWORD))},{default:l(()=>[y(w(e(o)("sys.login.forgetPassword")),1)]),_:1})]),_:1})]),_:1}),t(e(k),null,{default:l(()=>[t(e(_),{type:"primary",class:"login--submit",loading:a.value,onClick:v},{default:l(()=>[y(w(e(o)("sys.login.loginButton")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])),[[I,e(L)]])}});export{te as default};
