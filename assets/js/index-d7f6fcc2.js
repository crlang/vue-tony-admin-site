var H=Object.defineProperty,J=Object.defineProperties;var Q=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,x=Object.prototype.propertyIsEnumerable;var _=(e,o,t)=>o in e?H(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t,R=(e,o)=>{for(var t in o||(o={}))Z.call(o,t)&&_(e,t,o[t]);if(j)for(var t of j(o))x.call(o,t)&&_(e,t,o[t]);return e},P=(e,o)=>J(e,Q(o));var M=(e,o,t)=>new Promise((f,u)=>{var v=s=>{try{l(t.next(s))}catch(r){u(r)}},y=s=>{try{l(t.throw(s))}catch(r){u(r)}},l=s=>s.done?f(s.value):Promise.resolve(s.value).then(v,y);l((t=t.apply(e,o)).next())});import{u as D,_ as U,I as L,i as ee,c as oe,w as Y}from"./index-26bedde3.js";import{y as V,a as w,l as E,q as ae,an as te,u as le,z as $,A,I as se,J as ne,K as S,Y as F,L as b,w as X,b as q,Z as h,G as O,H as n,R as a,O as T,P as W,Q as re}from"./ex-pkg-@vue-feb543c0.js";import{d4 as ie,cw as ue}from"./ex-pkg-vendor-bb3f8859.js";import{d as de}from"./base64Conver-6d09fa87.js";import{ad as pe,ah as ce,K as me,u as K,_ as fe,an as ve}from"./ex-pkg-element-plus-f609432a.js";const ge={aspectRatio:1,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,autoCrop:!0,background:!0,highlight:!0,center:!0,responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,scalable:!0,modal:!0,guides:!0,movable:!0,rotatable:!0},ye=V({name:"CropperImage",props:{src:{type:String,required:!0},alt:{type:String},circled:{type:Boolean,default:!1},realTimePreview:{type:Boolean,default:!0},size:{type:Number,default:300},crossorigin:{type:String,default:void 0},imageStyle:{type:Object,default:()=>({})},options:{type:Object,default:()=>({})}},emits:["cropend","ready","cropendError"],setup(e,{attrs:o,emit:t}){const f=w(),u=w(),v=w(!1),{prefixCls:y}=D("cropper-image"),l=ue(c,80),s=E(()=>R({height:e.size,maxWidth:"100%"},e.imageStyle)),r=E(()=>[y,o.class,{[`${y}--circled`]:e.circled}]),z=E(()=>{const{size:m}=e;return{height:e.size+"px",width:m+"px"}});ae(k),te(()=>{var m;(m=u.value)==null||m.destroy()});function k(){return M(this,null,function*(){const m=le(f);!m||(u.value=new ie(m,R(P(R({},ge),{ready:()=>{v.value=!0,c(),t("ready",u.value)},crop(){l()},zoom(){l()},cropmove(){l()}}),e.options)))})}function c(){e.realTimePreview&&B()}function B(){if(!u.value)return;const m=u.value.getData();(e.circled?g():u.value.getCroppedCanvas()).toBlob(p=>{if(!p)return;const d=new FileReader;d.readAsDataURL(p),d.onloadend=C=>{var I,N;t("cropend",{imgBase64:(N=(I=C.target)==null?void 0:I.result)!=null?N:"",imgInfo:m})},d.onerror=()=>{t("cropendError")}},"image/png")}function g(){const m=u.value.getCroppedCanvas(),i=document.createElement("canvas"),p=i.getContext("2d"),d=m.width,C=m.height;return i.width=d,i.height=C,p.imageSmoothingEnabled=!0,p.drawImage(m,0,0,d,C),p.globalCompositeOperation="destination-in",p.beginPath(),p.arc(d/2,C/2,Math.min(d,C)/2,0,2*Math.PI,!0),p.fill(),i}return{getClass:r,imgElRef:f,getWrapperStyle:z,getImageStyle:s,isReady:v,croppered:B}}}),Ce=["src","alt","crossorigin"];function be(e,o,t,f,u,v){return $(),A("div",{class:b(e.getClass),style:F(e.getWrapperStyle)},[se(S("img",{ref:"imgElRef",src:e.src,alt:e.alt,crossorigin:e.crossorigin,style:F(e.getImageStyle)},null,12,Ce),[[ne,e.isReady]])],6)}var G=U(ye,[["render",be]]);const he=V({name:"CropperModal",components:{ElDialog:pe,ElUpload:ce,ElTooltip:me,ElButton:K,ElAvatar:fe,ElSpace:ve,CropperImage:G,Icon:L},props:{circled:{type:Boolean,default:!0},uploadApi:{type:Function},uploadName:{type:String,default:"file"},visible:{type:Boolean,default:!1}},emits:["update:visible","fail","success"],setup(e,{emit:o}){let t="";const f=w(""),u=w(""),v=w();let y=1;const l=w(e.visible||!1);let s=1;const{prefixCls:r}=D("cropper-am");X(()=>{l.value=e.visible||!1}),q(()=>l.value,i=>{o("update:visible",i)});function z(i){const p=new FileReader;return p.readAsDataURL(i),f.value="",u.value="",p.onload=function(d){var C,I;f.value=(I=(C=d.target)==null?void 0:C.result)!=null?I:"",t=i.name},!1}function k({imgBase64:i}){u.value=i}function c(i){v.value=i}function B(i,p){var d,C;i==="scaleX"&&(y=p=y===-1?1:-1),i==="scaleY"&&(s=p=s===-1?1:-1),(C=(d=v==null?void 0:v.value)==null?void 0:d[i])==null||C.call(d,p)}function g(){return M(this,null,function*(){const i=e.uploadApi;if(i&&ee(i)){const p=de(u.value);try{const d=yield i({name:e.uploadName,file:p,filename:t});o("success",{source:u.value,data:d.data})}catch(d){console.error("Upload Fail",d)}m()}})}function m(){l.value=!1}return{prefixCls:r,src:f,previewSource:u,sourceVisible:l,handleBeforeUpload:z,handleCropend:k,handleReady:c,handlerToolbar:B,handleClose:m,handleOk:g}}}),Se=["src"],we={class:"dialog-footer"},Ee=W("\u53D6\u6D88"),$e=W("\u786E\u8BA4\u5E76\u4E0A\u4F20");function ze(e,o,t,f,u,v){const y=h("CropperImage"),l=h("Icon"),s=h("ElButton"),r=h("ElTooltip"),z=h("ElUpload"),k=h("ElSpace"),c=h("ElAvatar"),B=h("ElDialog");return $(),O(B,{modelValue:e.sourceVisible,"onUpdate:modelValue":o[9]||(o[9]=g=>e.sourceVisible=g),title:"\u5934\u50CF\u4E0A\u4F20","destroy-on-close":"","show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:n(()=>[S("span",we,[a(s,{onClick:o[7]||(o[7]=g=>e.handleClose())},{default:n(()=>[Ee]),_:1}),a(s,{type:"primary",disabled:!e.previewSource,onClick:o[8]||(o[8]=g=>e.handleOk())},{default:n(()=>[$e]),_:1},8,["disabled"])])]),default:n(()=>[S("div",{class:b(e.prefixCls)},[S("div",{class:b(`${e.prefixCls}-left`)},[S("div",{class:b(`${e.prefixCls}-cropper`)},[e.src?($(),O(y,{key:0,src:e.src,height:300,circled:e.circled,onCropend:e.handleCropend,onReady:e.handleReady},null,8,["src","circled","onCropend","onReady"])):T("",!0)],2),S("div",{class:b(`${e.prefixCls}-toolbar`)},[a(z,{"file-list":[],accept:"image/*",action:"blockit","before-upload":e.handleBeforeUpload},{default:n(()=>[a(r,{content:"selectImage",placement:"bottom"},{default:n(()=>[a(s,{type:"success"},{default:n(()=>[a(l,{icon:"ep:upload-filled"})]),_:1})]),_:1})]),_:1},8,["before-upload"]),a(k,null,{default:n(()=>[a(r,{content:"\u91CD\u7F6E",placement:"bottom"},{default:n(()=>[a(s,{type:"primary",size:"small",disabled:!e.src,onClick:o[0]||(o[0]=g=>e.handlerToolbar("reset"))},{default:n(()=>[a(l,{icon:"ep:refresh-right"})]),_:1},8,["disabled"])]),_:1}),a(r,{content:"\u9006\u65F6\u9488\u65CB\u8F6C",placement:"bottom"},{default:n(()=>[a(s,{type:"primary",size:"small",disabled:!e.src,onClick:o[1]||(o[1]=g=>e.handlerToolbar("rotate",-45))},{default:n(()=>[a(l,{icon:"ic:baseline-rotate-90-degrees-ccw"})]),_:1},8,["disabled"])]),_:1}),a(r,{content:"\u987A\u65F6\u9488\u65CB\u8F6C",placement:"bottom"},{default:n(()=>[a(s,{type:"primary",size:"small",disabled:!e.src,onClick:o[2]||(o[2]=g=>e.handlerToolbar("rotate",45))},{default:n(()=>[a(l,{icon:"ic:baseline-rotate-90-degrees-ccw"})]),_:1},8,["disabled"])]),_:1}),a(r,{content:"\u6C34\u5E73\u7FFB\u8F6C",placement:"bottom"},{default:n(()=>[a(s,{type:"primary",size:"small",disabled:!e.src,onClick:o[3]||(o[3]=g=>e.handlerToolbar("scaleX"))},{default:n(()=>[a(l,{icon:"vaadin:arrows-long-h"})]),_:1},8,["disabled"])]),_:1}),a(r,{content:"\u5782\u76F4\u7FFB\u8F6C",placement:"bottom"},{default:n(()=>[a(s,{type:"primary",size:"small",disabled:!e.src,onClick:o[4]||(o[4]=g=>e.handlerToolbar("scaleY"))},{default:n(()=>[a(l,{icon:"vaadin:arrows-long-v"})]),_:1},8,["disabled"])]),_:1}),a(r,{content:"\u653E\u5927",placement:"bottom"},{default:n(()=>[a(s,{type:"primary",size:"small",disabled:!e.src,onClick:o[5]||(o[5]=g=>e.handlerToolbar("zoom",.1))},{default:n(()=>[a(l,{icon:"ep:zoom-in"})]),_:1},8,["disabled"])]),_:1}),a(r,{content:"\u7F29\u5C0F",placement:"bottom"},{default:n(()=>[a(s,{type:"primary",size:"small",disabled:!e.src,onClick:o[6]||(o[6]=g=>e.handlerToolbar("zoom",-.1))},{default:n(()=>[a(l,{icon:"ep:zoom-out"})]),_:1},8,["disabled"])]),_:1})]),_:1})],2)],2),S("div",{class:b(`${e.prefixCls}-right`)},[S("div",{class:b(`${e.prefixCls}-preview`)},[e.previewSource?($(),A("img",{key:0,src:e.previewSource,alt:"\u9884\u89C8"},null,8,Se)):T("",!0)],2),e.previewSource?($(),A("div",{key:0,class:b(`${e.prefixCls}-group`)},[a(c,{src:e.previewSource,size:64},null,8,["src"]),a(c,{src:e.previewSource,size:48},null,8,["src"]),a(c,{src:e.previewSource,size:72},null,8,["src"]),a(c,{src:e.previewSource,size:96},null,8,["src"])],2)):T("",!0)],2)],2)]),_:1},8,["modelValue"])}var ke=U(he,[["render",ze]]);const Be=V({name:"CropperAvatar",components:{ElButton:K,CopperModal:ke,Icon:L},props:{size:{type:Number,default:200},value:{type:String},showBtn:{type:Boolean,default:!0},btnType:{type:String,default:""},btnText:{type:String,default:""},uploadName:{type:String,default:"file"},uploadApi:{type:Function}},emits:["update:value","change"],setup(e,{emit:o}){const t=w(e.value||""),{prefixCls:f}=D("cropper-avatar"),u=w(!1),{createMessage:v}=oe(),y=E(()=>[f]),l=E(()=>{const{size:c}=e;return c+"px"}),s=E(()=>parseInt(l.value)/2),r=E(()=>({width:l.value})),z=E(()=>({width:l.value,height:l.value}));X(()=>{t.value=e.value||""}),q(()=>t.value,c=>{o("update:value",c)});function k(c){t.value=c.source,o("change",c),v.success("\u4E0A\u4F20\u6210\u529F")}return{prefixCls:f,openModal:u,getIconWidth:s,sourceValue:t,getClass:y,getImageWrapperStyle:z,getStyle:r,handleUploadSuccess:k}}}),Fe=["src"];function Ie(e,o,t,f,u,v){const y=h("Icon"),l=h("ElButton"),s=h("CopperModal");return $(),A("div",{class:b(e.getClass),style:F(e.getStyle)},[S("div",{class:b(`${e.prefixCls}-image-wrapper`),style:F(e.getImageWrapperStyle),onClick:o[0]||(o[0]=r=>e.openModal=!0)},[S("div",{class:b(`${e.prefixCls}-image-mask`),style:F(e.getImageWrapperStyle)},[a(y,{icon:"ep:upload-filled",size:e.getIconWidth,style:F(e.getImageWrapperStyle),color:"#d6d6d6"},null,8,["size","style"])],6),e.sourceValue?($(),A("img",{key:0,src:e.sourceValue,alt:"avatar"},null,8,Fe)):T("",!0)],6),e.showBtn?($(),O(l,{key:0,class:b(`${e.prefixCls}-upload-btn`),onClick:o[1]||(o[1]=r=>e.openModal=!0),type:e.btnType},{default:n(()=>[W(re(e.btnText||"\u9009\u62E9\u56FE\u7247"),1)]),_:1},8,["class","type"])):T("",!0),a(s,{visible:e.openModal,"onUpdate:visible":o[2]||(o[2]=r=>e.openModal=r),onSuccess:e.handleUploadSuccess,uploadApi:e.uploadApi},null,8,["visible","onSuccess","uploadApi"])],6)}var Ae=U(Be,[["render",Ie]]);const Oe=Y(G),We=Y(Ae);export{Oe as C,We as a};
