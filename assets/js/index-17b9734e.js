var we=Object.defineProperty,Ue=Object.defineProperties;var Ce=Object.getOwnPropertyDescriptors;var Z=Object.getOwnPropertySymbols;var Se=Object.prototype.hasOwnProperty,Re=Object.prototype.propertyIsEnumerable;var J=(e,t,a)=>t in e?we(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,B=(e,t)=>{for(var a in t||(t={}))Se.call(t,a)&&J(e,a,t[a]);if(Z)for(var a of Z(t))Re.call(t,a)&&J(e,a,t[a]);return e},T=(e,t)=>Ue(e,Ce(t));var I=(e,t,a)=>new Promise((u,l)=>{var d=o=>{try{s(a.next(o))}catch(n){l(n)}},p=o=>{try{s(a.throw(o))}catch(n){l(n)}},s=o=>o.done?u(o.value):Promise.resolve(o.value).then(d,p);s((a=a.apply(e,t)).next())});import{e as $,_ as A,i as X,f as _e,an as Le,a8 as Y,I as Ee,w as Be}from"./index-c76c27a8.js";import{u as Pe,B as ee,a as te,b as ne}from"./index-b5118db3.js";import{l as _,u as R,y as M,Z as v,z as L,A as D,G as O,O as j,R as r,b as G,U as Ne,_ as ke,a as z,a7 as $e,H as C,P,Q as N,K as Me,D as H,F as oe}from"./ex-pkg-@vue-6f720869.js";import{p as le}from"./propTypes-7529eeb4.js";import{ad as Fe,ae as Te,af as W,u as F,a1 as ae,ag as Ie,ah as Ae,N as De}from"./ex-pkg-element-plus-387a9e67.js";import{d as Oe}from"./download-00b02bb0.js";import{V as je}from"./ex-pkg-@element-plus-8be47ecc.js";import{c2 as ze}from"./ex-pkg-vendor-ad21d406.js";const{t:K}=$();function Ve({acceptRef:e,helpTextRef:t,maxNumberRef:a,maxSizeRef:u}){const l=_(()=>{const s=R(e);return s&&s.length>0?s:[]}),d=_(()=>R(l).map(s=>s.indexOf("/")>0||s.startsWith(".")?s:`.${s}`).join(",")),p=_(()=>{const s=R(t);if(s)return s;const o=[],n=R(e);n.length>0&&o.push(K("component.upload.accept",[n.join(",")]));const m=R(u);m&&o.push(K("component.upload.maxSize",[m]));const g=R(a);return g&&g!==1/0&&o.push(K("component.upload.maxNumber",[g])),o.join("\uFF0C")});return{getAccept:l,getStringAccept:d,getHelpText:p}}var h;(function(e){e.SUCCESS="success",e.ERROR="error",e.UPLOADING="uploading"})(h||(h={}));const se={api:{type:Function,default:null,required:!0},helpText:{type:String,default:""},maxSize:{type:Number,default:2},maxNumber:{type:Number,default:1/0},accept:{type:Array,default:()=>[]},multiple:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},uploadParams:{type:Object,default:{}}},xe=T(B({},se),{modelValue:{type:Array,default:()=>[]},showPreviewNumber:{type:Boolean,default:!0},emptyHidePreview:{type:Boolean,default:!1}}),Ge={modelValue:{type:Array,default:()=>[]}},He={columns:{type:[Array],default:null},actionColumn:{type:Object,default:null},dataSource:{type:Array,default:null}};function We(e,t){const a=t.join("|");return new RegExp("\\.("+a+")$","i").test(e.name)}function Ke(e){return re(e.name)}function re(e){return/\.(jpg|jpeg|png|gif|webp|svg)$/i.test(e)}function qe(e){return new Promise((t,a)=>{const u=new FileReader;u.readAsDataURL(e),u.onload=()=>t({result:u.result,file:e}),u.onerror=l=>a(l)})}const Qe=M({components:{ElImage:Fe},props:{fileUrl:le.string.def(""),fileName:le.string.def("")}}),Ze={class:"thumb"};function Je(e,t,a,u,l,d){const p=v("ElImage");return L(),D("span",Ze,[e.fileUrl?(L(),O(p,{key:0,src:e.fileUrl,"preview-src-list":[e.fileUrl],width:104},null,8,["src","preview-src-list"])):j("",!0)])}var ue=A(Qe,[["render",Je]]);const{t:b}=$();function Xe(){return[{prop:"thumbUrl",label:b("component.upload.legend"),width:100,customRender:({record:e})=>{const{thumbUrl:t}=e||{};return t&&r(ue,{fileUrl:t},null)}},{prop:"name",label:b("component.upload.fileName"),align:"left",customRender:({text:e,record:t})=>{const{percent:a,status:u}=t||{};let l;return u===h.ERROR?l="exception":u===h.UPLOADING?l="":u===h.SUCCESS&&(l="success"),r("span",null,[r("p",{class:"truncate mb-1",title:e},[e]),r(Te,{percentage:a,"text-inside":!0,"stroke-width":24,status:l},null)])}},{prop:"size",label:b("component.upload.fileSize"),width:100,customRender:({text:e=0})=>e&&(e/1024).toFixed(2)+"KB"},{prop:"status",label:b("component.upload.fileStatue"),width:100,customRender:({text:e})=>e===h.SUCCESS?r(W,{type:"success"},{default:()=>b("component.upload.uploadSuccess")}):e===h.ERROR?r(W,{type:"danger"},{default:()=>b("component.upload.uploadError")}):e===h.UPLOADING?r(W,null,{default:()=>b("component.upload.uploading")}):e}]}function Ye(e){return{width:120,label:b("component.upload.operating"),prop:"action",fixed:!1,customRender:({record:t})=>r(F,{type:"danger",onClick:e.bind(null,t)},{default:()=>b("component.upload.del")})}}function et(){return[{prop:"url",label:b("component.upload.legend"),width:100,customRender:({record:e})=>{const{url:t}=e||{};return re(t)&&r(ue,{fileUrl:t},null)}},{prop:"name",label:b("component.upload.fileName"),align:"left"}]}function tt({handleRemove:e,handleDownload:t}){return{width:200,label:b("component.upload.operating"),prop:"action",fixed:!1,customRender:({record:a})=>r(ae,null,{default:()=>[r(F,{type:"danger",onClick:e.bind(null,a)},{default:()=>b("component.upload.del")}),r(F,{type:"success",onClick:t.bind(null,a)},{default:()=>b("component.upload.download")})]})}}const q=[];for(let e=0;e<=15;e++)q[e]=e.toString(16);function nt(){let e="";for(let t=1;t<=36;t++)t===9||t===14||t===19||t===24?e+="-":t===15?e+=4:t===20?e+=q[Math.random()*4|8]:e+=q[Math.random()*16|0];return e.replace(/-/g,"")}var ie=M({name:"FileList",props:He,setup(e){const t=Pe();return G(()=>e.dataSource,()=>{Ne(()=>{var a;(a=t==null?void 0:t.redoModalHeight)==null||a.call(t)})}),()=>{const{columns:a,actionColumn:u,dataSource:l}=e,d=[...a,u];return r("table",{class:"file-table"},[r("colgroup",null,[d.map(p=>{const{width:s=0,prop:o}=p,n={width:`${s}px`,minWidth:`${s}px`};return r("col",{style:s?n:{},key:o},null)})]),r("thead",null,[r("tr",{class:"file-table-tr"},[d.map(p=>{const{label:s="",align:o="center",prop:n}=p;return r("th",{class:["file-table-th",o],key:n},[s])})])]),r("tbody",null,[l.map((p={},s)=>r("tr",{class:"file-table-tr",key:`${s+p.name||""}`},[d.map(o=>{const{prop:n="",customRender:m,align:g="center"}=o,E=m&&X(m);return r("td",{class:["file-table-td",g],key:n},[E?m==null?void 0:m({text:p[n],record:p}):p[n]])})]))])])}}});const ot=M({components:{ElButton:F,ElUpload:Ie,ElAlert:Ae,BasicModal:ee,FileList:ie},props:T(B({},se),{previewFileList:{type:Array,default:()=>[]}}),emits:["change","register","delete"],setup(e,{emit:t}){const a=ke({fileList:[]}),u=z(!1),l=z([]),{accept:d,helpText:p,maxNumber:s,maxSize:o}=$e(e),{t:n}=$(),[m,{closeModal:g}]=te(),{getAccept:E,getStringAccept:V,getHelpText:x}=Ve({acceptRef:d,helpTextRef:p,maxNumberRef:s,maxSizeRef:o}),{createMessage:c}=_e(),pe=_(()=>l.value.length>0&&!l.value.every(i=>i.status===h.SUCCESS)),ce=_(()=>{const i=l.value.some(f=>f.status===h.SUCCESS);return{disabled:u.value||l.value.length===0||!i}}),de=_(()=>{const i=l.value.some(f=>f.status===h.ERROR);return u.value?n("component.upload.uploading"):n(i?"component.upload.reUploadFailed":"component.upload.startUpload")});function me(i){const{size:f,name:y}=i,{maxSize:U,maxNumber:S,previewFileList:w}=e,k=R(E);if(l.value.length+(w==null?void 0:w.length)>=S)return c.warning(n("component.upload.maxNumber",[S]));if(U&&i.size/1024/1024>=U)return c.error(n("component.upload.maxSizeMultiple",[U])),!1;if(k.length>0&&!We(i,k))return c.error(n("component.upload.acceptUpload",[k.join(",")])),!1;const Q={uuid:nt(),file:i,size:f,name:y,percent:0,type:y.split(".").pop()};return Ke(i)?qe(i).then(({result:ye})=>{l.value=[...R(l),B({thumbUrl:ye},Q)]}):l.value=[...R(l),Q],!1}function fe(i){const f=l.value.findIndex(y=>y.uuid===i.uuid);f!==-1&&l.value.splice(f,1),t("delete",i)}function ge(i){return I(this,null,function*(){var y;const{api:f}=e;if(!f||!X(f))return Le("upload api must exist and be a function");try{i.status=h.UPLOADING;const U=function(w){const k=w.loaded/w.total*100|0;i.percent=k},{data:S}=yield(y=e.api)==null?void 0:y.call(e,T(B({},e.uploadParams||{}),{file:i.file}),U);return i.status=h.SUCCESS,i.responseData=S,{success:!0,error:null}}catch(U){return i.status=h.ERROR,{success:!1,error:U}}})}function he(){return I(this,null,function*(){var f;const{maxNumber:i}=e;if(l.value.length+((f=e.previewFileList)==null?void 0:f.length)>i)return c.warning(n("component.upload.maxNumber",[i]));try{u.value=!0;const y=l.value.filter(w=>w.status!==h.SUCCESS)||[],U=yield Promise.all(y.map(w=>ge(w)));u.value=!1;const S=U.filter(w=>!w.success);if(S.length>0)throw S}catch(y){throw u.value=!1,y}})}function ve(){const{maxNumber:i}=e;if(l.value.length>i)return c.warning(n("component.upload.maxNumber",[i]));if(u.value)return c.warning(n("component.upload.saveWarn"));const f=[];for(const y of l.value){const{status:U,responseData:S}=y;U===h.SUCCESS&&S&&f.push(S.url)}if(f.length<=0)return c.warning(n("component.upload.saveError"));l.value=[],g(),t("change",f)}function be(){return I(this,null,function*(){return u.value?(c.warning(n("component.upload.uploadWait")),!1):(l.value=[],!0)})}return{columns:Xe(),actionColumn:Ye(fe),register:m,closeModal:g,getHelpText:x,getStringAccept:V,getOkButtonProps:ce,beforeUpload:me,fileListRef:l,state:a,isUploadingRef:u,handleStartUpload:he,handleOk:ve,handleCloseFunc:be,getIsSelectFile:pe,getUploadBtnText:de,t:n}}}),lt={class:"upload-modal-toolbar"};function at(e,t,a,u,l,d){const p=v("el-button"),s=v("ElAlert"),o=v("ElButton"),n=v("ElUpload"),m=v("FileList"),g=v("BasicModal");return L(),O(g,H({title:e.t("component.upload.upload"),okText:e.t("component.upload.save")},e.$attrs,{onRegister:e.register,onOk:e.handleOk,closeFunc:e.handleCloseFunc,maskClosable:!1,keyboard:!1,wrapClassName:"upload-modal",confirmButton:e.getOkButtonProps,cancelButton:{disabled:e.isUploadingRef}}),{centerFooter:C(()=>[r(p,{onClick:e.handleStartUpload,type:"success",disabled:!e.getIsSelectFile,loading:e.isUploadingRef},{default:C(()=>[P(N(e.getUploadBtnText),1)]),_:1},8,["onClick","disabled","loading"])]),default:C(()=>[Me("div",lt,[r(s,{title:e.getHelpText,type:"info",closable:!1,class:"upload-modal-toolbar__text"},null,8,["title"]),r(n,{action:"NotUrl",accept:e.getStringAccept,multiple:e.multiple,limit:e.maxNumber,disabled:e.isUploadingRef||e.fileListRef.length+e.previewFileList.length>=e.maxNumber,"show-file-list":!1,"before-upload":e.beforeUpload,class:"upload-modal-toolbar__btn"},{default:C(()=>[r(o,{type:"primary",disabled:e.isUploadingRef||e.fileListRef.length+e.previewFileList.length>=e.maxNumber},{default:C(()=>[P(N(e.t("component.upload.choose")),1)]),_:1},8,["disabled"])]),_:1},8,["accept","multiple","limit","disabled","before-upload"])]),r(m,{dataSource:e.fileListRef,columns:e.columns,actionColumn:e.actionColumn},null,8,["dataSource","columns","actionColumn"])]),_:1},16,["title","okText","onRegister","onOk","closeFunc","confirmButton","cancelButton"])}var st=A(ot,[["render",at]]);const rt=M({components:{BasicModal:ee,FileList:ie},props:Ge,emits:["list-change","register","delete"],setup(e,{emit:t}){const{t:a}=$(),[u,{closeModal:l}]=te(),d=z([]);G(()=>e.modelValue,o=>{Y(o)||(o=[]),d.value=o.filter(n=>!!n).map(n=>({url:n,type:n.split(".").pop()||"",name:n.split("/").pop()||""}))},{immediate:!0});function p(o){const n=d.value.findIndex(m=>m.url===o.url);if(n!==-1){const m=d.value.splice(n,1);t("delete",m[0].url),t("list-change",d.value.map(g=>g.url))}}function s(o){const{url:n}=o;Oe({url:n})}return{t:a,register:u,closeModal:l,fileListRef:d,columns:et(),actionColumn:tt({handleRemove:p,handleDownload:s})}}});function ut(e,t,a,u,l,d){const p=v("FileList"),s=v("BasicModal");return L(),O(s,H({width:800,title:e.t("component.upload.preview"),wrapClassName:"upload-preview-modal"},e.$attrs,{onRegister:e.register,showConfirm:!1}),{default:C(()=>[r(p,{dataSource:e.fileListRef,columns:e.columns,actionColumn:e.actionColumn},null,8,["dataSource","columns","actionColumn"])]),_:1},16,["title","onRegister"])}var it=A(rt,[["render",ut]]);const pt=M({name:"BasicUpload",components:{ElTooltip:De,ElButton:F,ElButtonGroup:ae,UploadModal:st,UploadPreviewModal:it,Icon:Ee},props:xe,emits:["change","delete","preview-delete","update:value"],setup(e,{emit:t,attrs:a}){const{t:u}=$(),[l,{openModal:d}]=ne(),[p,{openModal:s}]=ne(),o=z([]),n=_(()=>{const{emptyHidePreview:c}=e;return c&&c?o.value.length>0:!0}),m=_(()=>{const c=B(B({},a),e);return ze(c,"onChange","modelValue")});G(()=>e.modelValue,(c=[])=>{o.value=Y(c)?c:[]},{immediate:!0});function g(c){o.value=[...R(o),...c||[]],t("update:value",o.value),t("change",o.value)}function E(c){o.value=[...c||[]],t("update:value",o.value),t("change",o.value)}function V(c){t("delete",c)}function x(c){t("preview-delete",c)}return{registerUploadModal:l,openUploadModal:d,handleChange:g,handlePreviewChange:E,registerPreviewModal:p,openPreviewModal:s,UploadFilled:je,fileList:o,showPreview:n,bindValue:m,handleDelete:V,handlePreviewDelete:x,t:u}}}),ct=P();function dt(e,t,a,u,l,d){const p=v("ElButton"),s=v("Icon"),o=v("ElTooltip"),n=v("ElButtonGroup"),m=v("UploadModal"),g=v("UploadPreviewModal");return L(),D("div",null,[r(n,null,{default:C(()=>[r(p,{type:"primary",onClick:t[0]||(t[0]=E=>e.openUploadModal()),icon:e.UploadFilled},{default:C(()=>[P(N(e.t("component.upload.upload")),1)]),_:1},8,["icon"]),e.showPreview?(L(),O(o,{key:0,placement:"bottom"},{content:C(()=>[P(N(e.t("component.upload.uploaded"))+" ",1),e.fileList.length?(L(),D(oe,{key:0},[P(N(e.fileList.length),1)],64)):j("",!0)]),default:C(()=>[r(p,{onClick:t[1]||(t[1]=E=>e.openPreviewModal())},{default:C(()=>[r(s,{icon:"bi:eye",size:"12"}),ct,e.fileList.length&&e.showPreviewNumber?(L(),D(oe,{key:0},[P(N(e.fileList.length),1)],64)):j("",!0)]),_:1})]),_:1})):j("",!0)]),_:1}),r(m,H(e.bindValue,{previewFileList:e.fileList,onRegister:e.registerUploadModal,onChange:e.handleChange,onDelete:e.handleDelete}),null,16,["previewFileList","onRegister","onChange","onDelete"]),r(g,{value:e.fileList,onRegister:e.registerPreviewModal,onListChange:e.handlePreviewChange,onDelete:e.handlePreviewDelete},null,8,["value","onRegister","onListChange","onDelete"])])}var mt=A(pt,[["render",dt]]);const St=Be(mt);export{St as B,nt as b};
