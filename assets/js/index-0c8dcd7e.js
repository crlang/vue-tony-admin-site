var k=Object.defineProperty;var L=Object.getOwnPropertySymbols;var B=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var S=(e,n,t)=>n in e?k(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,R=(e,n)=>{for(var t in n||(n={}))B.call(n,t)&&S(e,t,n[t]);if(L)for(var t of L(n))D.call(n,t)&&S(e,t,n[t]);return e};var _=(e,n,t)=>new Promise((a,r)=>{var o=i=>{try{c(t.next(i))}catch(g){r(g)}},s=i=>{try{c(t.throw(i))}catch(g){r(g)}},c=i=>i.done?a(i.value):Promise.resolve(i.value).then(o,s);c((t=t.apply(e,n)).next())});import{j as M,_ as Q,w as W}from"./index-c76c27a8.js";import{t as j,a as O}from"./ex-pkg-qrcode-b648433a.js";import{c6 as P}from"./ex-pkg-vendor-ad21d406.js";import{d as U}from"./download-00b02bb0.js";import{y as $,a as z,q as H,b as q,u as h,z as E,A,G as X,M as Y}from"./ex-pkg-@vue-6f720869.js";const G=({canvas:e,content:n,width:t=0,options:a={}})=>{const r=P(a);return r.errorCorrectionLevel=r.errorCorrectionLevel||V(n),N(n,r).then(o=>(r.scale=t===0?void 0:t/o*4,j(e,n,r)))};function N(e,n){const t=document.createElement("canvas");return j(t,e,n).then(()=>t.width)}function V(e){return e.length>36?"M":e.length>16?"Q":"H"}const F=({canvas:e,logo:n})=>{if(!n)return new Promise(f=>{f(e.toDataURL())});const t=e.width,{logoSize:a=.15,bgColor:r="#ffffff",borderSize:o=.05,crossOrigin:s,borderRadius:c=8,logoRadius:i=0}=n,g=M(n)?n:n.src,d=t*a,l=t*(1-a)/2,m=t*(a+o),w=t*(1-a-o)/2,u=e.getContext("2d");if(!u)return;y(u)(w,w,m,m,c),u.fillStyle=r,u.fill();const p=new Image;(s||i)&&p.setAttribute("crossOrigin",s||"anonymous"),p.src=g;const I=f=>{u.drawImage(f,l,l,d,d)},T=f=>{const v=document.createElement("canvas");v.width=l+d,v.height=l+d;const C=v.getContext("2d");if(!C||!u||(C.drawImage(f,l,l,d,d),y(u)(l,l,d,d,i),!u))return;const b=u.createPattern(v,"no-repeat");b&&(u.fillStyle=b,u.fill())};return new Promise(f=>{p.onload=()=>{i?T(p):I(p);try{f(e.toDataURL())}catch(v){f(null)}}})};function y(e){return(n,t,a,r,o)=>{const s=Math.min(a,r);return o>s/2&&(o=s/2),e.beginPath(),e.moveTo(n+o,t),e.arcTo(n+a,t,n+a,t+r,o),e.arcTo(n+a,t+r,n,t+r,o),e.arcTo(n,t+r,n,t,o),e.arcTo(n,t,n+a,t,o),e.closePath(),e}}const J=e=>G(e).then(()=>e).then(F),K=$({name:"QrCode",props:{value:{type:String,default:null},options:{type:Object,default:null},width:{type:Number,default:200},logo:{type:[String,Object],default:""},tag:{type:String,default:"canvas",validator:e=>["canvas","img"].includes(e)}},emits:{done:e=>!!e,error:e=>!!e},setup(e,{emit:n}){const t=z(null);function a(){return _(this,null,function*(){try{const{tag:o,value:s,options:c={},width:i,logo:g}=e,d=String(s),l=h(t);if(!l)return;if(o==="canvas"){const m=yield J({canvas:l,width:i,logo:g,content:d,options:c||{}});n("done",{url:m,ctx:l.getContext("2d")});return}if(o==="img"){const m=yield O(d,R({errorCorrectionLevel:"H",width:i},c));h(t).src=m,n("done",{url:m})}}catch(o){n("error",o)}})}function r(o){let s="";const c=h(t);c instanceof HTMLCanvasElement?s=c.toDataURL():c instanceof HTMLImageElement&&(s=c.src),!!s&&U({url:s,fileName:o})}return H(a),q(e,()=>{a()},{deep:!0}),{wrapRef:t,download:r}}});function Z(e,n,t,a,r,o){return E(),A("div",null,[(E(),X(Y(e.tag),{ref:"wrapRef"},null,512))])}var x=Q(K,[["render",Z]]);const se=W(x);export{se as Q};
