var H=(n,t,p)=>new Promise((a,v)=>{var l=d=>{try{s(p.next(d))}catch(x){v(x)}},h=d=>{try{s(p.throw(d))}catch(x){v(x)}},s=d=>d.done?a(d.value):Promise.resolve(d.value).then(l,h);s((p=p.apply(n,t)).next())});import{y as U,z as $,A as y,K as c,R as f,u as e,Q as M,a as k,ab as X,x as Z,U as G,l as K,b as q,G as P,H as V,I as F,L as m,J as O,F as Y,a3 as ee,X as ne,O as te,T as se,a1 as oe,Z as L}from"./ex-pkg-@vue-6f720869.js";import{e as R,I as S,k as ae,aU as le,G as re,u as ie,_ as ce}from"./index-c76c27a8.js";import{g as ue,d as pe,C as de}from"./index-6f12a559.js";import{u as fe}from"./index-c26878d4.js";import{u as me,i as D}from"./ex-pkg-@vueuse-7c1f2694.js";import{c6 as he}from"./ex-pkg-vendor-ad21d406.js";import{C as ve,N as ge}from"./ex-pkg-element-plus-387a9e67.js";import{S as W}from"./ex-pkg-@element-plus-8be47ecc.js";import"./ex-pkg-@iconify-9ec765d0.js";import"./ex-pkg-mockjs-d5ed3ada.js";import"./ex-pkg-@popperjs-d61e97fc.js";import"./index-a4e3f2c2.js";import"./useWindowSizeFn-e2bb9137.js";import"./propTypes-7529eeb4.js";import"./useTimeout-a639f925.js";import"./index-b5c2dac5.js";import"./tsxHelper-6b2f4741.js";import"./lock-b8e33340.js";import"./index-5b1d7164.js";const xe=U({setup(n){const{t}=R();return(p,a)=>($(),y("div",null,[c("div",null,[c("span",null,[f(e(S),{icon:"uil:enter"})]),c("span",null,M(e(t)("component.app.toSearch")),1)]),c("div",null,[c("span",null,[f(e(S),{icon:"ion:arrow-up-outline"})]),c("span",null,[f(e(S),{icon:"ion:arrow-down-outline"})]),c("span",null,M(e(t)("component.app.toNavigate")),1)]),c("div",null,[c("span",null,[f(e(S),{icon:"mdi:keyboard-esc"})]),c("span",null,M(e(t)("common.closeText")),1)])]))}});function _e(){const n=k([]);return X(()=>{n.value=[]}),[n,p=>a=>{n.value[p]=a}]}function ke(n){return["$","(",")","*","+",".","[","]","?","\\","^","{","}","|"].includes(n)?`\\${n}`:n}function we(n){const t=[...n].map(a=>ke(a)),p=["",...t,""].join(".*");return new RegExp(p)}function $e(n,t,p){const a=k([]),v=k(""),l=k(-1);let h=[];const{t:s}=R(),d=ae(),x=me(N,200);Z(()=>H(this,null,function*(){const r=yield ue();h=he(r),le(h,i=>{i.name=s(i.name)})}));function N(r){if(v.value=r.trim(),!r){a.value=[];return}const i=we(e(v)),u=re(h,o=>i.test(o.name)&&!o.hideMenu);a.value=E(u,i),l.value=0}function E(r,i,u){const o=[];return r.forEach(g=>{const{name:_,path:w,icon:J,children:b,hideMenu:Q,meta:j}=g;!Q&&i.test(_)&&(!(b==null?void 0:b.length)||(j==null?void 0:j.hideChildrenInMenu))&&o.push({name:(u==null?void 0:u.name)?`${u.name} > ${_}`:_,path:w,icon:J}),!(j==null?void 0:j.hideChildrenInMenu)&&Array.isArray(b)&&b.length&&o.push(...E(b,i,g))}),o}function C(r){const i=r.target.dataset.index;l.value=Number(i)}function B(){!a.value.length||(l.value--,l.value<0&&(l.value=a.value.length-1),T())}function z(){!a.value.length||(l.value++,l.value>a.value.length-1&&(l.value=0),T())}function T(){const r=e(n);if(!r||!Array.isArray(r)||r.length===0||!e(t))return;const i=e(l),u=r[i];if(!u)return;const o=e(t);if(!o)return;const g=u.offsetTop+u.offsetHeight,_=o.offsetHeight,{start:w}=fe({el:o,duration:100,to:g-_});w()}function I(){return H(this,null,function*(){if(!a.value.length)return;const r=e(a),i=e(l);if(r.length===0||i<0)return;const u=r[i];A(),yield G(),d(u.path)})}function A(){a.value=[],p("close")}return D("Enter",I),D("ArrowUp",B),D("ArrowDown",z),D("Escape",A),{handleSearch:x,searchResult:a,keyword:v,activeIndex:l,handleMouseenter:C,handleEnter:I}}const be=["data-index"],je=U({props:{visible:{type:Boolean}},emits:["close"],setup(n,{emit:t}){const p=n,a=k(null),v=k(null),l=k(""),{t:h}=R(),{prefixCls:s}=ie("header-search-modal"),[d,x]=_e(),{getIsMobile:N}=pe(),{handleSearch:E,searchResult:C,keyword:B,activeIndex:z,handleEnter:T,handleMouseenter:I}=$e(d,a,t),A=K(()=>!B||e(C).length===0),r=K(()=>[s,{[`${s}--mobile`]:e(N)}]);q(()=>p.visible,u=>{u&&G(()=>{var o;l.value="",(o=e(v))==null||o.focus()})});function i(){C.value=[],t("close")}return(u,o)=>($(),P(oe,{to:"body"},[f(se,{name:"zoom-fade",mode:"out-in"},{default:V(()=>[n.visible?($(),y("div",{key:0,class:m(e(r)),onClick:o[3]||(o[3]=ne(()=>{},["stop"]))},[F(($(),y("div",{class:m(`${e(s)}-content`)},[c("div",{class:m(`${e(s)}-input__wrapper`)},[f(e(ve),{class:m(`${e(s)}-input`),placeholder:e(h)("common.searchText"),ref_key:"inputRef",ref:v,clearable:"",modelValue:l.value,"onUpdate:modelValue":o[0]||(o[0]=g=>l.value=g),onInput:e(E)},{prefix:V(()=>[f(e(W))]),_:1},8,["class","placeholder","modelValue","onInput"]),c("span",{class:m(`${e(s)}-cancel`),onClick:i},M(e(h)("common.cancelText")),3)],2),F(c("div",{class:m(`${e(s)}-nodata`)},M(e(h)("component.app.searchNotData")),3),[[O,e(A)]]),F(c("ul",{class:m(`${e(s)}-list`),ref_key:"scrollWrap",ref:a},[($(!0),y(Y,null,ee(e(C),(g,_)=>($(),y("li",{ref_for:!0,ref:e(x)(_),key:g.path,"data-index":_,onMouseenter:o[1]||(o[1]=(...w)=>e(I)&&e(I)(...w)),onClick:o[2]||(o[2]=(...w)=>e(T)&&e(T)(...w)),class:m([`${e(s)}-list__item`,{[`${e(s)}-list__item--active`]:e(z)===_}])},[c("div",{class:m(`${e(s)}-list__item-icon`)},[f(e(S),{icon:g.icon||"mdi:form-select",size:20},null,8,["icon"])],2),c("div",{class:m(`${e(s)}-list__item-text`)},M(g.name),3),c("div",{class:m(`${e(s)}-list__item-enter`)},[f(e(S),{icon:"uil:enter",size:20})],2)],42,be))),128))],2),[[O,!e(A)]]),f(xe,{class:m(`${e(s)}-footer`)},null,8,["class"])],2)),[[e(de),i]])],2)):te("",!0)]),_:1})]))}}),ye=U({name:"AppSearch",components:{ElTooltip:ge,AppSearchModal:je,Search:W},setup(){const n=k(!1),{t}=R();return{t,showModal:n}}});function Me(n,t,p,a,v,l){const h=L("Search"),s=L("ElTooltip"),d=L("AppSearchModal");return $(),y("div",{onClick:t[1]||(t[1]=x=>n.showModal=!0)},[f(s,{effect:"dark",content:n.t("common.searchText"),placement:"bottom-end"},{default:V(()=>[c("span",null,[f(h)])]),_:1},8,["content"]),f(d,{onClose:t[0]||(t[0]=x=>n.showModal=!1),visible:n.showModal},null,8,["visible"])])}var Je=ce(ye,[["render",Me]]);export{Je as default};
