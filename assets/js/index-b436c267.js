var he=Object.defineProperty,ve=Object.defineProperties;var be=Object.getOwnPropertyDescriptors;var K=Object.getOwnPropertySymbols;var Fe=Object.prototype.hasOwnProperty,Ee=Object.prototype.propertyIsEnumerable;var W=(e,t,a)=>t in e?he(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,B=(e,t)=>{for(var a in t||(t={}))Fe.call(t,a)&&W(e,a,t[a]);if(K)for(var a of K(t))Ee.call(t,a)&&W(e,a,t[a]);return e},L=(e,t)=>ve(e,be(t));var P=(e,t,a)=>new Promise((s,l)=>{var m=o=>{try{n(a.next(o))}catch(c){l(c)}},i=o=>{try{n(a.throw(o))}catch(c){l(c)}},n=o=>o.done?s(o.value):Promise.resolve(o.value).then(m,i);n((a=a.apply(e,t)).next())});import{_ as M,i as q,c as ye,ai as we,a3 as Q,I as Ce,w as Ue}from"./index-26bedde3.js";import{u as _e,B as Z,a as J,b as X}from"./index-ddb5b200.js";import{l as U,u as C,y as $,Z as h,z as _,A as k,G as N,O as T,R as u,b as j,U as Ae,_ as Be,a as I,a7 as Re,H as y,P as R,Q as z,K as Se,D as V,F as Y}from"./ex-pkg-@vue-feb543c0.js";import{p as ee}from"./propTypes-605b60b6.js";import{ae as $e,af as De,ag as x,u as D,a1 as te,ah as Le,ai as Pe,K as Me}from"./ex-pkg-element-plus-f609432a.js";import{d as ke}from"./download-affeb443.js";import{d1 as Ne,cm as Te}from"./ex-pkg-vendor-bb3f8859.js";function Ie({acceptRef:e,helpTextRef:t,maxNumberRef:a,maxSizeRef:s}){const l=U(()=>{const n=C(e);return n&&n.length>0?n:[]}),m=U(()=>C(l).map(n=>n.indexOf("/")>0||n.startsWith(".")?n:`.${n}`).join(",")),i=U(()=>{const n=C(t);if(n)return n;const o=[],c=C(e);c.length>0&&o.push(`\u652F\u6301${c.join(",")}\u683C\u5F0F`);const p=C(s);p&&o.push(`\u5355\u4E2A\u6587\u4EF6\u4E0D\u8D85\u8FC7${p}MB`);const v=C(a);return v&&v!==1/0&&o.push(`\u6700\u591A\u53EA\u80FD\u4E0A\u4F20${v}\u4E2A\u6587\u4EF6`),o.join("\uFF0C")});return{getAccept:l,getStringAccept:m,getHelpText:i}}var g;(function(e){e.SUCCESS="success",e.ERROR="error",e.UPLOADING="uploading"})(g||(g={}));const ne={api:{type:Function,default:null,required:!0},helpText:{type:String,default:""},maxSize:{type:Number,default:2},maxNumber:{type:Number,default:1/0},accept:{type:Array,default:()=>[]},multiple:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},uploadParams:{type:Object,default:{}}},Oe=L(B({},ne),{modelValue:{type:Array,default:()=>[]},showPreviewNumber:{type:Boolean,default:!0},emptyHidePreview:{type:Boolean,default:!1}}),je={modelValue:{type:Array,default:()=>[]}},ze={columns:{type:[Array],default:null},actionColumn:{type:Object,default:null},dataSource:{type:Array,default:null}};function Ve(e,t){const a=t.join("|");return new RegExp("\\.("+a+")$","i").test(e.name)}function xe(e){return le(e.name)}function le(e){return/\.(jpg|jpeg|png|gif|webp|svg)$/i.test(e)}function Ge(e){return new Promise((t,a)=>{const s=new FileReader;s.readAsDataURL(e),s.onload=()=>t({result:s.result,file:e}),s.onerror=l=>a(l)})}const He=$({components:{ElImage:$e},props:{fileUrl:ee.string.def(""),fileName:ee.string.def("")}}),Ke={class:"thumb"};function We(e,t,a,s,l,m){const i=h("ElImage");return _(),k("span",Ke,[e.fileUrl?(_(),N(i,{key:0,src:e.fileUrl,"preview-src-list":[e.fileUrl],width:104},null,8,["src","preview-src-list"])):T("",!0)])}var ae=M(He,[["render",We]]);function qe(){return[{prop:"thumbUrl",label:"	\u7565\u7F29\u56FE",width:100,customRender:({record:e})=>{const{thumbUrl:t}=e||{};return t&&u(ae,{fileUrl:t},null)}},{prop:"name",label:"\u6587\u4EF6\u540D",align:"left",customRender:({text:e,record:t})=>{const{percent:a,status:s}=t||{};let l;return s===g.ERROR?l="exception":s===g.UPLOADING?l="":s===g.SUCCESS&&(l="success"),u("span",null,[u("p",{class:"truncate mb-1",title:e},[e]),u(De,{percentage:a,"text-inside":!0,"stroke-width":24,status:l},null)])}},{prop:"size",label:"\u6587\u4EF6\u5927\u5C0F",width:100,customRender:({text:e=0})=>e&&(e/1024).toFixed(2)+"KB"},{prop:"status",label:"\u72B6\u6001",width:100,customRender:({text:e})=>e===g.SUCCESS?u(x,{type:"success"},{default:()=>"\u4E0A\u4F20\u6210\u529F"}):e===g.ERROR?u(x,{type:"danger"},{default:()=>"\u4E0A\u4F20\u5931\u8D25"}):e===g.UPLOADING?u(x,null,{default:()=>"\u4E0A\u4F20\u4E2D"}):e}]}function Qe(e){return{width:120,label:"\u64CD\u4F5C",prop:"action",fixed:!1,customRender:({record:t})=>u(D,{type:"danger",onClick:e.bind(null,t)},{default:()=>"\u64CD\u4F5C"})}}function Ze(){return[{prop:"url",label:"\u7565\u7F29\u56FE",width:100,customRender:({record:e})=>{const{url:t}=e||{};return le(t)&&u(ae,{fileUrl:t},null)}},{prop:"name",label:"\u6587\u4EF6\u540D",align:"left"}]}function Je({handleRemove:e,handleDownload:t}){return{width:200,label:"\u64CD\u4F5C",prop:"action",fixed:!1,customRender:({record:a})=>u(te,null,{default:()=>[u(D,{type:"danger",onClick:e.bind(null,a)},{default:()=>"\u5220\u9664"}),u(D,{type:"success",onClick:t.bind(null,a)},{default:()=>"\u4E0B\u8F7D"})]})}}const G=[];for(let e=0;e<=15;e++)G[e]=e.toString(16);function Xe(){let e="";for(let t=1;t<=36;t++)t===9||t===14||t===19||t===24?e+="-":t===15?e+=4:t===20?e+=G[Math.random()*4|8]:e+=G[Math.random()*16|0];return e.replace(/-/g,"")}var oe=$({name:"FileList",props:ze,setup(e){const t=_e();return j(()=>e.dataSource,()=>{Ae(()=>{var a;(a=t==null?void 0:t.redoModalHeight)==null||a.call(t)})}),()=>{const{columns:a,actionColumn:s,dataSource:l}=e,m=[...a,s];return u("table",{class:"file-table"},[u("colgroup",null,[m.map(i=>{const{width:n=0,prop:o}=i,c={width:`${n}px`,minWidth:`${n}px`};return u("col",{style:n?c:{},key:o},null)})]),u("thead",null,[u("tr",{class:"file-table-tr"},[m.map(i=>{const{label:n="",align:o="center",prop:c}=i;return u("th",{class:["file-table-th",o],key:c},[n])})])]),u("tbody",null,[l.map((i={},n)=>u("tr",{class:"file-table-tr",key:`${n+i.name||""}`},[m.map(o=>{const{prop:c="",customRender:p,align:v="center"}=o,A=p&&q(p);return u("td",{class:["file-table-td",v],key:c},[A?p==null?void 0:p({text:i[c],record:i}):i[c]])})]))])])}}});const Ye=$({components:{ElButton:D,ElUpload:Le,ElAlert:Pe,BasicModal:Z,FileList:oe},props:L(B({},ne),{previewFileList:{type:Array,default:()=>[]}}),emits:["change","register","delete"],setup(e,{emit:t}){const a=Be({fileList:[]}),s=I(!1),l=I([]),{accept:m,helpText:i,maxNumber:n,maxSize:o}=Re(e),[c,{closeModal:p}]=J(),{getAccept:v,getStringAccept:A,getHelpText:O}=Ie({acceptRef:m,helpTextRef:i,maxNumberRef:n,maxSizeRef:o}),{createMessage:d}=ye(),ue=U(()=>l.value.length>0&&!l.value.every(r=>r.status===g.SUCCESS)),se=U(()=>{const r=l.value.some(f=>f.status===g.SUCCESS);return{disabled:s.value||l.value.length===0||!r}}),re=U(()=>{const r=l.value.some(f=>f.status===g.ERROR);return s.value?"\u4E0A\u4F20\u4E2D":r?"\u91CD\u65B0\u4E0A\u4F20\u5931\u8D25\u6587\u4EF6":"\u5F00\u59CB\u4E0A\u4F20"});function ie(r){const{size:f,name:b}=r,{maxSize:E,maxNumber:w,previewFileList:F}=e,S=C(v);if(l.value.length+(F==null?void 0:F.length)>=w)return d.warning(`\u6700\u591A\u53EA\u80FD\u4E0A\u4F20${w}\u4E2A\u6587\u4EF6`);if(E&&r.size/1024/1024>=E)return d.error(`\u53EA\u80FD\u4E0A\u4F20\u4E0D\u8D85\u8FC7${E}MB\u7684\u6587\u4EF6!`),!1;if(S.length>0&&!Ve(r,S))return d.error(`\u53EA\u80FD\u4E0A\u4F20${S.join(",")}\u683C\u5F0F\u6587\u4EF6`),!1;const H={uuid:Xe(),file:r,size:f,name:b,percent:0,type:b.split(".").pop()};return xe(r)?Ge(r).then(({result:ge})=>{l.value=[...C(l),B({thumbUrl:ge},H)]}):l.value=[...C(l),H],!1}function ce(r){const f=l.value.findIndex(b=>b.uuid===r.uuid);f!==-1&&l.value.splice(f,1),t("delete",r)}function de(r){return P(this,null,function*(){var b;const{api:f}=e;if(!f||!q(f))return we("upload api must exist and be a function");try{r.status=g.UPLOADING;const E=function(F){const S=F.loaded/F.total*100|0;r.percent=S},{data:w}=yield(b=e.api)==null?void 0:b.call(e,L(B({},e.uploadParams||{}),{file:r.file}),E);return r.status=g.SUCCESS,r.responseData=w,{success:!0,error:null}}catch(E){return r.status=g.ERROR,{success:!1,error:E}}})}function pe(){return P(this,null,function*(){var f;const{maxNumber:r}=e;if(l.value.length+((f=e.previewFileList)==null?void 0:f.length)>r)return d.warning(`\u6700\u591A\u53EA\u80FD\u4E0A\u4F20${r}\u4E2A\u6587\u4EF6`);try{s.value=!0;const b=l.value.filter(F=>F.status!==g.SUCCESS)||[],E=yield Promise.all(b.map(F=>de(F)));s.value=!1;const w=E.filter(F=>!F.success);if(w.length>0)throw w}catch(b){throw s.value=!1,b}})}function fe(){const{maxNumber:r}=e;if(l.value.length>r)return d.warning(`\u6700\u591A\u53EA\u80FD\u4E0A\u4F20${r}\u4E2A\u6587\u4EF6`);if(s.value)return d.warning("\u8BF7\u7B49\u5F85\u6587\u4EF6\u4E0A\u4F20\u540E\uFF0C\u4FDD\u5B58!");const f=[];for(const b of l.value){const{status:E,responseData:w}=b;E===g.SUCCESS&&w&&f.push(w.url)}if(f.length<=0)return d.warning("\u6CA1\u6709\u4E0A\u4F20\u6210\u529F\u7684\u6587\u4EF6\uFF0C\u65E0\u6CD5\u4FDD\u5B58!");l.value=[],p(),t("change",f)}function me(){return P(this,null,function*(){return s.value?(d.warning("\u8BF7\u7B49\u5F85\u6587\u4EF6\u4E0A\u4F20\u7ED3\u675F\u540E\u64CD\u4F5C"),!1):(l.value=[],!0)})}return{columns:qe(),actionColumn:Qe(ce),register:c,closeModal:p,getHelpText:O,getStringAccept:A,getOkButtonProps:se,beforeUpload:ie,fileListRef:l,state:a,isUploadingRef:s,handleStartUpload:pe,handleOk:fe,handleCloseFunc:me,getIsSelectFile:ue,getUploadBtnText:re}}}),et={class:"upload-modal-toolbar"},tt=R("\u9009\u62E9\u6587\u4EF6");function nt(e,t,a,s,l,m){const i=h("el-button"),n=h("ElAlert"),o=h("ElButton"),c=h("ElUpload"),p=h("FileList"),v=h("BasicModal");return _(),N(v,V({title:"'\u4E0A\u4F20'",okText:"\u4FDD\u5B58"},e.$attrs,{onRegister:e.register,onOk:e.handleOk,closeFunc:e.handleCloseFunc,maskClosable:!1,keyboard:!1,wrapClassName:"upload-modal",confirmButton:e.getOkButtonProps,cancelButton:{disabled:e.isUploadingRef}}),{centerFooter:y(()=>[u(i,{onClick:e.handleStartUpload,type:"success",disabled:!e.getIsSelectFile,loading:e.isUploadingRef},{default:y(()=>[R(z(e.getUploadBtnText),1)]),_:1},8,["onClick","disabled","loading"])]),default:y(()=>[Se("div",et,[u(n,{title:e.getHelpText,type:"info",closable:!1,class:"upload-modal-toolbar__text"},null,8,["title"]),u(c,{action:"NotUrl",accept:e.getStringAccept,multiple:e.multiple,limit:e.maxNumber,disabled:e.isUploadingRef||e.fileListRef.length+e.previewFileList.length>=e.maxNumber,"show-file-list":!1,"before-upload":e.beforeUpload,class:"upload-modal-toolbar__btn"},{default:y(()=>[u(o,{type:"primary",disabled:e.isUploadingRef||e.fileListRef.length+e.previewFileList.length>=e.maxNumber},{default:y(()=>[tt]),_:1},8,["disabled"])]),_:1},8,["accept","multiple","limit","disabled","before-upload"])]),u(p,{dataSource:e.fileListRef,columns:e.columns,actionColumn:e.actionColumn},null,8,["dataSource","columns","actionColumn"])]),_:1},16,["onRegister","onOk","closeFunc","confirmButton","cancelButton"])}var lt=M(Ye,[["render",nt]]);const at=$({components:{BasicModal:Z,FileList:oe},props:je,emits:["list-change","register","delete"],setup(e,{emit:t}){const[a,{closeModal:s}]=J(),l=I([]);j(()=>e.modelValue,n=>{Q(n)||(n=[]),l.value=n.filter(o=>!!o).map(o=>({url:o,type:o.split(".").pop()||"",name:o.split("/").pop()||""}))},{immediate:!0});function m(n){const o=l.value.findIndex(c=>c.url===n.url);if(o!==-1){const c=l.value.splice(o,1);t("delete",c[0].url),t("list-change",l.value.map(p=>p.url))}}function i(n){const{url:o}=n;ke({url:o})}return{register:a,closeModal:s,fileListRef:l,columns:Ze(),actionColumn:Je({handleRemove:m,handleDownload:i})}}});function ot(e,t,a,s,l,m){const i=h("FileList"),n=h("BasicModal");return _(),N(n,V({width:800,title:"\u9884\u89C8",wrapClassName:"upload-preview-modal"},e.$attrs,{onRegister:e.register,showConfirm:!1}),{default:y(()=>[u(i,{dataSource:e.fileListRef,columns:e.columns,actionColumn:e.actionColumn},null,8,["dataSource","columns","actionColumn"])]),_:1},16,["onRegister"])}var ut=M(at,[["render",ot]]);const st=$({name:"BasicUpload",components:{ElTooltip:Me,ElButton:D,ElButtonGroup:te,UploadModal:lt,UploadPreviewModal:ut,Icon:Ce},props:Oe,emits:["change","delete","preview-delete","update:value"],setup(e,{emit:t,attrs:a}){const[s,{openModal:l}]=X(),[m,{openModal:i}]=X(),n=I([]),o=U(()=>{const{emptyHidePreview:d}=e;return d&&d?n.value.length>0:!0}),c=U(()=>{const d=B(B({},a),e);return Te(d,"onChange","modelValue")});j(()=>e.modelValue,(d=[])=>{n.value=Q(d)?d:[]},{immediate:!0});function p(d){n.value=[...C(n),...d||[]],t("update:value",n.value),t("change",n.value)}function v(d){n.value=[...d||[]],t("update:value",n.value),t("change",n.value)}function A(d){t("delete",d)}function O(d){t("preview-delete",d)}return{registerUploadModal:s,openUploadModal:l,handleChange:p,handlePreviewChange:v,registerPreviewModal:m,openPreviewModal:i,UploadFilled:Ne,fileList:n,showPreview:o,bindValue:c,handleDelete:A,handlePreviewDelete:O}}}),rt=R(" \u4E0A\u4F20 "),it=R(" \u5DF2\u4E0A\u4F20 "),ct=R();function dt(e,t,a,s,l,m){const i=h("ElButton"),n=h("Icon"),o=h("ElTooltip"),c=h("ElButtonGroup"),p=h("UploadModal"),v=h("UploadPreviewModal");return _(),k("div",null,[u(c,null,{default:y(()=>[u(i,{type:"primary",onClick:t[0]||(t[0]=A=>e.openUploadModal()),icon:e.UploadFilled},{default:y(()=>[rt]),_:1},8,["icon"]),e.showPreview?(_(),N(o,{key:0,placement:"bottom"},{content:y(()=>[it,e.fileList.length?(_(),k(Y,{key:0},[R(z(e.fileList.length),1)],64)):T("",!0)]),default:y(()=>[u(i,{onClick:t[1]||(t[1]=A=>e.openPreviewModal())},{default:y(()=>[u(n,{icon:"bi:eye",size:"12"}),ct,e.fileList.length&&e.showPreviewNumber?(_(),k(Y,{key:0},[R(z(e.fileList.length),1)],64)):T("",!0)]),_:1})]),_:1})):T("",!0)]),_:1}),u(p,V(e.bindValue,{previewFileList:e.fileList,onRegister:e.registerUploadModal,onChange:e.handleChange,onDelete:e.handleDelete}),null,16,["previewFileList","onRegister","onChange","onDelete"]),u(v,{value:e.fileList,onRegister:e.registerPreviewModal,onListChange:e.handlePreviewChange,onDelete:e.handlePreviewDelete},null,8,["value","onRegister","onListChange","onDelete"])])}var pt=M(st,[["render",dt]]);const yt=Ue(pt);export{yt as B,Xe as b};
