var q=Object.defineProperty,J=Object.defineProperties;var K=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable;var C=(t,r,d)=>r in t?q(t,r,{enumerable:!0,configurable:!0,writable:!0,value:d}):t[r]=d,x=(t,r)=>{for(var d in r||(r={}))Q.call(r,d)&&C(t,d,r[d]);if(W)for(var d of W(r))U.call(r,d)&&C(t,d,r[d]);return t},X=(t,r)=>J(t,K(r));import{b as F,w as Y,I as k}from"./index-795cdaa0.js";import{g as j}from"./tsxHelper-f44f22cd.js";import{E as z,W as A,r as E,f as _,w as Z,b as ee,u,S as h,G as te}from"./vue-d691a816.js";import{u as se}from"./useTimeout-ff985c90.js";const G={modelValue:{type:Boolean,default:!1},isSlot:{type:Boolean,default:!1},text:{type:String,default:"请按住滑块拖动"},successText:{type:String,default:"验证通过"},height:{type:Number,default:40},width:{type:Number,default:220},circle:{type:Boolean,default:!1},wrapStyle:{type:Object,default:{}},contentStyle:{type:Object,default:{}},barStyle:{type:Object,default:{}},actionStyle:{type:Object,default:{}}},ne=X(x({},G),{src:{type:String},imgSize:{type:Number,default:260},imgWrapStyle:{type:Object,default:{}},minDegree:{type:Number,default:90},maxDegree:{type:Number,default:270},diffDegree:{type:Number,default:20}}),H=z({name:"BasicDragVerify",props:G,emits:["success","update:modelValue","change","start","move","end"],setup(t,{emit:r,slots:d,expose:O}){const s=A({isMoving:!1,isPassing:!1,moveDistance:0,toLeft:!1,startTime:0,endTime:0}),n=E(null),y=E(null),R=E(null),S=E(null),{prefixCls:T}=F("basic-drag-verify");document.addEventListener("mouseup",()=>{s.isMoving&&p()});const I=_(()=>{const{height:e,actionStyle:o}=t,c=`${e}px`;return x({left:0,width:c,height:c},o)}),P=_(()=>{const{height:e,width:o,circle:c,wrapStyle:i}=t,l=e,m=`${o}px`;return x({width:m,height:`${l}px`,lineHeight:`${l}px`,borderRadius:c?`${l/2}px`:0},i)}),N=_(()=>{const{height:e,circle:o,barStyle:c}=t,i=e;return x({height:`${i}px`,borderRadius:o?`${i/2}px 0 0 ${i/2}px`:0},c)}),V=_(()=>{const{height:e,width:o,contentStyle:c}=t,i=`${e}px`,l=`${o}px`;return x({height:i,width:l},c)});Z(()=>s.isPassing,e=>{if(e){const{startTime:o,endTime:c}=s,i=(c-o)/1e3;r("success",{isPassing:e,time:i.toFixed(1)}),r("update:modelValue",e),r("change",e)}}),ee(()=>{s.isPassing=!!t.modelValue});function $(e){return e.pageX||e.touches[0].pageX}function a(e){if(s.isPassing)return;const o=u(S);o&&(r("start",e),s.moveDistance=$(e)-parseInt(o.style.left.replace("px",""),10),s.startTime=new Date().getTime(),s.isMoving=!0)}function f(e){const o=parseInt(e.style.width),{width:c}=t,i=c;return{offset:i-o-6,widthNum:i,actionWidth:o}}function g(e){const{isMoving:o,moveDistance:c}=s;if(o){const i=u(S),l=u(y);if(!i||!l)return;const{offset:m,widthNum:D,actionWidth:M}=f(i),v=$(e)-c;r("move",{event:e,moveDistance:c,moveX:v}),v>0&&v<=m?(i.style.left=`${v}px`,l.style.width=`${v+M/2}px`):v>m&&(i.style.left=`${D-M}px`,l.style.width=`${D-M/2}px`,t.isSlot||b())}}function w(e){const{isMoving:o,isPassing:c,moveDistance:i}=s;if(o&&!c){r("end",e);const l=u(S),m=u(y);if(!l||!m)return;const D=$(e)-i,{offset:M,widthNum:v,actionWidth:B}=f(l);D<M?t.isSlot?setTimeout(()=>{if(!t.modelValue)p();else{const L=u(R);L&&(L.style.width=`${parseInt(m.style.width)}px`)}},0):p():(l.style.left=`${v-B}px`,m.style.width=`${v-B/2}px`,b()),s.isMoving=!1}}function b(){if(t.isSlot){p();return}s.endTime=new Date().getTime(),s.isPassing=!0,s.isMoving=!1}function p(){s.isMoving=!1,s.isPassing=!1,s.moveDistance=0,s.toLeft=!1,s.startTime=0,s.endTime=0;const e=u(S),o=u(y),c=u(R);!e||!o||!c||(s.toLeft=!0,setTimeout(()=>{s.toLeft=!1,e.style.left="0",o.style.width="0"},300),c.style.width=u(V).width)}return O({resume:p}),()=>{const e=()=>{const i=[`${T}-bar`];return s.toLeft&&i.push("to-left"),h("div",{class:i,ref:y,style:u(N)},null)},o=()=>{const i=[`${T}-content`],{isPassing:l}=s,{text:m,successText:D}=t;return l&&i.push("success"),h("div",{class:i,ref:R,style:u(V)},[j(d,"text",l)||(l?D:m)])},c=()=>{const i=[`${T}-action`],{toLeft:l,isPassing:m}=s;return l&&i.push("to-left"),h("div",{class:i,onMousedown:a,onTouchstart:a,style:u(I),ref:S},[j(d,"actionIcon",m)||h(Y,{class:`${T}-action__icon`,name:`${m?"check":"doubleright"}`},null)])};return h("div",{class:T,ref:n,style:u(P),onMousemove:g,onTouchmove:g,onMouseleave:w,onMouseup:w,onTouchend:w},[e(),o(),c()])}}});const ie=z({name:"RotateDragVerify",inheritAttrs:!1,props:ne,emits:["success","change","update:modelValue"],setup(t,{emit:r,attrs:d,expose:O}){const s=E(null),n=A({showTip:!1,isPassing:!1,imgStyle:{},randomRotate:0,currentRotate:0,toOrigin:!1,startTime:0,endTime:0,draged:!1}),{prefixCls:y}=F("basic-img-verify"),R=_(()=>{const{imgWrapStyle:a,imgSize:f}=t;return x({width:`${f}px`,height:`${f}px`},a)}),S=_(()=>{const{minDegree:a,maxDegree:f}=t;return a===f?Math.floor(1+Math.random()*1)/10+1:1});function T(){n.startTime=new Date().getTime()}function I(a){n.draged=!0;const{imgSize:f,height:g,maxDegree:w}=t,{moveX:b}=a,p=Math.ceil(b/(f-g)*w*u(S));n.currentRotate=p,n.imgStyle={transform:`rotateZ(${n.randomRotate-p}deg)`}}function P(){const{minDegree:a,maxDegree:f}=t,g=Math.floor(a+Math.random()*(f-a));n.randomRotate=g,n.imgStyle={transform:`rotateZ(${g}deg)`}}function N(){const{randomRotate:a,currentRotate:f}=n,{diffDegree:g}=t;Math.abs(a-f)>=(g||20)?(n.imgStyle={transform:`rotateZ(${a}deg)`},n.toOrigin=!0,se(()=>{n.toOrigin=!1,n.showTip=!0},300)):V(),n.showTip=!0}function V(){n.isPassing=!0,n.endTime=new Date().getTime()}function $(){n.showTip=!1;const a=u(s);a&&(n.isPassing=!1,a.resume(),P())}return O({resume:$}),Z(()=>n.isPassing,a=>{if(a){const{startTime:f,endTime:g}=n,w=(g-f)/1e3;r("success",{isPassing:a,time:w.toFixed(1)}),r("change",a),r("update:modelValue",a)}}),()=>{const{src:a,width:f}=t,{toOrigin:g,isPassing:w,startTime:b,endTime:p}=n,e=[];g&&e.push("to-origin");const o=(p-b)/1e3;return h("div",{class:`${y}`},[h("div",{class:`${y}-img__wrap`,style:u(R)},[h("img",{src:a,onLoad:P,width:f,class:e,style:n.imgStyle,onClick:()=>{$()},alt:"verify"},null),n.showTip&&h("span",{class:[`${y}-img__tip`,n.isPassing?"success":"error"]},[n.isPassing?`验证校验成功,耗时${o.toFixed(1)}秒！`:"验证失败！"]),!n.showTip&&!n.draged&&h("span",{class:[`${y}-img__tip`,"normal"]},["点击图片可刷新"])]),h(H,te({class:`${y}-drag__bar`,onMove:I,onEnd:N,onStart:T,ref:s},x(x({},d),t),{modelValue:w,isSlot:!0}),null)])}}});const fe=k(H),ue=k(ie);export{fe as B,ue as R};
