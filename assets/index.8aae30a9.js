var J=Object.defineProperty,Q=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var P=(e,s,t)=>s in e?J(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t,I=(e,s)=>{for(var t in s||(s={}))Z.call(s,t)&&P(e,t,s[t]);if(O)for(var t of O(s))X.call(s,t)&&P(e,t,s[t]);return e},j=(e,s)=>Q(e,Y(s));import{d as ee,e as ne,u as A,_ as R,m as oe,ac as te,a1 as se,w as ae}from"./index.ec0491db.js";import{t as w}from"./ex-pkg-tinymce.bed4cc51.js";import{y as z,l as g,Z as B,z as U,A as E,R as N,H as V,D as le,P as ie,Q as re,L as x,a as S,u as c,b as T,U as ue,t as ce,a$ as de,I as pe,J as me,G as fe,O as ge,B as he,Y as ye}from"./ex-pkg-@vue.dfd8e273.js";import{z as ve,ah as be}from"./ex-pkg-element-plus.7627c250.js";import{a as F}from"./uuid.2b29000c.js";import{o as Ce}from"./onMountedOrActivated.67461842.js";const _e=z({name:"TinymceImageUpload",components:{ElButton:ve,ElUpload:be},props:{fullscreen:{type:Boolean},disabled:{type:Boolean,default:!1}},emits:["uploading","done","error"],setup(e,{emit:s}){let t=!1;const{uploadUrl:l}=ee(),{t:u}=ne(),{prefixCls:d}=A("tinymce-img-upload"),p=g(()=>{const{disabled:y}=e;return{disabled:y}});function h(y){var m;const r=y.file,v=r==null?void 0:r.status,b=(m=r==null?void 0:r.response)==null?void 0:m.url,C=r==null?void 0:r.name;v==="uploading"?t||(s("uploading",C),t=!0):v==="done"?(s("done",C,b),t=!1):v==="error"&&(s("error"),t=!1)}return{prefixCls:d,handleChange:h,uploadUrl:l,t:u,getButtonProps:p}}});function ke(e,s,t,l,u,d){const p=B("ElButton"),h=B("ElUpload");return U(),E("div",{class:x([e.prefixCls,{fullscreen:e.fullscreen}])},[N(h,{"file-list":[],multiple:"",onChange:e.handleChange,action:e.uploadUrl,"show-file-list":!1,accept:"image/*"},{default:V(()=>[N(p,le({type:"primary",size:"small"},I({},e.getButtonProps)),{default:V(()=>[ie(re(e.t("component.upload.imgUpload")),1)]),_:1},16)]),_:1},8,["onChange","action"])],2)}var Ue=R(_e,[["render",ke],["__scopeId","data-v-5e280119"]]);const Se=["advlist anchor autolink autosave code codesample  directionality  fullscreen hr insertdatetime link lists media nonbreaking noneditable pagebreak paste preview print save searchreplace tabfocus  template  textpattern visualblocks visualchars wordcount"],De=["fontsizeselect lineheight searchreplace bold italic underline strikethrough alignleft aligncenter alignright outdent indent  blockquote undo redo removeformat subscript superscript code codesample","hr bullist numlist link  preview anchor pagebreak insertdatetime media  forecolor backcolor fullscreen"],Ie=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],we=e=>Ie.indexOf(e)!==-1,Be=(e,s,t)=>{Object.keys(s).filter(we).forEach(l=>{const u=s[l];typeof u=="function"&&(l==="onInit"?u(e,t):t.on(l.substring(2),d=>u(d,t)))})};const Ee={options:{type:Object,default:{}},modelValue:{type:String},toolbar:{type:Array,default:De},plugins:{type:Array,default:Se},height:{type:[Number,String],required:!1,default:400},width:{type:[Number,String],required:!1,default:"auto"},showImageUpload:{type:Boolean,default:!0}},$e=z({name:"Tinymce",components:{ImgUpload:Ue},inheritAttrs:!1,props:Ee,emits:["change","update:modelValue","inited","init-error"],setup(e,{emit:s,attrs:t}){const l=S(null),u=S(!1),d=S(F("tiny-vue")),p=S(null),{prefixCls:h}=A("tinymce-container"),y=oe(),r=g(()=>e.modelValue),v=g(()=>{const n=e.width;return te(n)?`${n}px`:n}),b=g(()=>y.getDarkMode==="light"?"oxide":"oxide-dark"),C=g(()=>{const n=se().getLocale.value;return["zh_CN","en"].includes(n)?n:"zh_CN"}),m=g(()=>{const{height:n,options:o,toolbar:a,plugins:i}=e,f="/vue-tony-admin-site/";return j(I({selector:`#${c(d)}`,height:n,toolbar:a,menubar:"file edit insert view format table",plugins:i,language_url:f+"tinymce/langs/"+C.value+".js",language:C.value,branding:!1,default_link_target:"_blank",link_title:!1,object_resizing:!1,auto_focus:!0,skin:b.value,skin_url:f+"tinymce/skins/ui/"+b.value,content_css:f+"tinymce/skins/ui/"+b.value+"/content.min.css"},o),{setup:_=>{l.value=_,_.on("init",k=>H(k))}})}),G=g(()=>{const{options:n}=e,o=n&&Reflect.get(n,"readonly"),a=c(l);return a&&a.setMode(o?"readonly":"design"),o!=null?o:!1});T(()=>t.disabled,()=>{const n=c(l);!n||n.setMode(t.disabled?"readonly":"design")}),Ce(()=>{m.value.inline||(d.value=F("tiny-vue")),ue(()=>{setTimeout(()=>{L()},30)})}),ce(()=>{$()}),de(()=>{$()});function $(){var n,o;w!==null&&((o=(n=w)==null?void 0:n.remove)==null||o.call(n,c(m).selector))}function L(){const n=c(p);n&&(n.style.visibility=""),w.init(c(m)).then(o=>{s("inited",o)}).catch(o=>{s("init-error",o)})}function H(n){const o=c(l);if(!o)return;const a=e.modelValue||"";o.setContent(a),K(o),Be(n,t,c(l))}function D(n,o,a){n&&typeof o=="string"&&o!==a&&o!==n.getContent({format:t.outputFormat})&&n.setContent(o)}function K(n){const o=t.modelEvents?t.modelEvents:null,a=Array.isArray(o)?o.join(" "):o;T(()=>e.modelValue,(i,f)=>{D(n,i,f)}),n.on(a||"change keyup undo redo",()=>{const i=n.getContent({format:t.outputFormat});s("update:modelValue",i),s("change",i)}),n.on("FullscreenStateChanged",i=>{u.value=i.state})}function q(n){var i;const o=c(l);if(!o)return;o.execCommand("mceInsertContent",!1,M(n));const a=(i=o==null?void 0:o.getContent())!=null?i:"";D(o,a)}function W(n,o){var _,k;const a=c(l);if(!a)return;const i=(_=a==null?void 0:a.getContent())!=null?_:"",f=(k=i==null?void 0:i.replace(M(n),`<img src="${o}"/>`))!=null?k:"";D(a,f)}function M(n){return`[uploading:${n}]`}return{prefixCls:h,containerWidth:v,initOptions:m,tinymceContent:r,elRef:p,tinymceId:d,handleImageUploading:q,handleDone:W,editorRef:l,fullscreen:u,disabled:G}}}),Me=["id"];function Oe(e,s,t,l,u,d){const p=B("ImgUpload");return U(),E("div",{class:x(e.prefixCls),style:ye({width:e.containerWidth})},[e.showImageUpload?pe((U(),fe(p,{key:0,fullscreen:e.fullscreen,onUploading:e.handleImageUploading,onDone:e.handleDone,disabled:e.disabled},null,8,["fullscreen","onUploading","onDone","disabled"])),[[me,e.editorRef]]):ge("",!0),e.initOptions.inline?he(e.$slots,"default",{key:2}):(U(),E("textarea",{key:1,id:e.tinymceId,ref:"elRef",style:{visibility:"hidden"}},null,8,Me))],6)}var Pe=R($e,[["render",Oe]]);const Te=ae(Pe);export{Te as T};
