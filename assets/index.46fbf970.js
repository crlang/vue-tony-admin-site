var we=Object.defineProperty,Ce=Object.defineProperties;var Ue=Object.getOwnPropertyDescriptors;var Y=Object.getOwnPropertySymbols;var Se=Object.prototype.hasOwnProperty,Re=Object.prototype.propertyIsEnumerable;var Z=(e,t,n)=>t in e?we(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,N=(e,t)=>{for(var n in t||(t={}))Se.call(t,n)&&Z(e,n,t[n]);if(Y)for(var n of Y(t))Re.call(t,n)&&Z(e,n,t[n]);return e},x=(e,t)=>Ce(e,Ue(t));var V=(e,t,n)=>new Promise((c,i)=>{var s=a=>{try{l(n.next(a))}catch(p){i(p)}},o=a=>{try{l(n.throw(a))}catch(p){i(p)}},l=a=>a.done?c(a.value):Promise.resolve(a.value).then(s,o);l((n=n.apply(e,t)).next())});import{e as k,p as q,_ as D,i as J,f as Ee,au as _e,ao as X,I as Be,w as Pe}from"./index.ecb3b302.js";import{u as Ie,B as Q}from"./index.4bc9f650.js";import{y as _,u as R,x as F,bY as $e,Y as b,z as $,A as M,Z as z,aa as j,a0 as u,bZ as Le,b_ as G,aI as T,bA as ee,O as A,X as Ne,b$ as Te,c0 as ke,M as L,I as Fe,R as Ae,ak as te,a3 as h,ab as E,F as B,aJ as ne,aK as le,D as xe,a7 as De,c1 as Me,a8 as oe,a1 as ze,o as je}from"./vendor.041d4bc7.js";import{b as Oe}from"./uuid.2b29000c.js";import{d as Ve}from"./download.c9817825.js";const{t:H}=k();function Ge({acceptRef:e,helpTextRef:t,maxNumberRef:n,maxSizeRef:c}){const i=_(()=>{const l=R(e);return l&&l.length>0?l:[]}),s=_(()=>R(i).map(l=>l.indexOf("/")>0||l.startsWith(".")?l:`.${l}`).join(",")),o=_(()=>{const l=R(t);if(l)return l;const a=[],p=R(e);p.length>0&&a.push(H("component.upload.accept",[p.join(",")]));const d=R(c);d&&a.push(H("component.upload.maxSize",[d]));const w=R(n);return w&&w!==1/0&&a.push(H("component.upload.maxNumber",[w])),a.join("\uFF0C")});return{getAccept:i,getStringAccept:s,getHelpText:o}}var v;(function(e){e.SUCCESS="success",e.ERROR="error",e.UPLOADING="uploading"})(v||(v={}));const ae={visible:{type:Boolean,default:!1},helpText:{type:String,default:""},maxSize:{type:Number,default:2},maxNumber:{type:Number,default:1/0},accept:{type:Array,default:()=>[]},multiple:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},uploadParams:{type:Object,default:{}},api:{type:Function,default:null,required:!0}},He=x(N({value:{type:Array,default:()=>[]}},ae),{showPreviewNumber:{type:Boolean,default:!0},emptyHidePreview:{type:Boolean,default:!1}}),We={visible:{type:Boolean,default:!1},value:{type:Array,default:()=>[]}},Ke={columns:{type:[Array],default:null},actionColumn:{type:Object,default:null},dataSource:{type:Array,default:null}};function Ye(e,t){const n=t.join("|");return new RegExp("\\.("+n+")$","i").test(e.name)}function Ze(e){return se(e.name)}function se(e){return/\.(jpg|jpeg|png|gif|webp|svg)$/i.test(e)}function qe(e){return new Promise((t,n)=>{const c=new FileReader;c.readAsDataURL(e),c.onload=()=>t({result:c.result,file:e}),c.onerror=i=>n(i)})}const Je=F({components:{ElImage:$e},props:{fileUrl:q.string.def(""),fileName:q.string.def("")}}),Xe={class:"thumb"};function Qe(e,t,n,c,i,s){const o=b("ElImage");return $(),M("span",Xe,[e.fileUrl?($(),z(o,{key:0,src:e.fileUrl,"preview-src-list":[e.fileUrl],width:104},null,8,["src","preview-src-list"])):j("",!0)])}var ie=D(Je,[["render",Qe]]);const{t:y}=k();function et(){return[{dataIndex:"thumbUrl",title:y("component.upload.legend"),width:100,customRender:({record:e})=>{const{thumbUrl:t}=e||{};return t&&u(ie,{fileUrl:t},null)}},{dataIndex:"name",title:y("component.upload.fileName"),align:"left",customRender:({text:e,record:t})=>{const{percent:n,status:c}=t||{};console.log("record",t);let i;return c===v.ERROR?i="exception":c===v.UPLOADING?i="":c===v.SUCCESS&&(i="success"),u("span",null,[u("p",{class:"truncate mb-1",title:e},[e]),u(Le,{percentage:n,"text-inside":!0,"stroke-width":24,status:i},null)])}},{dataIndex:"size",title:y("component.upload.fileSize"),width:100,customRender:({text:e=0})=>e&&(e/1024).toFixed(2)+"KB"},{dataIndex:"status",title:y("component.upload.fileStatue"),width:100,customRender:({text:e})=>e===v.SUCCESS?u(G,{type:"success"},{default:()=>y("component.upload.uploadSuccess")}):e===v.ERROR?u(G,{type:"danger"},{default:()=>y("component.upload.uploadError")}):e===v.UPLOADING?u(G,null,{default:()=>y("component.upload.uploading")}):e}]}function tt(e){return{width:120,title:y("component.upload.operating"),dataIndex:"action",fixed:!1,customRender:({record:t})=>u(T,{type:"danger",onClick:e.bind(null,t)},{default:()=>y("component.upload.del")})}}function nt(){return[{dataIndex:"url",title:y("component.upload.legend"),width:100,customRender:({record:e})=>{const{url:t}=e||{};return se(t)&&u(ie,{fileUrl:t},null)}},{dataIndex:"name",title:y("component.upload.fileName"),align:"left"}]}function lt({handleRemove:e,handleDownload:t}){return{width:200,title:y("component.upload.operating"),dataIndex:"action",fixed:!1,customRender:({record:n})=>u(ee,null,{default:()=>[u(T,{type:"danger",onClick:e.bind(null,n)},{default:()=>y("component.upload.del")}),u(T,{type:"success",onClick:t.bind(null,n)},{default:()=>y("component.upload.download")})]})}}var ue=F({name:"FileList",props:Ke,setup(e){const t=Ie();return A(()=>e.dataSource,()=>{Ne(()=>{var n;(n=t==null?void 0:t.redoModalHeight)==null||n.call(t)})}),()=>{const{columns:n,actionColumn:c,dataSource:i}=e,s=[...n,c];return u("table",{class:"file-table"},[u("colgroup",null,[s.map(o=>{const{width:l=0,dataIndex:a}=o,p={width:`${l}px`,minWidth:`${l}px`};return u("col",{style:l?p:{},key:a},null)})]),u("thead",null,[u("tr",{class:"file-table-tr"},[s.map(o=>{const{title:l="",align:a="center",dataIndex:p}=o;return u("th",{class:["file-table-th",a],key:p},[l])})])]),u("tbody",null,[i.map((o={},l)=>u("tr",{class:"file-table-tr",key:`${l+o.name||""}`},[s.map(a=>{const{dataIndex:p="",customRender:d,align:w="center"}=a,C=d&&J(d);return u("td",{class:["file-table-td",w],key:p},[C?d==null?void 0:d({text:o[p],record:o}):o[p]])})]))])])}}});const ot=F({components:{ElButton:T,ElUpload:Te,ElAlert:ke,BasicModal:Q,FileList:ue},props:x(N({},ae),{previewFileList:{type:Array,default:()=>[]}}),emits:["change","delete","update:visible"],setup(e,{emit:t}){const n=L(!1),c=Fe({fileList:[]}),i=L(!1),s=L([]),{accept:o,helpText:l,maxNumber:a,maxSize:p}=Ae(e),{t:d}=k(),{getAccept:w,getStringAccept:C,getHelpText:f}=Ge({acceptRef:o,helpTextRef:l,maxNumberRef:a,maxSizeRef:p}),{createMessage:P,createConfirm:re}=Ee(),de=_(()=>s.value.length>0&&!s.value.every(r=>r.status===v.SUCCESS)),pe=_(()=>{const r=s.value.some(m=>m.status===v.SUCCESS);return{type:"primary",disabled:i.value||s.value.length===0||!r,onClick:W}}),ce=_(()=>{const{maxNumber:r,previewFileList:m}=e;return{type:"primary",disabled:s.value.length+(m==null?void 0:m.length)>=r}}),me=_(()=>{const r=s.value.some(m=>m.status===v.ERROR);return i.value?d("component.upload.uploading"):d(r?"component.upload.reUploadFailed":"component.upload.startUpload")});te(()=>{n.value=!!e.visible}),A(()=>n.value,r=>{t("update:visible",r)},{immediate:!1});function fe(r){const{size:m,name:g}=r,{maxSize:I,maxNumber:U,previewFileList:S}=e,O=R(w);if(I&&r.size/1024/1024>=I)return P.error(d("component.upload.maxSizeMultiple",[I])),!1;if(O.length>0&&!Ye(r,O))return P.error(d("component.upload.acceptUpload",[O.join(",")])),!1;if(s.value.length+(S==null?void 0:S.length)>=U)return P.error(d("component.upload.maxNumber",[U])),!1;const K={uuid:Oe(),file:r,size:m,name:g,percent:0,type:g.split(".").pop()};return Ze(r)?qe(r).then(({result:ye})=>{s.value=[...R(s),N({thumbUrl:ye},K)]}):s.value=[...R(s),K],!1}function ve(r){const m=s.value.findIndex(g=>g.uuid===r.uuid);m!==-1&&s.value.splice(m,1),t("delete",r)}function ge(r){return V(this,null,function*(){const{api:m}=e;if(!m||!J(m))return _e("upload api must exist and be a function");try{r.status=v.UPLOADING;const{data:g}=yield e.api(x(N({},e.uploadParams||{}),{file:r.file}),function(U){const S=U.loaded/U.total*100|0;r.percent=S});return r.status=v.SUCCESS,r.responseData=g,{success:!0,error:null}}catch(g){return console.log(g),r.status=v.ERROR,{success:!1,error:g}}})}function be(){return V(this,null,function*(){var m;const{maxNumber:r}=e;if(s.value.length+((m=e.previewFileList)==null?void 0:m.length)>r)return P.warning(d("component.upload.maxNumber",[r]));try{i.value=!0;const g=s.value.filter(S=>S.status!==v.SUCCESS)||[],I=yield Promise.all(g.map(S=>ge(S)));i.value=!1;const U=I.filter(S=>!S.success);if(U.length>0)throw U}catch(g){throw i.value=!1,g}})}function W(){const{maxNumber:r}=e;if(s.value.length>r)return P.warning(d("component.upload.maxNumber",[r]));if(i.value)return P.warning(d("component.upload.saveWarn"));const m=[];for(const g of s.value){const{status:I,responseData:U}=g;I===v.SUCCESS&&U&&m.push(U.url)}if(m.length<=0)return P.warning(d("component.upload.saveError"));s.value=[],n.value=!1,t("change",m)}function he(){var r;console.log("isUploadingRef",i.value),i.value?P.warning(d("component.upload.uploadWait")):((r=s.value)==null?void 0:r.length)?re({title:d("common.operationTipText"),content:d("component.upload.closeUploadList")}).then(()=>{s.value=[],n.value=!1}).catch(()=>{}):(s.value=[],n.value=!1)}return{visibleRef:n,columns:et(),actionColumn:tt(ve),getHelpText:f,getStringAccept:C,getConfirmButtonProps:pe,getChooseButtonProps:ce,beforeUpload:fe,fileListRef:s,state:c,isUploadingRef:i,handleStartUpload:be,handleOk:W,handleCloseFunc:he,getIsSelectFile:de,getUploadBtnText:me,t:d}}}),at={class:"upload-modal-toolbar"};function st(e,t,n,c,i,s){const o=b("ElButton"),l=b("ElAlert"),a=b("ElUpload"),p=b("FileList"),d=b("BasicModal");return $(),z(d,{visible:e.visibleRef,title:e.t("component.upload.upload"),width:800,onClose:e.handleCloseFunc},{footer:h(()=>[u(o,{onClick:e.handleStartUpload,type:"success",disabled:!e.getIsSelectFile,loading:e.isUploadingRef},{default:h(()=>[E(B(e.getUploadBtnText),1)]),_:1},8,["onClick","disabled","loading"]),u(o,{type:"default",onClick:e.handleCloseFunc},{default:h(()=>[E(B(e.t("common.closeText")),1)]),_:1},8,["onClick"]),u(o,ne(le(e.getConfirmButtonProps)),{default:h(()=>[E(B(e.t("component.upload.save")),1)]),_:1},16)]),default:h(()=>[xe("div",at,[u(l,{title:e.getHelpText,type:"info",closable:!1,class:"upload-modal-toolbar__text"},null,8,["title"]),u(a,{action:"NotUrl",accept:e.getStringAccept,multiple:e.multiple,limit:e.maxNumber,disabled:e.disabled||e.getChooseButtonProps.disabled,"show-file-list":!1,"before-upload":e.beforeUpload,class:"upload-modal-toolbar__btn"},{default:h(()=>[u(o,ne(le(e.getChooseButtonProps)),{default:h(()=>[E(B(e.t("component.upload.choose")),1)]),_:1},16)]),_:1},8,["accept","multiple","limit","disabled","before-upload"])]),u(p,{dataSource:e.fileListRef,columns:e.columns,actionColumn:e.actionColumn},null,8,["dataSource","columns","actionColumn"])]),_:1},8,["visible","title","onClose"])}var it=D(ot,[["render",st]]);const ut=F({components:{ElButton:T,BasicModal:Q,FileList:ue},props:We,emits:["list-change","update:visible","delete"],setup(e,{emit:t}){const{t:n}=k(),c=L(!1),i=L([]);A(()=>e.value,l=>{X(l)||(l=[]),i.value=l.filter(a=>!!a).map(a=>({url:a,type:a.split(".").pop()||"",name:a.split("/").pop()||""}))},{immediate:!0}),te(()=>{c.value=!!e.visible}),A(()=>c.value,l=>{t("update:visible",l)},{immediate:!1});function s(l){const a=i.value.findIndex(p=>p.url===l.url);if(a!==-1){const p=i.value.splice(a,1);t("delete",p[0].url),t("list-change",i.value.map(d=>d.url))}}function o(l){const{url:a}=l;Ve({url:a})}return{t:n,visibleRef:c,fileListRef:i,columns:nt(),actionColumn:lt({handleRemove:s,handleDownload:o})}}});function rt(e,t,n,c,i,s){const o=b("FileList"),l=b("ElButton"),a=b("BasicModal");return $(),z(a,{width:"800px",visible:e.visibleRef,title:e.t("component.upload.preview"),onClose:t[1]||(t[1]=p=>e.visibleRef=!1)},{footer:h(()=>[u(l,{type:"default",onClick:t[0]||(t[0]=p=>e.visibleRef=!1)},{default:h(()=>[E(B(e.t("common.closeText")),1)]),_:1})]),default:h(()=>[u(o,{dataSource:e.fileListRef,columns:e.columns,actionColumn:e.actionColumn},null,8,["dataSource","columns","actionColumn"])]),_:1},8,["visible","title"])}var dt=D(ut,[["render",rt]]);const pt=F({name:"BasicUpload",components:{ElButton:T,ElButtonGroup:ee,ElTooltip:De,UploadModal:it,UploadPreviewModal:dt,Icon:Be},props:He,emits:["change","delete","preview-delete","update:value"],setup(e,{emit:t,attrs:n}){const{t:c}=k(),i=L(!1),s=L(!1),o=L([]),l=_(()=>{const{emptyHidePreview:f}=e;return f&&f?o.value.length>0:!0}),a=_(()=>{const f=N(N({},n),e);return je(f,"onChange","visible","value","showPreviewNumber","emptyHidePreview")});A(()=>e.value,(f=[])=>{o.value=X(f)?f:[]},{immediate:!0});function p(f){o.value=[...R(o),...f||[]],t("update:value",o.value),t("change",o.value)}function d(f){o.value=[...f||[]],t("update:value",o.value),t("change",o.value)}function w(f){t("delete",f)}function C(f){t("preview-delete",f)}return{uploadVisible:i,previewVisible:s,UploadFilled:Me,handleChange:p,handlePreviewChange:d,fileList:o,showPreview:l,bindValue:a,handleDelete:w,handlePreviewDelete:C,t:c}}}),ct=E();function mt(e,t,n,c,i,s){const o=b("ElButton"),l=b("Icon"),a=b("ElTooltip"),p=b("ElButtonGroup"),d=b("UploadModal"),w=b("UploadPreviewModal");return $(),M("div",null,[u(p,null,{default:h(()=>[u(o,{type:"primary",onClick:t[0]||(t[0]=C=>e.uploadVisible=!0),icon:e.UploadFilled},{default:h(()=>[E(B(e.t("component.upload.upload")),1)]),_:1},8,["icon"]),e.showPreview?($(),z(a,{key:0,placement:"bottom"},{content:h(()=>[E(B(e.t("component.upload.uploaded"))+" ",1),e.fileList.length?($(),M(oe,{key:0},[E(B(e.fileList.length),1)],64)):j("",!0)]),default:h(()=>[u(o,{onClick:t[1]||(t[1]=C=>e.previewVisible=!0)},{default:h(()=>[u(l,{icon:"bi:eye",size:"12"}),ct,e.fileList.length&&e.showPreviewNumber?($(),M(oe,{key:0},[E(B(e.fileList.length),1)],64)):j("",!0)]),_:1})]),_:1})):j("",!0)]),_:1}),u(d,ze(e.bindValue,{visible:e.uploadVisible,"onUpdate:visible":t[2]||(t[2]=C=>e.uploadVisible=C),previewFileList:e.fileList,onChange:e.handleChange,onDelete:e.handleDelete}),null,16,["visible","previewFileList","onChange","onDelete"]),u(w,{value:e.fileList,visible:e.previewVisible,"onUpdate:visible":t[3]||(t[3]=C=>e.previewVisible=C),onListChange:e.handlePreviewChange,onDelete:e.handlePreviewDelete},null,8,["value","visible","onListChange","onDelete"])])}var ft=D(pt,[["render",mt]]);const Ct=Pe(ft);export{Ct as B};
