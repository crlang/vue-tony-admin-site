var ye=Object.defineProperty,we=Object.defineProperties;var Ue=Object.getOwnPropertyDescriptors;var Q=Object.getOwnPropertySymbols;var Ce=Object.prototype.hasOwnProperty,Se=Object.prototype.propertyIsEnumerable;var X=(e,t,a)=>t in e?ye(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,B=(e,t)=>{for(var a in t||(t={}))Ce.call(t,a)&&X(e,a,t[a]);if(Q)for(var a of Q(t))Se.call(t,a)&&X(e,a,t[a]);return e},T=(e,t)=>we(e,Ue(t));var I=(e,t,a)=>new Promise((u,l)=>{var d=o=>{try{s(a.next(o))}catch(n){l(n)}},p=o=>{try{s(a.throw(o))}catch(n){l(n)}},s=o=>o.done?u(o.value):Promise.resolve(o.value).then(d,p);s((a=a.apply(e,t)).next())});import{e as $,_ as A,i as Z,f as Re,at as _e,an as J,I as Ee,w as Le}from"./index.ec0491db.js";import{u as Be,B as Y,a as ee,b as te}from"./index.e1f32d21.js";import{l as _,u as R,y as M,Z as v,z as E,A as D,G as O,O as j,R as r,b as G,U as Pe,_ as ke,a as z,a7 as Ne,H as C,P,Q as k,K as $e,D as H,F as ne}from"./ex-pkg-@vue.dfd8e273.js";import{p as oe}from"./propTypes.525da5ca.js";import{ae as Me,af as Fe,ag as W,z as F,a2 as le,ah as Te,ai as Ie,d as Ae}from"./ex-pkg-element-plus.7627c250.js";import{b as De}from"./uuid.2b29000c.js";import{d as Oe}from"./download.de577928.js";import{X as je}from"./ex-pkg-@element-plus.e8ce6c8b.js";import{c4 as ze}from"./ex-pkg-vendor.0d33d667.js";const{t:K}=$();function Ve({acceptRef:e,helpTextRef:t,maxNumberRef:a,maxSizeRef:u}){const l=_(()=>{const s=R(e);return s&&s.length>0?s:[]}),d=_(()=>R(l).map(s=>s.indexOf("/")>0||s.startsWith(".")?s:`.${s}`).join(",")),p=_(()=>{const s=R(t);if(s)return s;const o=[],n=R(e);n.length>0&&o.push(K("component.upload.accept",[n.join(",")]));const m=R(u);m&&o.push(K("component.upload.maxSize",[m]));const g=R(a);return g&&g!==1/0&&o.push(K("component.upload.maxNumber",[g])),o.join("\uFF0C")});return{getAccept:l,getStringAccept:d,getHelpText:p}}var h;(function(e){e.SUCCESS="success",e.ERROR="error",e.UPLOADING="uploading"})(h||(h={}));const ae={api:{type:Function,default:null,required:!0},helpText:{type:String,default:""},maxSize:{type:Number,default:2},maxNumber:{type:Number,default:1/0},accept:{type:Array,default:()=>[]},multiple:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},uploadParams:{type:Object,default:{}}},xe=T(B({},ae),{modelValue:{type:Array,default:()=>[]},showPreviewNumber:{type:Boolean,default:!0},emptyHidePreview:{type:Boolean,default:!1}}),Ge={modelValue:{type:Array,default:()=>[]}},He={columns:{type:[Array],default:null},actionColumn:{type:Object,default:null},dataSource:{type:Array,default:null}};function We(e,t){const a=t.join("|");return new RegExp("\\.("+a+")$","i").test(e.name)}function Ke(e){return se(e.name)}function se(e){return/\.(jpg|jpeg|png|gif|webp|svg)$/i.test(e)}function qe(e){return new Promise((t,a)=>{const u=new FileReader;u.readAsDataURL(e),u.onload=()=>t({result:u.result,file:e}),u.onerror=l=>a(l)})}const Qe=M({components:{ElImage:Me},props:{fileUrl:oe.string.def(""),fileName:oe.string.def("")}}),Xe={class:"thumb"};function Ze(e,t,a,u,l,d){const p=v("ElImage");return E(),D("span",Xe,[e.fileUrl?(E(),O(p,{key:0,src:e.fileUrl,"preview-src-list":[e.fileUrl],width:104},null,8,["src","preview-src-list"])):j("",!0)])}var re=A(Qe,[["render",Ze]]);const{t:b}=$();function Je(){return[{prop:"thumbUrl",label:b("component.upload.legend"),width:100,customRender:({record:e})=>{const{thumbUrl:t}=e||{};return t&&r(re,{fileUrl:t},null)}},{prop:"name",label:b("component.upload.fileName"),align:"left",customRender:({text:e,record:t})=>{const{percent:a,status:u}=t||{};console.log("record",t);let l;return u===h.ERROR?l="exception":u===h.UPLOADING?l="":u===h.SUCCESS&&(l="success"),r("span",null,[r("p",{class:"truncate mb-1",title:e},[e]),r(Fe,{percentage:a,"text-inside":!0,"stroke-width":24,status:l},null)])}},{prop:"size",label:b("component.upload.fileSize"),width:100,customRender:({text:e=0})=>e&&(e/1024).toFixed(2)+"KB"},{prop:"status",label:b("component.upload.fileStatue"),width:100,customRender:({text:e})=>e===h.SUCCESS?r(W,{type:"success"},{default:()=>b("component.upload.uploadSuccess")}):e===h.ERROR?r(W,{type:"danger"},{default:()=>b("component.upload.uploadError")}):e===h.UPLOADING?r(W,null,{default:()=>b("component.upload.uploading")}):e}]}function Ye(e){return{width:120,label:b("component.upload.operating"),prop:"action",fixed:!1,customRender:({record:t})=>r(F,{type:"danger",onClick:e.bind(null,t)},{default:()=>b("component.upload.del")})}}function et(){return[{prop:"url",label:b("component.upload.legend"),width:100,customRender:({record:e})=>{const{url:t}=e||{};return se(t)&&r(re,{fileUrl:t},null)}},{prop:"name",label:b("component.upload.fileName"),align:"left"}]}function tt({handleRemove:e,handleDownload:t}){return{width:200,label:b("component.upload.operating"),prop:"action",fixed:!1,customRender:({record:a})=>r(le,null,{default:()=>[r(F,{type:"danger",onClick:e.bind(null,a)},{default:()=>b("component.upload.del")}),r(F,{type:"success",onClick:t.bind(null,a)},{default:()=>b("component.upload.download")})]})}}var ue=M({name:"FileList",props:He,setup(e){const t=Be();return G(()=>e.dataSource,()=>{Pe(()=>{var a;(a=t==null?void 0:t.redoModalHeight)==null||a.call(t)})}),()=>{const{columns:a,actionColumn:u,dataSource:l}=e,d=[...a,u];return r("table",{class:"file-table"},[r("colgroup",null,[d.map(p=>{const{width:s=0,prop:o}=p,n={width:`${s}px`,minWidth:`${s}px`};return r("col",{style:s?n:{},key:o},null)})]),r("thead",null,[r("tr",{class:"file-table-tr"},[d.map(p=>{const{label:s="",align:o="center",prop:n}=p;return r("th",{class:["file-table-th",o],key:n},[s])})])]),r("tbody",null,[l.map((p={},s)=>r("tr",{class:"file-table-tr",key:`${s+p.name||""}`},[d.map(o=>{const{prop:n="",customRender:m,align:g="center"}=o,L=m&&Z(m);return r("td",{class:["file-table-td",g],key:n},[L?m==null?void 0:m({text:p[n],record:p}):p[n]])})]))])])}}});const nt=M({components:{ElButton:F,ElUpload:Te,ElAlert:Ie,BasicModal:Y,FileList:ue},props:T(B({},ae),{previewFileList:{type:Array,default:()=>[]}}),emits:["change","register","delete"],setup(e,{emit:t}){const a=ke({fileList:[]}),u=z(!1),l=z([]),{accept:d,helpText:p,maxNumber:s,maxSize:o}=Ne(e),{t:n}=$(),[m,{closeModal:g}]=ee(),{getAccept:L,getStringAccept:V,getHelpText:x}=Ve({acceptRef:d,helpTextRef:p,maxNumberRef:s,maxSizeRef:o}),{createMessage:c}=Re(),ie=_(()=>l.value.length>0&&!l.value.every(i=>i.status===h.SUCCESS)),pe=_(()=>{const i=l.value.some(f=>f.status===h.SUCCESS);return{disabled:u.value||l.value.length===0||!i}}),ce=_(()=>{const i=l.value.some(f=>f.status===h.ERROR);return u.value?n("component.upload.uploading"):n(i?"component.upload.reUploadFailed":"component.upload.startUpload")});function de(i){const{size:f,name:y}=i,{maxSize:w,maxNumber:S,previewFileList:U}=e,N=R(L);if(l.value.length+(U==null?void 0:U.length)>=S)return c.warning(n("component.upload.maxNumber",[S]));if(w&&i.size/1024/1024>=w)return c.error(n("component.upload.maxSizeMultiple",[w])),!1;if(N.length>0&&!We(i,N))return c.error(n("component.upload.acceptUpload",[N.join(",")])),!1;const q={uuid:De(),file:i,size:f,name:y,percent:0,type:y.split(".").pop()};return Ke(i)?qe(i).then(({result:be})=>{l.value=[...R(l),B({thumbUrl:be},q)]}):l.value=[...R(l),q],!1}function me(i){const f=l.value.findIndex(y=>y.uuid===i.uuid);f!==-1&&l.value.splice(f,1),t("delete",i)}function fe(i){return I(this,null,function*(){var y;const{api:f}=e;if(!f||!Z(f))return _e("upload api must exist and be a function");try{i.status=h.UPLOADING;const w=function(U){const N=U.loaded/U.total*100|0;i.percent=N},{data:S}=yield(y=e.api)==null?void 0:y.call(e,T(B({},e.uploadParams||{}),{file:i.file}),w);return i.status=h.SUCCESS,i.responseData=S,{success:!0,error:null}}catch(w){return console.log(w),i.status=h.ERROR,{success:!1,error:w}}})}function ge(){return I(this,null,function*(){var f;const{maxNumber:i}=e;if(l.value.length+((f=e.previewFileList)==null?void 0:f.length)>i)return c.warning(n("component.upload.maxNumber",[i]));try{u.value=!0;const y=l.value.filter(U=>U.status!==h.SUCCESS)||[],w=yield Promise.all(y.map(U=>fe(U)));u.value=!1;const S=w.filter(U=>!U.success);if(S.length>0)throw S}catch(y){throw u.value=!1,y}})}function he(){const{maxNumber:i}=e;if(l.value.length>i)return c.warning(n("component.upload.maxNumber",[i]));if(u.value)return c.warning(n("component.upload.saveWarn"));const f=[];for(const y of l.value){const{status:w,responseData:S}=y;w===h.SUCCESS&&S&&f.push(S.url)}if(f.length<=0)return c.warning(n("component.upload.saveError"));l.value=[],g(),t("change",f)}function ve(){return I(this,null,function*(){return u.value?(c.warning(n("component.upload.uploadWait")),!1):(l.value=[],!0)})}return{columns:Je(),actionColumn:Ye(me),register:m,closeModal:g,getHelpText:x,getStringAccept:V,getOkButtonProps:pe,beforeUpload:de,fileListRef:l,state:a,isUploadingRef:u,handleStartUpload:ge,handleOk:he,handleCloseFunc:ve,getIsSelectFile:ie,getUploadBtnText:ce,t:n}}}),ot={class:"upload-modal-toolbar"};function lt(e,t,a,u,l,d){const p=v("el-button"),s=v("ElAlert"),o=v("ElButton"),n=v("ElUpload"),m=v("FileList"),g=v("BasicModal");return E(),O(g,H({title:e.t("component.upload.upload"),okText:e.t("component.upload.save")},e.$attrs,{onRegister:e.register,onOk:e.handleOk,closeFunc:e.handleCloseFunc,maskClosable:!1,keyboard:!1,wrapClassName:"upload-modal",confirmButton:e.getOkButtonProps,cancelButton:{disabled:e.isUploadingRef}}),{centerFooter:C(()=>[r(p,{onClick:e.handleStartUpload,type:"success",disabled:!e.getIsSelectFile,loading:e.isUploadingRef},{default:C(()=>[P(k(e.getUploadBtnText),1)]),_:1},8,["onClick","disabled","loading"])]),default:C(()=>[$e("div",ot,[r(s,{title:e.getHelpText,type:"info",closable:!1,class:"upload-modal-toolbar__text"},null,8,["title"]),r(n,{action:"NotUrl",accept:e.getStringAccept,multiple:e.multiple,limit:e.maxNumber,disabled:e.isUploadingRef||e.fileListRef.length+e.previewFileList.length>=e.maxNumber,"show-file-list":!1,"before-upload":e.beforeUpload,class:"upload-modal-toolbar__btn"},{default:C(()=>[r(o,{type:"primary",disabled:e.isUploadingRef||e.fileListRef.length+e.previewFileList.length>=e.maxNumber},{default:C(()=>[P(k(e.t("component.upload.choose")),1)]),_:1},8,["disabled"])]),_:1},8,["accept","multiple","limit","disabled","before-upload"])]),r(m,{dataSource:e.fileListRef,columns:e.columns,actionColumn:e.actionColumn},null,8,["dataSource","columns","actionColumn"])]),_:1},16,["title","okText","onRegister","onOk","closeFunc","confirmButton","cancelButton"])}var at=A(nt,[["render",lt]]);const st=M({components:{BasicModal:Y,FileList:ue},props:Ge,emits:["list-change","register","delete"],setup(e,{emit:t}){const{t:a}=$(),[u,{closeModal:l}]=ee(),d=z([]);G(()=>e.modelValue,o=>{J(o)||(o=[]),d.value=o.filter(n=>!!n).map(n=>({url:n,type:n.split(".").pop()||"",name:n.split("/").pop()||""}))},{immediate:!0});function p(o){const n=d.value.findIndex(m=>m.url===o.url);if(n!==-1){const m=d.value.splice(n,1);t("delete",m[0].url),t("list-change",d.value.map(g=>g.url))}}function s(o){const{url:n}=o;Oe({url:n})}return{t:a,register:u,closeModal:l,fileListRef:d,columns:et(),actionColumn:tt({handleRemove:p,handleDownload:s})}}});function rt(e,t,a,u,l,d){const p=v("FileList"),s=v("BasicModal");return E(),O(s,H({width:800,title:e.t("component.upload.preview"),wrapClassName:"upload-preview-modal"},e.$attrs,{onRegister:e.register,showConfirm:!1}),{default:C(()=>[r(p,{dataSource:e.fileListRef,columns:e.columns,actionColumn:e.actionColumn},null,8,["dataSource","columns","actionColumn"])]),_:1},16,["title","onRegister"])}var ut=A(st,[["render",rt]]);const it=M({name:"BasicUpload",components:{ElTooltip:Ae,ElButton:F,ElButtonGroup:le,UploadModal:at,UploadPreviewModal:ut,Icon:Ee},props:xe,emits:["change","delete","preview-delete","update:value"],setup(e,{emit:t,attrs:a}){const{t:u}=$(),[l,{openModal:d}]=te(),[p,{openModal:s}]=te(),o=z([]),n=_(()=>{const{emptyHidePreview:c}=e;return c&&c?o.value.length>0:!0}),m=_(()=>{const c=B(B({},a),e);return ze(c,"onChange","modelValue")});G(()=>e.modelValue,(c=[])=>{o.value=J(c)?c:[]},{immediate:!0});function g(c){o.value=[...R(o),...c||[]],t("update:value",o.value),t("change",o.value)}function L(c){o.value=[...c||[]],t("update:value",o.value),t("change",o.value)}function V(c){t("delete",c)}function x(c){t("preview-delete",c)}return{registerUploadModal:l,openUploadModal:d,handleChange:g,handlePreviewChange:L,registerPreviewModal:p,openPreviewModal:s,UploadFilled:je,fileList:o,showPreview:n,bindValue:m,handleDelete:V,handlePreviewDelete:x,t:u}}}),pt=P();function ct(e,t,a,u,l,d){const p=v("ElButton"),s=v("Icon"),o=v("ElTooltip"),n=v("ElButtonGroup"),m=v("UploadModal"),g=v("UploadPreviewModal");return E(),D("div",null,[r(n,null,{default:C(()=>[r(p,{type:"primary",onClick:t[0]||(t[0]=L=>e.openUploadModal()),icon:e.UploadFilled},{default:C(()=>[P(k(e.t("component.upload.upload")),1)]),_:1},8,["icon"]),e.showPreview?(E(),O(o,{key:0,placement:"bottom"},{content:C(()=>[P(k(e.t("component.upload.uploaded"))+" ",1),e.fileList.length?(E(),D(ne,{key:0},[P(k(e.fileList.length),1)],64)):j("",!0)]),default:C(()=>[r(p,{onClick:t[1]||(t[1]=L=>e.openPreviewModal())},{default:C(()=>[r(s,{icon:"bi:eye",size:"12"}),pt,e.fileList.length&&e.showPreviewNumber?(E(),D(ne,{key:0},[P(k(e.fileList.length),1)],64)):j("",!0)]),_:1})]),_:1})):j("",!0)]),_:1}),r(m,H(e.bindValue,{previewFileList:e.fileList,onRegister:e.registerUploadModal,onChange:e.handleChange,onDelete:e.handleDelete}),null,16,["previewFileList","onRegister","onChange","onDelete"]),r(g,{value:e.fileList,onRegister:e.registerPreviewModal,onListChange:e.handlePreviewChange,onDelete:e.handlePreviewDelete},null,8,["value","onRegister","onListChange","onDelete"])])}var dt=A(it,[["render",ct]]);const St=Le(dt);export{St as B};
