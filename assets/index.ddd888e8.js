import{d as I,s as L,r as R,c as D,w as W,aC as z,b as u,h as g,m as A,bC as Z,aD as H,aE as X}from"./index.a812ffa9.js";import{g as F}from"./tsxHelper.25cd2f92.js";import{u as q}from"./useTimeout.3debf569.js";const j={modelValue:{type:Boolean,default:!1},isSlot:{type:Boolean,default:!1},text:{type:String,default:"\u8BF7\u6309\u4F4F\u6ED1\u5757\u62D6\u52A8"},successText:{type:String,default:"\u9A8C\u8BC1\u901A\u8FC7"},height:{type:Number,default:40},width:{type:Number,default:220},circle:{type:Boolean,default:!1},wrapStyle:{type:Object,default:{}},contentStyle:{type:Object,default:{}},barStyle:{type:Object,default:{}},actionStyle:{type:Object,default:{}}},G={...j,src:{type:String},imgSize:{type:Number,default:260},imgWrapStyle:{type:Object,default:{}},minDegree:{type:Number,default:90},maxDegree:{type:Number,default:270},diffDegree:{type:Number,default:20}},k=I({name:"BasicDragVerify",props:j,emits:["success","update:modelValue","change","start","move","end"],setup(r,{emit:m,slots:E,expose:V}){const t=L({isMoving:!1,isPassing:!1,moveDistance:0,toLeft:!1,startTime:0,endTime:0}),s=R(null),h=R(null),b=R(null),v=R(null),{prefixCls:x}=A("basic-drag-verify");document.addEventListener("mouseup",()=>{t.isMoving&&y()});const C=D(()=>{const{height:e,actionStyle:i}=r,o=`${e}px`;return{left:0,width:o,height:o,...i}}),M=D(()=>{const{height:e,width:i,circle:o,wrapStyle:n}=r,c=e;return{width:`${i}px`,height:`${c}px`,lineHeight:`${c}px`,borderRadius:o?`${c/2}px`:0,...n}}),O=D(()=>{const{height:e,circle:i,barStyle:o}=r,n=e;return{height:`${n}px`,borderRadius:i?`${n/2}px 0 0 ${n/2}px`:0,...o}}),P=D(()=>{const{height:e,width:i,contentStyle:o}=r,n=`${e}px`,c=`${i}px`;return{height:n,width:c,...o}});W(()=>t.isPassing,e=>{if(e){const{startTime:i,endTime:o}=t,n=(o-i)/1e3;m("success",{isPassing:e,time:n.toFixed(1)}),m("update:modelValue",e),m("change",e)}}),z(()=>{t.isPassing=!!r.modelValue});function S(e){return e.pageX||e.touches[0].pageX}function a(e){if(t.isPassing)return;const i=u(v);!i||(m("start",e),t.moveDistance=S(e)-parseInt(i.style.left.replace("px",""),10),t.startTime=new Date().getTime(),t.isMoving=!0)}function l(e){const i=parseInt(e.style.width),{width:o}=r,n=o;return{offset:n-i-6,widthNum:n,actionWidth:i}}function f(e){const{isMoving:i,moveDistance:o}=t;if(i){const n=u(v),c=u(h);if(!n||!c)return;const{offset:d,widthNum:$,actionWidth:_}=l(n),w=S(e)-o;m("move",{event:e,moveDistance:o,moveX:w}),w>0&&w<=d?(n.style.left=`${w}px`,c.style.width=`${w+_/2}px`):w>d&&(n.style.left=`${$-_}px`,c.style.width=`${$-_/2}px`,r.isSlot||T())}}function p(e){const{isMoving:i,isPassing:o,moveDistance:n}=t;if(i&&!o){m("end",e);const c=u(v),d=u(h);if(!c||!d)return;const $=S(e)-n,{offset:_,widthNum:w,actionWidth:B}=l(c);$<_?r.isSlot?setTimeout(()=>{if(!r.modelValue)y();else{const N=u(b);N&&(N.style.width=`${parseInt(d.style.width)}px`)}},0):y():(c.style.left=`${w-B}px`,d.style.width=`${w-B/2}px`,T()),t.isMoving=!1}}function T(){if(r.isSlot){y();return}t.endTime=new Date().getTime(),t.isPassing=!0,t.isMoving=!1}function y(){t.isMoving=!1,t.isPassing=!1,t.moveDistance=0,t.toLeft=!1,t.startTime=0,t.endTime=0;const e=u(v),i=u(h),o=u(b);!e||!i||!o||(t.toLeft=!0,setTimeout(()=>{t.toLeft=!1,e.style.left="0",i.style.width="0"},300),o.style.width=u(P).width)}return V({resume:y}),()=>{const e=()=>{const n=[`${x}-bar`];return t.toLeft&&n.push("to-left"),g("div",{class:n,ref:h,style:u(O)},null)},i=()=>{const n=[`${x}-content`],{isPassing:c}=t,{text:d,successText:$}=r;return c&&n.push("success"),g("div",{class:n,ref:b,style:u(P)},[F(E,"text",c)||(c?$:d)])},o=()=>{const n=[`${x}-action`],{toLeft:c,isPassing:d}=t;return c&&n.push("to-left"),g("div",{class:n,onMousedown:a,onTouchstart:a,style:u(C),ref:v},[F(E,"actionIcon",d)||g(Z,{class:`${x}-action__icon`,name:`${d?"check":"doubleright"}`},null)])};return g("div",{class:x,ref:s,style:u(M),onMousemove:f,onTouchmove:f,onMouseleave:p,onMouseup:p,onTouchend:p},[e(),i(),o()])}}});const J=I({name:"RotateDragVerify",inheritAttrs:!1,props:G,emits:["success","change","update:modelValue"],setup(r,{emit:m,attrs:E,expose:V}){const t=R(null),s=L({showTip:!1,isPassing:!1,imgStyle:{},randomRotate:0,currentRotate:0,toOrigin:!1,startTime:0,endTime:0,draged:!1}),{prefixCls:h}=A("basic-img-verify"),b=D(()=>{const{imgWrapStyle:a,imgSize:l}=r;return{width:`${l}px`,height:`${l}px`,...a}}),v=D(()=>{const{minDegree:a,maxDegree:l}=r;return a===l?Math.floor(1+Math.random()*1)/10+1:1});function x(){s.startTime=new Date().getTime()}function C(a){s.draged=!0;const{imgSize:l,height:f,maxDegree:p}=r,{moveX:T}=a,y=Math.ceil(T/(l-f)*p*u(v));s.currentRotate=y,s.imgStyle={transform:`rotateZ(${s.randomRotate-y}deg)`}}function M(){const{minDegree:a,maxDegree:l}=r,f=Math.floor(a+Math.random()*(l-a));s.randomRotate=f,s.imgStyle={transform:`rotateZ(${f}deg)`}}function O(){const{randomRotate:a,currentRotate:l}=s,{diffDegree:f}=r;Math.abs(a-l)>=(f||20)?(s.imgStyle={transform:`rotateZ(${a}deg)`},s.toOrigin=!0,q(()=>{s.toOrigin=!1,s.showTip=!0},300)):P(),s.showTip=!0}function P(){s.isPassing=!0,s.endTime=new Date().getTime()}function S(){s.showTip=!1;const a=u(t);!a||(s.isPassing=!1,a.resume(),M())}return V({resume:S}),W(()=>s.isPassing,a=>{if(a){const{startTime:l,endTime:f}=s,p=(f-l)/1e3;m("success",{isPassing:a,time:p.toFixed(1)}),m("change",a),m("update:modelValue",a)}}),()=>{const{src:a,width:l}=r,{toOrigin:f,isPassing:p,startTime:T,endTime:y}=s,e=[];f&&e.push("to-origin");const i=(y-T)/1e3;return g("div",{class:`${h}`},[g("div",{class:`${h}-img__wrap`,style:u(b)},[g("img",{src:a,onLoad:M,width:l,class:e,style:s.imgStyle,onClick:()=>{S()},alt:"verify"},null),s.showTip&&g("span",{class:[`${h}-img__tip`,s.isPassing?"success":"error"]},[s.isPassing?`\u9A8C\u8BC1\u6821\u9A8C\u6210\u529F,\u8017\u65F6${i.toFixed(1)}\u79D2\uFF01`:"\u9A8C\u8BC1\u5931\u8D25\uFF01"]),!s.showTip&&!s.draged&&g("span",{class:[`${h}-img__tip`,"normal"]},["\u70B9\u51FB\u56FE\u7247\u53EF\u5237\u65B0"])]),g(k,H({class:`${h}-drag__bar`,onMove:C,onEnd:O,onStart:x,ref:t},{...E,...r},{modelValue:p,isSlot:!0}),null)])}}});const Y=X(k),ee=X(J);export{Y as B,ee as R};
