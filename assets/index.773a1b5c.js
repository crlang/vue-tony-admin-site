var Q=Object.defineProperty,Y=Object.defineProperties;var ee=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var te=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable;var k=(t,r,d)=>r in t?Q(t,r,{enumerable:!0,configurable:!0,writable:!0,value:d}):t[r]=d,w=(t,r)=>{for(var d in r||(r={}))te.call(r,d)&&k(t,d,r[d]);if(j)for(var d of j(r))se.call(r,d)&&k(t,d,r[d]);return t},V=(t,r)=>Y(t,ee(r));import{e as X,u as F,ae as ne,a9 as A,x as Z,aU as B,w as H}from"./index.ec0491db.js";import{N as ae,a2 as ie}from"./ex-pkg-@element-plus.e8ce6c8b.js";import{y as U,_ as q,a as E,l as b,b as z,w as oe,R as h,u,D as re}from"./ex-pkg-@vue.dfd8e273.js";const{t:G}=X(),J={value:{type:Boolean,default:!1},isSlot:{type:Boolean,default:!1},text:{type:String,default:G("component.verify.dragText")},successText:{type:String,default:G("component.verify.successText")},height:{type:[Number,String],default:40},width:{type:[Number,String],default:220},circle:{type:Boolean,default:!1},wrapStyle:{type:Object,default:{}},contentStyle:{type:Object,default:{}},barStyle:{type:Object,default:{}},actionStyle:{type:Object,default:{}}},ce=V(w({},J),{src:{type:String},imgWidth:{type:Number,default:260},imgWrapStyle:{type:Object,default:{}},minDegree:{type:Number,default:90},maxDegree:{type:Number,default:270},diffDegree:{type:Number,default:20}});var K=U({name:"BaseDargVerify",props:J,emits:["success","update:value","change","start","move","end"],setup(t,{emit:r,slots:d,expose:O}){const s=q({isMoving:!1,isPassing:!1,moveDistance:0,toLeft:!1,startTime:0,endTime:0}),n=E(null),x=E(null),p=E(null),D=E(null),{prefixCls:T}=F("basic-drag-verify");ne({el:document,name:"mouseup",listener:()=>{s.isMoving&&y()}});const N=b(()=>{const{height:e,actionStyle:i}=t,c=`${parseInt(e)}px`;return w({left:0,width:c,height:c},i)}),W=b(()=>{const{height:e,width:i,circle:c,wrapStyle:a}=t,l=parseInt(e),m=`${parseInt(i)}px`;return w({width:m,height:`${l}px`,lineHeight:`${l}px`,borderRadius:c?l/2+"px":0},a)}),I=b(()=>{const{height:e,circle:i,barStyle:c}=t,a=parseInt(e);return w({height:`${a}px`,borderRadius:i?a/2+"px 0 0 "+a/2+"px":0},c)}),P=b(()=>{const{height:e,width:i,contentStyle:c}=t,a=`${parseInt(e)}px`,l=`${parseInt(i)}px`;return w({height:a,width:l},c)});z(()=>s.isPassing,e=>{if(e){const{startTime:i,endTime:c}=s,a=(c-i)/1e3;r("success",{isPassing:e,time:a.toFixed(1)}),r("update:value",e),r("change",e)}}),oe(()=>{s.isPassing=!!t.value});function $(e){return e.pageX||e.touches[0].pageX}function R(e){if(s.isPassing)return;const i=u(D);!i||(r("start",e),s.moveDistance=$(e)-parseInt(i.style.left.replace("px",""),10),s.startTime=new Date().getTime(),s.isMoving=!0)}function o(e){const i=parseInt(e.style.width),{width:c}=t,a=parseInt(c);return{offset:a-i-6,widthNum:a,actionWidth:i}}function f(e){const{isMoving:i,moveDistance:c}=s;if(i){const a=u(D),l=u(x);if(!a||!l)return;const{offset:m,widthNum:_,actionWidth:M}=o(a),v=$(e)-c;r("move",{event:e,moveDistance:c,moveX:v}),v>0&&v<=m?(a.style.left=`${v}px`,l.style.width=`${v+M/2}px`):v>m&&(a.style.left=`${_-M}px`,l.style.width=`${_-M/2}px`,t.isSlot||S())}}function g(e){const{isMoving:i,isPassing:c,moveDistance:a}=s;if(i&&!c){r("end",e);const l=u(D),m=u(x);if(!l||!m)return;const _=$(e)-a,{offset:M,widthNum:v,actionWidth:C}=o(l);_<M?t.isSlot?setTimeout(()=>{if(!t.value)y();else{const L=u(p);L&&(L.style.width=`${parseInt(m.style.width)}px`)}},0):y():(l.style.left=`${v-C}px`,m.style.width=`${v-C/2}px`,S()),s.isMoving=!1}}function S(){if(t.isSlot){y();return}s.endTime=new Date().getTime(),s.isPassing=!0,s.isMoving=!1}function y(){s.isMoving=!1,s.isPassing=!1,s.moveDistance=0,s.toLeft=!1,s.startTime=0,s.endTime=0;const e=u(D),i=u(x),c=u(p);!e||!i||!c||(s.toLeft=!0,Z(()=>{s.toLeft=!1,e.style.left="0",i.style.width="0"},300),c.style.width=u(P).width)}return O({resume:y}),()=>{const e=()=>{const a=[`${T}-bar`];return s.toLeft&&a.push("to-left"),h("div",{class:a,ref:x,style:u(I)},null)},i=()=>{const a=[`${T}-content`],{isPassing:l}=s,{text:m,successText:_}=t;return l&&a.push("success"),h("div",{class:a,ref:p,style:u(P)},[A(d,"text",l)||(l?_:m)])},c=()=>{const a=[`${T}-action`],{toLeft:l,isPassing:m}=s;return l&&a.push("to-left"),h("div",{class:a,onMousedown:R,onTouchstart:R,style:u(N),ref:D},[A(d,"actionIcon",m)||(m?h(ae,{class:`${T}-action__icon`},null):h(ie,{class:`${T}-action__icon`},null))])};return h("div",{class:T,ref:n,style:u(W),onMousemove:f,onTouchmove:f,onMouseleave:g,onMouseup:g,onTouchend:g},[e(),i(),c()])}}});var le=U({name:"ImgRotateDragVerify",inheritAttrs:!1,props:ce,emits:["success","change","update:value"],setup(t,{emit:r,attrs:d,expose:O}){const s=E(null),n=q({showTip:!1,isPassing:!1,imgStyle:{},randomRotate:0,currentRotate:0,toOrigin:!1,startTime:0,endTime:0,draged:!1}),{t:x}=X(),{prefixCls:p}=F("basic-img-verify");z(()=>n.isPassing,o=>{if(o){const{startTime:f,endTime:g}=n,S=(g-f)/1e3;r("success",{isPassing:o,time:S.toFixed(1)}),r("change",o),r("update:value",o)}});const D=b(()=>{const{imgWrapStyle:o,imgWidth:f}=t;return w({width:`${f}px`,height:`${f}px`},o)}),T=b(()=>{const{minDegree:o,maxDegree:f}=t;return o===f?Math.floor(1+Math.random()*1)/10+1:1});function N(){n.startTime=new Date().getTime()}function W(o){n.draged=!0;const{imgWidth:f,height:g,maxDegree:S}=t,{moveX:y}=o,e=Math.ceil(y/(f-parseInt(g))*S*u(T));n.currentRotate=e,n.imgStyle=B("transform",`rotateZ(${n.randomRotate-e}deg)`)}function I(){const{minDegree:o,maxDegree:f}=t,g=Math.floor(o+Math.random()*(f-o));n.randomRotate=g,n.imgStyle=B("transform",`rotateZ(${g}deg)`)}function P(){const{randomRotate:o,currentRotate:f}=n,{diffDegree:g}=t;Math.abs(o-f)>=(g||20)?(n.imgStyle=B("transform",`rotateZ(${o}deg)`),n.toOrigin=!0,Z(()=>{n.toOrigin=!1,n.showTip=!0},300)):$(),n.showTip=!0}function $(){n.isPassing=!0,n.endTime=new Date().getTime()}function R(){n.showTip=!1;const o=u(s);!o||(n.isPassing=!1,o.resume(),I())}return O({resume:R}),()=>{const{src:o}=t,{toOrigin:f,isPassing:g,startTime:S,endTime:y}=n,e=[];f&&e.push("to-origin");const i=(y-S)/1e3;return h("div",{class:`${p}`},[h("div",{class:`${p}-img__wrap`,style:u(D)},[h("img",{src:o,onLoad:I,width:parseInt(t.width),class:e,style:n.imgStyle,onClick:()=>{R()},alt:"verify"},null),n.showTip&&h("span",{class:[`${p}-img__tip`,n.isPassing?"success":"error"]},[n.isPassing?x("component.verify.time",{time:i.toFixed(1)}):x("component.verify.error")]),!n.showTip&&!n.draged&&h("span",{class:[`${p}-img__tip`,"normal"]},[x("component.verify.redoTip")])]),h(K,re({class:`${p}-drag__bar`,onMove:W,onEnd:P,onStart:N,ref:s},w(w({},d),t),{value:g,isSlot:!0}),null)])}}});const me=H(K),he=H(le);export{me as B,he as R};
