import{c8 as pe,Q as ve,R as B,S as we,L as Oe,d as z,cT as Ue,g5 as st,g6 as at,b7 as Se,C as oe,c6 as lt,r as D,cN as ot,N as Ce,c as P,w as ie,U as Le,Z as ze,o as b,k as I,h as d,i as S,g as A,n as k,b as t,G as ye,b9 as re,l as $,a0 as q,a3 as Ne,f as _,al as se,a1 as rt,a2 as ut,g7 as it,g8 as Me,H as ct,g9 as dt,ga as pt,bw as je,v as ft,x as mt,F as O,bF as vt,bW as gt,I as ge,b3 as fe,a4 as de,g2 as yt,J as Re,dE as ht,gb as bt,aD as me,t as ue,cz as wt,a9 as Ct,gc as kt,bl as Et,T as _e,cA as He,cu as M,at as ke,y as Ve,gd as $t,fl as Ft,fm as St,ge as Lt,ar as Rt,av as _t,K as Ut,gf as Pt,gg as Tt,af as At,aa as Bt,ak as Dt,D as It,b2 as Ot,b8 as Pe,_ as Ee,e as V,z as he,fy as qe,ag as zt,p as Nt,fS as Mt,j as ne,cG as jt,bC as Ht,m as Vt,cF as qt,aE as Xt,u as Gt,fz as Wt}from"./index.a812ffa9.js";import{u as Yt,B as Xe,b as Ge,a as Te}from"./index.80078828.js";import{t as $e,i as Kt,j as Zt}from"./index.fbd5cbb3.js";import{E as We}from"./index.e8746eaf.js";import{E as be}from"./index.68f69cb3.js";import{E as Jt}from"./index.4ba8cdc9.js";import{d as xt}from"./download.72853a59.js";import{E as Qt}from"./index.48be7fd2.js";const en=(e,a)=>{if(!pe||!e||!a)return!1;const s=e.getBoundingClientRect();let n;return a instanceof Element?n=a.getBoundingClientRect():n={top:0,right:window.innerWidth,bottom:window.innerHeight,left:0},s.top<n.bottom&&s.bottom>n.top&&s.right>n.left&&s.left<n.right},tn=ve({urlList:{type:B(Array),default:()=>we([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:{type:Boolean,default:!1},teleported:{type:Boolean,default:!1},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2}}),nn={close:()=>!0,switch:e=>Oe(e)},sn=["src"],an=z({name:"ElImageViewer"}),ln=z({...an,props:tn,emits:nn,setup(e,{expose:a,emit:s}){const n=e,p={CONTAIN:{name:"contain",icon:Ue(st)},ORIGINAL:{name:"original",icon:Ue(at)}},{t:v}=Se(),r=oe("image-viewer"),{nextZIndex:f}=lt(),m=D(),i=D([]),h=ot(),y=D(!0),u=D(n.initialIndex),c=Ce(p.CONTAIN),l=D({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),w=P(()=>{const{urlList:o}=n;return o.length<=1}),F=P(()=>u.value===0),g=P(()=>u.value===n.urlList.length-1),Y=P(()=>n.urlList[u.value]),L=P(()=>{const{scale:o,deg:E,offsetX:R,offsetY:j,enableTransition:J}=l.value;let x=R/o,te=j/o;switch(E%360){case 90:case-270:[x,te]=[te,-x];break;case 180:case-180:[x,te]=[-x,-te];break;case 270:case-90:[x,te]=[-te,x];break}const ce={transform:`scale(${o}) rotate(${E}deg) translate(${x}px, ${te}px)`,transition:J?"transform .3s":""};return c.value.name===p.CONTAIN.name&&(ce.maxWidth=ce.maxHeight="100%"),ce}),X=P(()=>Oe(n.zIndex)?n.zIndex:f());function K(){ae(),s("close")}function G(){const o=$e(R=>{switch(R.code){case de.esc:n.closeOnPressEscape&&K();break;case de.space:W();break;case de.left:U();break;case de.up:T("zoomIn");break;case de.right:N();break;case de.down:T("zoomOut");break}}),E=$e(R=>{const j=R.deltaY||R.deltaX;T(j<0?"zoomIn":"zoomOut",{zoomRate:n.zoomRate,enableTransition:!1})});h.run(()=>{fe(document,"keydown",o),fe(document,"wheel",E)})}function ae(){h.stop()}function le(){y.value=!1}function Q(o){y.value=!1,o.target.alt=v("el.image.error")}function ee(o){if(y.value||o.button!==0||!m.value)return;l.value.enableTransition=!1;const{offsetX:E,offsetY:R}=l.value,j=o.pageX,J=o.pageY,x=$e(ce=>{l.value={...l.value,offsetX:E+ce.pageX-j,offsetY:R+ce.pageY-J}}),te=fe(document,"mousemove",x);fe(document,"mouseup",()=>{te()}),o.preventDefault()}function Z(){l.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function W(){if(y.value)return;const o=yt(p),E=Object.values(p),R=c.value.name,J=(E.findIndex(x=>x.name===R)+1)%o.length;c.value=p[o[J]],Z()}function C(o){const E=n.urlList.length;u.value=(o+E)%E}function U(){F.value&&!n.infinite||C(u.value-1)}function N(){g.value&&!n.infinite||C(u.value+1)}function T(o,E={}){if(y.value)return;const{zoomRate:R,rotateDeg:j,enableTransition:J}={zoomRate:n.zoomRate,rotateDeg:90,enableTransition:!0,...E};switch(o){case"zoomOut":l.value.scale>.2&&(l.value.scale=Number.parseFloat((l.value.scale/R).toFixed(3)));break;case"zoomIn":l.value.scale<7&&(l.value.scale=Number.parseFloat((l.value.scale*R).toFixed(3)));break;case"clockwise":l.value.deg+=j;break;case"anticlockwise":l.value.deg-=j;break}l.value.enableTransition=J}return ie(Y,()=>{Le(()=>{const o=i.value[0];o!=null&&o.complete||(y.value=!0)})}),ie(u,o=>{Z(),s("switch",o)}),ze(()=>{var o,E;G(),(E=(o=m.value)==null?void 0:o.focus)==null||E.call(o)}),a({setActiveItem:C}),(o,E)=>(b(),I(gt,{to:"body",disabled:!o.teleported},[d(vt,{name:"viewer-fade",appear:""},{default:S(()=>[A("div",{ref_key:"wrapper",ref:m,tabindex:-1,class:k(t(r).e("wrapper")),style:ye({zIndex:t(X)})},[A("div",{class:k(t(r).e("mask")),onClick:E[0]||(E[0]=re(R=>o.hideOnClickModal&&K(),["self"]))},null,2),$(" CLOSE "),A("span",{class:k([t(r).e("btn"),t(r).e("close")]),onClick:K},[d(t(q),null,{default:S(()=>[d(t(Ne))]),_:1})],2),$(" ARROW "),t(w)?$("v-if",!0):(b(),_(se,{key:0},[A("span",{class:k([t(r).e("btn"),t(r).e("prev"),t(r).is("disabled",!o.infinite&&t(F))]),onClick:U},[d(t(q),null,{default:S(()=>[d(t(rt))]),_:1})],2),A("span",{class:k([t(r).e("btn"),t(r).e("next"),t(r).is("disabled",!o.infinite&&t(g))]),onClick:N},[d(t(q),null,{default:S(()=>[d(t(ut))]),_:1})],2)],64)),$(" ACTIONS "),A("div",{class:k([t(r).e("btn"),t(r).e("actions")])},[A("div",{class:k(t(r).e("actions__inner"))},[d(t(q),{onClick:E[1]||(E[1]=R=>T("zoomOut"))},{default:S(()=>[d(t(it))]),_:1}),d(t(q),{onClick:E[2]||(E[2]=R=>T("zoomIn"))},{default:S(()=>[d(t(Me))]),_:1}),A("i",{class:k(t(r).e("actions__divider"))},null,2),d(t(q),{onClick:W},{default:S(()=>[(b(),I(ct(t(c).icon)))]),_:1}),A("i",{class:k(t(r).e("actions__divider"))},null,2),d(t(q),{onClick:E[3]||(E[3]=R=>T("anticlockwise"))},{default:S(()=>[d(t(dt))]),_:1}),d(t(q),{onClick:E[4]||(E[4]=R=>T("clockwise"))},{default:S(()=>[d(t(pt))]),_:1})],2)],2),$(" CANVAS "),A("div",{class:k(t(r).e("canvas"))},[(b(!0),_(se,null,je(o.urlList,(R,j)=>ft((b(),_("img",{ref_for:!0,ref:J=>i.value[j]=J,key:R,src:R,style:ye(t(L)),class:k(t(r).e("img")),onLoad:le,onError:Q,onMousedown:ee},null,46,sn)),[[mt,j===u.value]])),128))],2),O(o.$slots,"default")],6)]),_:3})],8,["disabled"]))}});var on=ge(ln,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image-viewer/src/image-viewer.vue"]]);const rn=Re(on),un=["src","loading"],cn={key:0},dn=z({name:"ElImage",inheritAttrs:!1}),pn=z({...dn,props:Kt,emits:Zt,setup(e,{emit:a}){const s=e;let n="";const{t:p}=Se(),v=oe("image"),r=ht(),f=bt(),m=D(),i=D(!1),h=D(!0),y=D(!1),u=D(),c=D(),l=pe&&"loading"in HTMLImageElement.prototype;let w,F;const g=P(()=>r.style),Y=P(()=>{const{fit:o}=s;return pe&&o?{objectFit:o}:{}}),L=P(()=>{const{previewSrcList:o}=s;return Array.isArray(o)&&o.length>0}),X=P(()=>{const{previewSrcList:o,initialIndex:E}=s;let R=E;return E>o.length-1&&(R=0),R}),K=P(()=>s.loading==="eager"?!1:!l&&s.loading==="lazy"||s.lazy),G=()=>{!pe||(h.value=!0,i.value=!1,m.value=s.src)};function ae(o){h.value=!1,i.value=!1,a("load",o)}function le(o){h.value=!1,i.value=!0,a("error",o)}function Q(){en(u.value,c.value)&&(G(),W())}const ee=Et(Q,200);async function Z(){var o;if(!pe)return;await Le();const{scrollContainer:E}=s;wt(E)?c.value=E:Ct(E)&&E!==""?c.value=(o=document.querySelector(E))!=null?o:void 0:u.value&&(c.value=kt(u.value)),c.value&&(w=fe(c,"scroll",ee),setTimeout(()=>Q(),100))}function W(){!pe||!c.value||!ee||(w==null||w(),c.value=void 0)}function C(o){if(!!o.ctrlKey){if(o.deltaY<0)return o.preventDefault(),!1;if(o.deltaY>0)return o.preventDefault(),!1}}function U(){!L.value||(F=fe("wheel",C,{passive:!1}),n=document.body.style.overflow,document.body.style.overflow="hidden",y.value=!0,a("show"))}function N(){F==null||F(),document.body.style.overflow=n,y.value=!1,a("close")}function T(o){a("switch",o)}return ie(()=>s.src,()=>{K.value?(h.value=!0,i.value=!1,W(),Z()):G()}),ze(()=>{K.value?Z():G()}),(o,E)=>(b(),_("div",{ref_key:"container",ref:u,class:k([t(v).b(),o.$attrs.class]),style:ye(t(g))},[m.value!==void 0&&!i.value?(b(),_("img",me({key:0},t(f),{src:m.value,loading:o.loading,style:t(Y),class:[t(v).e("inner"),t(L)&&t(v).e("preview"),h.value&&t(v).is("loading")],onClick:U,onLoad:ae,onError:le}),null,16,un)):$("v-if",!0),h.value||i.value?(b(),_("div",{key:1,class:k(t(v).e("wrapper"))},[h.value?O(o.$slots,"placeholder",{key:0},()=>[A("div",{class:k(t(v).e("placeholder"))},null,2)]):i.value?O(o.$slots,"error",{key:1},()=>[A("div",{class:k(t(v).e("error"))},ue(t(p)("el.image.error")),3)]):$("v-if",!0)],2)):$("v-if",!0),t(L)?(b(),_(se,{key:2},[y.value?(b(),I(t(rn),{key:0,"z-index":o.zIndex,"initial-index":t(X),infinite:o.infinite,"zoom-rate":o.zoomRate,"url-list":o.previewSrcList,"hide-on-click-modal":o.hideOnClickModal,teleported:o.previewTeleported,"close-on-press-escape":o.closeOnPressEscape,onClose:N,onSwitch:T},{default:S(()=>[o.$slots.viewer?(b(),_("div",cn,[O(o.$slots,"viewer")])):$("v-if",!0)]),_:3},8,["z-index","initial-index","infinite","zoom-rate","url-list","hide-on-click-modal","teleported","close-on-press-escape"])):$("v-if",!0)],64)):$("v-if",!0)],6))}});var fn=ge(pn,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image/src/image.vue"]]);const mn=Re(fn),Ye=Symbol("uploadContextKey"),vn="ElUpload";class gn extends Error{constructor(a,s,n,p){super(a),this.name="UploadAjaxError",this.status=s,this.method=n,this.url=p}}function Ae(e,a,s){let n;return s.response?n=`${s.response.error||s.response}`:s.responseText?n=`${s.responseText}`:n=`fail to ${a.method} ${e} ${s.status}`,new gn(n,s.status,a.method,e)}function yn(e){const a=e.responseText||e.response;if(!a)return a;try{return JSON.parse(a)}catch(s){return a}}const hn=e=>{typeof XMLHttpRequest>"u"&&_e(vn,"XMLHttpRequest is undefined");const a=new XMLHttpRequest,s=e.action;a.upload&&a.upload.addEventListener("progress",v=>{const r=v;r.percent=v.total>0?v.loaded/v.total*100:0,e.onProgress(r)});const n=new FormData;if(e.data)for(const[v,r]of Object.entries(e.data))Array.isArray(r)?n.append(v,...r):n.append(v,r);n.append(e.filename,e.file,e.file.name),a.addEventListener("error",()=>{e.onError(Ae(s,e,a))}),a.addEventListener("load",()=>{if(a.status<200||a.status>=300)return e.onError(Ae(s,e,a));e.onSuccess(yn(a))}),a.open(e.method,s,!0),e.withCredentials&&"withCredentials"in a&&(a.withCredentials=!0);const p=e.headers||{};if(p instanceof Headers)p.forEach((v,r)=>a.setRequestHeader(r,v));else for(const[v,r]of Object.entries(p))He(r)||a.setRequestHeader(v,String(r));return a.send(n),a},Ke=["text","picture","picture-card"];let bn=1;const Fe=()=>Date.now()+bn++,Ze=ve({action:{type:String,default:"#"},headers:{type:B(Object)},method:{type:String,default:"post"},data:{type:Object,default:()=>we({})},multiple:{type:Boolean,default:!1},name:{type:String,default:"file"},drag:{type:Boolean,default:!1},withCredentials:Boolean,showFileList:{type:Boolean,default:!0},accept:{type:String,default:""},type:{type:String,default:"select"},fileList:{type:B(Array),default:()=>we([])},autoUpload:{type:Boolean,default:!0},listType:{type:String,values:Ke,default:"text"},httpRequest:{type:B(Function),default:hn},disabled:Boolean,limit:Number}),wn=ve({...Ze,beforeUpload:{type:B(Function),default:M},beforeRemove:{type:B(Function)},onRemove:{type:B(Function),default:M},onChange:{type:B(Function),default:M},onPreview:{type:B(Function),default:M},onSuccess:{type:B(Function),default:M},onProgress:{type:B(Function),default:M},onError:{type:B(Function),default:M},onExceed:{type:B(Function),default:M}}),Cn=ve({files:{type:B(Array),default:()=>we([])},disabled:{type:Boolean,default:!1},handlePreview:{type:B(Function),default:M},listType:{type:String,values:Ke,default:"text"}}),kn={remove:e=>!!e},En=["onKeydown"],$n=["src"],Fn=["onClick"],Sn=["onClick"],Ln=["onClick"],Rn=z({name:"ElUploadList"}),_n=z({...Rn,props:Cn,emits:kn,setup(e,{emit:a}){const{t:s}=Se(),n=oe("upload"),p=oe("icon"),v=oe("list"),r=ke(),f=D(!1),m=i=>{a("remove",i)};return(i,h)=>(b(),I(Rt,{tag:"ul",class:k([t(n).b("list"),t(n).bm("list",i.listType),t(n).is("disabled",t(r))]),name:t(v).b()},{default:S(()=>[(b(!0),_(se,null,je(i.files,y=>(b(),_("li",{key:y.uid||y.name,class:k([t(n).be("list","item"),t(n).is(y.status),{focusing:f.value}]),tabindex:"0",onKeydown:Ve(u=>!t(r)&&m(y),["delete"]),onFocus:h[0]||(h[0]=u=>f.value=!0),onBlur:h[1]||(h[1]=u=>f.value=!1),onClick:h[2]||(h[2]=u=>f.value=!1)},[O(i.$slots,"default",{file:y},()=>[i.listType==="picture"||y.status!=="uploading"&&i.listType==="picture-card"?(b(),_("img",{key:0,class:k(t(n).be("list","item-thumbnail")),src:y.url,alt:""},null,10,$n)):$("v-if",!0),y.status==="uploading"||i.listType!=="picture-card"?(b(),_("div",{key:1,class:k(t(n).be("list","item-info"))},[A("a",{class:k(t(n).be("list","item-name")),onClick:re(u=>i.handlePreview(y),["prevent"])},[d(t(q),{class:k(t(p).m("document"))},{default:S(()=>[d(t($t))]),_:1},8,["class"]),A("span",{class:k(t(n).be("list","item-file-name"))},ue(y.name),3)],10,Fn),y.status==="uploading"?(b(),I(t(We),{key:0,type:i.listType==="picture-card"?"circle":"line","stroke-width":i.listType==="picture-card"?6:2,percentage:Number(y.percentage),style:ye(i.listType==="picture-card"?"":"margin-top: 0.5rem")},null,8,["type","stroke-width","percentage","style"])):$("v-if",!0)],2)):$("v-if",!0),A("label",{class:k(t(n).be("list","item-status-label"))},[i.listType==="text"?(b(),I(t(q),{key:0,class:k([t(p).m("upload-success"),t(p).m("circle-check")])},{default:S(()=>[d(t(Ft))]),_:1},8,["class"])):["picture-card","picture"].includes(i.listType)?(b(),I(t(q),{key:1,class:k([t(p).m("upload-success"),t(p).m("check")])},{default:S(()=>[d(t(St))]),_:1},8,["class"])):$("v-if",!0)],2),t(r)?$("v-if",!0):(b(),I(t(q),{key:2,class:k(t(p).m("close")),onClick:u=>m(y)},{default:S(()=>[d(t(Ne))]),_:2},1032,["class","onClick"])),$(" Due to close btn only appears when li gets focused disappears after li gets blurred, thus keyboard navigation can never reach close btn"),$(" This is a bug which needs to be fixed "),$(" TODO: Fix the incorrect navigation interaction "),t(r)?$("v-if",!0):(b(),_("i",{key:3,class:k(t(p).m("close-tip"))},ue(t(s)("el.upload.deleteTip")),3)),i.listType==="picture-card"?(b(),_("span",{key:4,class:k(t(n).be("list","item-actions"))},[A("span",{class:k(t(n).be("list","item-preview")),onClick:u=>i.handlePreview(y)},[d(t(q),{class:k(t(p).m("zoom-in"))},{default:S(()=>[d(t(Me))]),_:1},8,["class"])],10,Sn),t(r)?$("v-if",!0):(b(),_("span",{key:0,class:k(t(n).be("list","item-delete")),onClick:u=>m(y)},[d(t(q),{class:k(t(p).m("delete"))},{default:S(()=>[d(t(Lt))]),_:1},8,["class"])],10,Ln))],2)):$("v-if",!0)])],42,En))),128)),O(i.$slots,"append")]),_:3},8,["class","name"]))}});var Be=ge(_n,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-list.vue"]]);const Un=ve({disabled:{type:Boolean,default:!1}}),Pn={file:e=>_t(e)},Tn=["onDrop","onDragover"],Je="ElUploadDrag",An=z({name:Je}),Bn=z({...An,props:Un,emits:Pn,setup(e,{emit:a}){const s=Ut(Ye);s||_e(Je,"usage: <el-upload><el-upload-dragger /></el-upload>");const n=oe("upload"),p=D(!1),v=ke(),r=m=>{if(v.value)return;p.value=!1,m.stopPropagation();const i=Array.from(m.dataTransfer.files),h=s.accept.value;if(!h){a("file",i);return}const y=i.filter(u=>{const{type:c,name:l}=u,w=l.includes(".")?`.${l.split(".").pop()}`:"",F=c.replace(/\/.*$/,"");return h.split(",").map(g=>g.trim()).filter(g=>g).some(g=>g.startsWith(".")?w===g:/\/\*$/.test(g)?F===g.replace(/\/\*$/,""):/^[^/]+\/[^/]+$/.test(g)?c===g:!1)});a("file",y)},f=()=>{v.value||(p.value=!0)};return(m,i)=>(b(),_("div",{class:k([t(n).b("dragger"),t(n).is("dragover",p.value)]),onDrop:re(r,["prevent"]),onDragover:re(f,["prevent"]),onDragleave:i[0]||(i[0]=re(h=>p.value=!1,["prevent"]))},[O(m.$slots,"default")],42,Tn))}});var Dn=ge(Bn,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-dragger.vue"]]);const In=ve({...Ze,beforeUpload:{type:B(Function),default:M},onRemove:{type:B(Function),default:M},onStart:{type:B(Function),default:M},onSuccess:{type:B(Function),default:M},onProgress:{type:B(Function),default:M},onError:{type:B(Function),default:M},onExceed:{type:B(Function),default:M}}),On=["onKeydown"],zn=["name","multiple","accept"],Nn=z({name:"ElUploadContent",inheritAttrs:!1}),Mn=z({...Nn,props:In,setup(e,{expose:a}){const s=e,n=oe("upload"),p=ke(),v=Ce({}),r=Ce(),f=l=>{if(l.length===0)return;const{autoUpload:w,limit:F,fileList:g,multiple:Y,onStart:L,onExceed:X}=s;if(F&&g.length+l.length>F){X(l,g);return}Y||(l=l.slice(0,1));for(const K of l){const G=K;G.uid=Fe(),L(G),w&&m(G)}},m=async l=>{if(r.value.value="",!s.beforeUpload)return i(l);let w;try{w=await s.beforeUpload(l)}catch(g){w=!1}if(w===!1){s.onRemove(l);return}let F=l;w instanceof Blob&&(w instanceof File?F=w:F=new File([w],l.name,{type:l.type})),i(Object.assign(F,{uid:l.uid}))},i=l=>{const{headers:w,data:F,method:g,withCredentials:Y,name:L,action:X,onProgress:K,onSuccess:G,onError:ae,httpRequest:le}=s,{uid:Q}=l,ee={headers:w||{},withCredentials:Y,file:l,data:F,method:g,filename:L,action:X,onProgress:W=>{K(W,l)},onSuccess:W=>{G(W,l),delete v.value[Q]},onError:W=>{ae(W,l),delete v.value[Q]}},Z=le(ee);v.value[Q]=Z,Z instanceof Promise&&Z.then(ee.onSuccess,ee.onError)},h=l=>{const w=l.target.files;!w||f(Array.from(w))},y=()=>{p.value||(r.value.value="",r.value.click())},u=()=>{y()};return a({abort:l=>{Pt(v.value).filter(l?([F])=>String(l.uid)===F:()=>!0).forEach(([F,g])=>{g instanceof XMLHttpRequest&&g.abort(),delete v.value[F]})},upload:m}),(l,w)=>(b(),_("div",{class:k([t(n).b(),t(n).m(l.listType),t(n).is("drag",l.drag)]),tabindex:"0",onClick:y,onKeydown:Ve(re(u,["self"]),["enter","space"])},[l.drag?(b(),I(Dn,{key:0,disabled:t(p),onFile:f},{default:S(()=>[O(l.$slots,"default")]),_:3},8,["disabled"])):O(l.$slots,"default",{key:1}),A("input",{ref_key:"inputRef",ref:r,class:k(t(n).e("input")),name:l.name,multiple:l.multiple,accept:l.accept,type:"file",onChange:h,onClick:w[0]||(w[0]=re(()=>{},["stop"]))},null,42,zn)],42,On))}});var De=ge(Mn,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-content.vue"]]);const Ie="ElUpload",jn=e=>{var a;(a=e.url)!=null&&a.startsWith("blob:")&&URL.revokeObjectURL(e.url)},Hn=(e,a)=>{const s=Tt(e,"fileList",void 0,{passive:!0}),n=u=>s.value.find(c=>c.uid===u.uid);function p(u){var c;(c=a.value)==null||c.abort(u)}function v(u=["ready","uploading","success","fail"]){s.value=s.value.filter(c=>!u.includes(c.status))}const r=(u,c)=>{const l=n(c);!l||(l.status="fail",s.value.splice(s.value.indexOf(l),1),e.onError(u,l,s.value),e.onChange(l,s.value))},f=(u,c)=>{const l=n(c);!l||(e.onProgress(u,l,s.value),l.status="uploading",l.percentage=Math.round(u.percent))},m=(u,c)=>{const l=n(c);!l||(l.status="success",l.response=u,e.onSuccess(u,l,s.value),e.onChange(l,s.value))},i=u=>{He(u.uid)&&(u.uid=Fe());const c={name:u.name,percentage:0,status:"ready",size:u.size,raw:u,uid:u.uid};if(e.listType==="picture-card"||e.listType==="picture")try{c.url=URL.createObjectURL(u)}catch(l){At(Ie,l.message),e.onError(l,c,s.value)}s.value=[...s.value,c],e.onChange(c,s.value)},h=async u=>{const c=u instanceof File?n(u):u;c||_e(Ie,"file to be removed not found");const l=w=>{p(w);const F=s.value;F.splice(F.indexOf(w),1),e.onRemove(w,F),jn(w)};e.beforeRemove?await e.beforeRemove(c,s.value)!==!1&&l(c):l(c)};function y(){s.value.filter(({status:u})=>u==="ready").forEach(({raw:u})=>{var c;return u&&((c=a.value)==null?void 0:c.upload(u))})}return ie(()=>e.listType,u=>{u!=="picture-card"&&u!=="picture"||(s.value=s.value.map(c=>{const{raw:l,url:w}=c;if(!w&&l)try{c.url=URL.createObjectURL(l)}catch(F){e.onError(F,c,s.value)}return c}))}),ie(s,u=>{for(const c of u)c.uid||(c.uid=Fe()),c.status||(c.status="success")},{immediate:!0,deep:!0}),{uploadFiles:s,abort:p,clearFiles:v,handleError:r,handleProgress:f,handleStart:i,handleSuccess:m,handleRemove:h,submit:y}},Vn=z({name:"ElUpload"}),qn=z({...Vn,props:wn,setup(e,{expose:a}){const s=e,n=Bt(),p=ke(),v=Ce(),{abort:r,submit:f,clearFiles:m,uploadFiles:i,handleStart:h,handleError:y,handleRemove:u,handleSuccess:c,handleProgress:l}=Hn(s,v),w=P(()=>s.listType==="picture-card"),F=P(()=>({...s,fileList:i.value,onStart:h,onProgress:l,onSuccess:c,onError:y,onRemove:u}));return Dt(()=>{i.value.forEach(({url:g})=>{g!=null&&g.startsWith("blob:")&&URL.revokeObjectURL(g)})}),It(Ye,{accept:Ot(s,"accept")}),a({abort:r,submit:f,clearFiles:m,handleStart:h,handleRemove:u}),(g,Y)=>(b(),_("div",null,[t(w)&&g.showFileList?(b(),I(Be,{key:0,disabled:t(p),"list-type":g.listType,files:t(i),"handle-preview":g.onPreview,onRemove:t(u)},Pe({append:S(()=>[d(De,me({ref_key:"uploadRef",ref:v},t(F)),{default:S(()=>[t(n).trigger?O(g.$slots,"trigger",{key:0}):$("v-if",!0),!t(n).trigger&&t(n).default?O(g.$slots,"default",{key:1}):$("v-if",!0)]),_:3},16)]),_:2},[g.$slots.file?{name:"default",fn:S(({file:L})=>[O(g.$slots,"file",{file:L})])}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):$("v-if",!0),!t(w)||t(w)&&!g.showFileList?(b(),I(De,me({key:1,ref_key:"uploadRef",ref:v},t(F)),{default:S(()=>[t(n).trigger?O(g.$slots,"trigger",{key:0}):$("v-if",!0),!t(n).trigger&&t(n).default?O(g.$slots,"default",{key:1}):$("v-if",!0)]),_:3},16)):$("v-if",!0),g.$slots.trigger?O(g.$slots,"default",{key:2}):$("v-if",!0),O(g.$slots,"tip"),!t(w)&&g.showFileList?(b(),I(Be,{key:3,disabled:t(p),"list-type":g.listType,files:t(i),"handle-preview":g.onPreview,onRemove:t(u)},Pe({_:2},[g.$slots.file?{name:"default",fn:S(({file:L})=>[O(g.$slots,"file",{file:L})])}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):$("v-if",!0)]))}});var Xn=ge(qn,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload.vue"]]);const Gn=Re(Xn);var H=(e=>(e.SUCCESS="success",e.ERROR="error",e.UPLOADING="uploading",e))(H||{});const xe={api:{type:Function,default:null,required:!0},uploadName:{type:String,default:"file",required:!0},helpText:{type:String,default:""},maxSize:{type:Number,default:2},maxNumber:{type:Number,default:1/0},accept:{type:Array,default:()=>[]},multiple:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},uploadParams:{type:Object,default:{}}},Qe={modelValue:{type:Array,default:()=>[]},showThumb:{type:Boolean,default:!1},thumbSize:{type:Number,default:200},showPreview:{type:Boolean,default:!0},showPreviewNumber:{type:Boolean,default:!0},emptyHidePreview:{type:Boolean,default:!1}},Wn={...xe,...Qe};function Yn(e,a){const s=a.join("|");return new RegExp(`\\.(${s})$`,"i").test(e.name)}function Kn(e){return et(e.name)}function et(e){return/\.(jpg|jpeg|png|gif|webp|svg)$/i.test(e)}function Zn(e){return new Promise((a,s)=>{const n=new FileReader;n.readAsDataURL(e),n.onload=()=>a({result:n.result,file:e}),n.onerror=p=>s(p)})}function Jn({acceptRef:e,helpTextRef:a,maxNumberRef:s,maxSizeRef:n}){const p=P(()=>{const f=t(e);return f&&f.length>0?f:[]}),v=P(()=>t(p).map(f=>f.indexOf("/")>0||f.startsWith(".")?f:`.${f}`).join(",")),r=P(()=>{const f=t(a);if(f)return f;const m=[],i=t(e);i.length>0&&m.push(`\u652F\u6301${i.join(",")}\u683C\u5F0F`);const h=t(n);h&&m.push(`\u5355\u4E2A\u6587\u4EF6\u4E0D\u8D85\u8FC7${h}MB`);const y=t(s);return y&&y!==1/0&&m.push(`\u6700\u591A\u53EA\u80FD\u4E0A\u4F20${y}\u4E2A\u6587\u4EF6`),m.join("\uFF0C")});return{getAccept:p,getStringAccept:v,getHelpText:r}}const xn=z({name:"UploadThumb",components:{ElImage:mn},props:{url:String}});function Qn(e,a,s,n,p,v){const r=V("ElImage");return e.url?(b(),I(r,{key:0,src:e.url,fit:"cover","preview-src-list":[e.url],style:{width:"100px",height:"100px"}},null,8,["src","preview-src-list"])):$("",!0)}const tt=Ee(xn,[["render",Qn]]);function es(){return[{prop:"thumbUrl",label:"\u7565\u7F29\u56FE",width:100,customRender:({record:e})=>{const{thumbUrl:a}=e||{};return a&&d(tt,{url:a},null)}},{prop:"name",label:"\u6587\u4EF6\u540D",align:"left",customRender:({text:e,record:a})=>{const{percent:s,status:n}=a||{};let p;return n===H.ERROR?p="exception":n===H.UPLOADING?p="":n===H.SUCCESS&&(p="success"),d("span",null,[d("p",{class:"truncate mb-1",title:e},[e]),d(We,{percentage:s,"text-inside":!0,"stroke-width":24,status:p},null)])}},{prop:"size",label:"\u6587\u4EF6\u5927\u5C0F",width:100,customRender:({text:e=0})=>e&&`${(e/1024).toFixed(2)}KB`},{prop:"status",label:"\u72B6\u6001",width:100,customRender:({text:e})=>e===H.SUCCESS?d(be,{type:"success"},{default:()=>"\u4E0A\u4F20\u6210\u529F"}):e===H.ERROR?d(be,{type:"danger"},{default:()=>"\u4E0A\u4F20\u5931\u8D25"}):e===H.UPLOADING?d(be,null,{default:()=>"\u4E0A\u4F20\u4E2D"}):d(be,{type:"info"},{default:()=>"\u5F85\u4E0A\u4F20"})}]}function ts(e){return{width:120,label:"\u64CD\u4F5C",prop:"action",fixed:!1,customRender:({record:a})=>d(he,{type:"danger",onClick:e.bind(null,a)},{default:()=>"\u5220\u9664"})}}function ns(){return[{prop:"url",label:"\u7565\u7F29\u56FE",width:100,customRender:({record:e})=>{const{url:a}=e||{};return et(a)&&d(tt,{url:a},null)}},{prop:"name",label:"\u6587\u4EF6\u540D",align:"left"}]}function ss({handleRemove:e,handleDownload:a}){return{width:200,label:"\u64CD\u4F5C",prop:"action",fixed:!1,customRender:({record:s})=>d(qe,null,{default:()=>[d(he,{type:"danger",onClick:e.bind(null,s)},{default:()=>"\u5220\u9664"}),d(he,{type:"success",onClick:a.bind(null,s)},{default:()=>"\u4E0B\u8F7D"})]})}}const nt=z({name:"FileList",props:{columns:{type:Array,default:null},actionColumn:{type:Object,default:null},dataSource:{type:Array,default:null}},setup(e){const a=Yt();return ie(()=>e.dataSource,()=>{Le(()=>{var s;(s=a==null?void 0:a.redoModalHeight)==null||s.call(a)})}),()=>{const{columns:s,actionColumn:n,dataSource:p}=e,v=[...s,n];return d("table",{class:"basic-upload-file-table"},[d("colgroup",null,[v.map(r=>{const{width:f=0,prop:m}=r,i={width:`${f}px`,minWidth:`${f}px`};return d("col",{style:f?i:{},key:m},null)})]),d("thead",null,[d("tr",null,[v.map(r=>{const{label:f="",align:m="center",prop:i}=r;return d("th",{class:m,key:i},[f])})])]),d("tbody",null,[p.map((r={},f)=>d("tr",{key:`${f+r.name||""}`},[v.map(m=>{const{prop:i="",customRender:h,align:y="center"}=m;return d("td",{class:y,key:i},[typeof h=="function"?h==null?void 0:h({text:r[i],record:r}):r[i]])})]))])])}}});const as=z({components:{ElButton:he,ElUpload:Gn,ElAlert:Jt,BasicModal:Xe,FileList:nt},props:{...xe,prefixCls:String},emits:["change","register","delete"],setup(e,{emit:a}){const s=D(!1),n=D([]),p=D([]),{accept:v,helpText:r,maxNumber:f,maxSize:m}=zt(e),[i,{closeModal:h}]=Ge(C=>{p.value=C||[]}),{getAccept:y,getStringAccept:u,getHelpText:c}=Jn({acceptRef:v,helpTextRef:r,maxNumberRef:f,maxSizeRef:m}),{createMessage:l}=Nt(),w=P(()=>n.value.length>0&&!n.value.every(C=>C.status===H.SUCCESS)),F=P(()=>{const C=n.value.some(U=>U.status===H.SUCCESS);return{btnText:"\u4FDD\u5B58",type:"primary",disabled:s.value||n.value.length===0||!C}}),g=P(()=>({btnText:"\u5173\u95ED",disabled:s.value})),Y=P(()=>s.value||n.value.length+p.value.length>=f.value),L=P(()=>{const C=n.value.some(U=>U.status===H.ERROR);return s.value?"\u4E0A\u4F20\u4E2D":C?"\u91CD\u65B0\u4E0A\u4F20\u5931\u8D25\u6587\u4EF6":"\u5F00\u59CB\u4E0A\u4F20"});function X(){return n.value.length+p.value.length>f.value?(l.warning(`\u6700\u591A\u53EA\u80FD\u4E0A\u4F20${f.value}\u4E2A\u6587\u4EF6`),!1):!0}function K(C){const U=t(y);return U.length>0&&!Yn(C,U)?(l.error(`\u53EA\u80FD\u4E0A\u4F20${U.join(",")}\u683C\u5F0F\u6587\u4EF6`),!1):!0}function G(C=0){return m.value&&C/1024/1024>=m.value?(l.error(`\u53EA\u80FD\u4E0A\u4F20\u4E0D\u8D85\u8FC7${m}MB\u7684\u6587\u4EF6!`),!1):!0}function ae(C){const{size:U,name:N}=C;if(!X()||!G(C.size||0)||!K(C))return;const T={uuid:Mt(),file:C,size:U,name:N,percent:0,type:N.split(".").pop()};return Kn(C)?Zn(C).then(({result:o})=>{n.value=[...t(n),{thumbUrl:o,...T}]}):n.value=[...t(n),T],!1}function le(C){const U=n.value.findIndex(N=>N.uuid===C.uuid);U!==-1&&n.value.splice(U,1),a("delete",C)}async function Q(C){const{api:U,uploadName:N,uploadParams:T}=e;if(!U||typeof U!="function")return jt("upload api must exist and be a function");try{C.status=H.UPLOADING;const o=function(j){const J=j.loaded/j.total*100|0;C.percent=J},E=T||{};E.file=C.file,E[N]=C.file;const{data:R}=await U(E,o);return C.status=H.SUCCESS,C.responseData=R,{success:!0,error:null}}catch(o){return C.status=H.ERROR,{success:!1,error:o}}}async function ee(){if(!!X())try{s.value=!0;const C=n.value.filter(T=>T.status!==H.SUCCESS)||[],U=await Promise.all(C.map(T=>Q(T)));s.value=!1;const N=U.filter(T=>!T.success);if(N.length>0)throw N}catch(C){throw s.value=!1,C}}function Z(){if(!X())return;if(s.value)return l.warning("\u8BF7\u7B49\u5F85\u6587\u4EF6\u4E0A\u4F20\u540E\uFF0C\u4FDD\u5B58!");const C=[];for(const U of n.value){const{status:N,responseData:T}=U;N===H.SUCCESS&&T&&C.push(T.url)}if(C.length<=0)return l.warning("\u6CA1\u6709\u4E0A\u4F20\u6210\u529F\u7684\u6587\u4EF6\uFF0C\u65E0\u6CD5\u4FDD\u5B58!");n.value=[],h(),a("change",C)}async function W(){return s.value?(l.warning("\u8BF7\u7B49\u5F85\u6587\u4EF6\u4E0A\u4F20\u7ED3\u675F\u540E\u64CD\u4F5C"),!1):(n.value=[],!0)}return{columns:es(),actionColumn:ts(le),register:i,closeModal:h,getHelpText:c,getStringAccept:u,getConfirmProps:F,getCancelProps:g,beforeUpload:ae,getUploadState:Y,fileListRef:n,isUploadingRef:s,handleStartUpload:ee,handleConfirm:Z,handleCloseFn:W,getIsSelectFile:w,getUploadBtnText:L}}}),ls={style:{display:"flex","align-items":"center","margin-bottom":"8px"}};function os(e,a,s,n,p,v){const r=V("el-button"),f=V("ElAlert"),m=V("ElButton"),i=V("ElUpload"),h=V("FileList"),y=V("BasicModal");return b(),I(y,me({title:"\u4E0A\u4F20"},e.$attrs,{"close-on-click-modal":!1,"close-on-press-escape":!1,class:"upload-modal",onRegister:e.register,onConfirm:e.handleConfirm,closeFn:e.handleCloseFn,"confirm-options":e.getConfirmProps,"cancel-options":e.getCancelProps}),{centerFooter:S(()=>[d(r,{onClick:e.handleStartUpload,type:"success",disabled:!e.getIsSelectFile,loading:e.isUploadingRef},{default:S(()=>[ne(ue(e.getUploadBtnText),1)]),_:1},8,["onClick","disabled","loading"])]),default:S(()=>[A("div",ls,[d(f,{title:e.getHelpText,type:"info",closable:!1},null,8,["title"]),d(i,{action:"emptyUrl",accept:e.getStringAccept,multiple:e.multiple,limit:e.maxNumber,disabled:e.getUploadState,"show-file-list":!1,"before-upload":e.beforeUpload,style:{"margin-left":"8px"}},{default:S(()=>[d(m,{type:"primary",disabled:e.getUploadState},{default:S(()=>[ne("\u9009\u62E9\u6587\u4EF6")]),_:1},8,["disabled"])]),_:1},8,["accept","multiple","limit","disabled","before-upload"])]),d(h,{dataSource:e.fileListRef,columns:e.columns,actionColumn:e.actionColumn},null,8,["dataSource","columns","actionColumn"])]),_:1},16,["onRegister","onConfirm","closeFn","confirm-options","cancel-options"])}const rs=Ee(as,[["render",os]]),us=z({components:{BasicModal:Xe,FileList:nt},props:{prefixCls:String},emits:["list-change","register","delete"],setup(e,{emit:a}){const s=D([]),[n,{closeModal:p}]=Ge(f=>{s.value=f.filter(m=>!!m).map(m=>({url:m,type:m.split(".").pop()||"",name:m.split("/").pop()||"-"}))});function v(f){const m=s.value.findIndex(i=>i.url===f.url);if(m!==-1){const i=s.value.splice(m,1);a("delete",i[0].url),a("list-change",s.value.map(h=>h.url))}}function r(f){const{url:m,name:i}=f;xt(m,i)}return{register:n,closeModal:p,fileListRef:s,columns:ns(),actionColumn:ss({handleRemove:v,handleDownload:r})}}});function is(e,a,s,n,p,v){const r=V("FileList"),f=V("BasicModal");return b(),I(f,me({title:"\u9884\u89C8"},e.$attrs,{width:800,"close-on-click-modal":!1,"close-on-press-escape":!1,class:e.prefixCls,onRegister:e.register,showCancelBtn:!1,showConfirmBtn:!1}),{default:S(()=>[d(r,{dataSource:e.fileListRef,columns:e.columns,actionColumn:e.actionColumn},null,8,["dataSource","columns","actionColumn"])]),_:1},16,["class","onRegister"])}const cs=Ee(us,[["render",is]]);const ds=z({name:"BasicUpload",components:{ElTooltip:Qt,ElButton:he,ElButtonGroup:qe,UploadModal:rs,UploadPreviewModal:cs,SvgIcon:Ht},props:Wn,emits:["change","delete","preview-delete","update:modelValue"],setup(e,{emit:a,attrs:s}){const n=D([]),{prefixCls:p}=Vt("basic-upload"),[v,{openModal:r}]=Te(),[f,{openModal:m}]=Te(),i=P(()=>{const{emptyHidePreview:L}=e;return L&&L?n.value.length>0:!0}),h=P(()=>{const{thumbSize:L}=e;return{["--thumb-size"]:`${L}px`}}),y=P(()=>({...e})),u=P(()=>{const L={...s,...t(y)},X=Object.keys(Qe);return qt(L,X)});function c(){r(!0,t(n))}function l(){m(!0,t(n))}function w(L){n.value=[...t(n),...L||[]],a("update:modelValue",n.value),a("change",n.value)}function F(L){n.value=[...L||[]],a("update:modelValue",n.value),a("change",n.value)}function g(L){a("delete",L)}function Y(L){a("preview-delete",L)}return ie(()=>e.modelValue,(L=[])=>{n.value=Array.isArray(L)?L:[]},{immediate:!0}),{prefixCls:p,fileList:n,showPreview:i,getProps:y,getBindValues:u,getThumbStyle:h,registerUploadModal:v,openUpload:c,handleChange:w,handlePreviewChange:F,registerPreviewModal:f,openPreview:l,handleDelete:g,handlePreviewDelete:Y}}}),ps=["src","alt"],fs=A("span",null,"\u4E0A\u4F20",-1);function ms(e,a,s,n,p,v){var u;const r=V("SvgIcon"),f=V("ElButton"),m=V("ElTooltip"),i=V("ElButtonGroup"),h=V("UploadModal"),y=V("UploadPreviewModal");return b(),_(se,null,[e.showThumb?(b(),_("div",{key:0,style:ye(e.getThumbStyle),class:k(`${e.prefixCls}-entry-thumb`)},[(u=e.fileList)!=null&&u.length?(b(),_("div",{key:0,class:k(`${e.prefixCls}-entry-thumb__img`)},[A("img",{src:e.fileList[0],alt:e.fileList[0]},null,8,ps),A("div",{class:k(`${e.prefixCls}-entry-thumb__img-inner`)},[A("div",{class:k(`${e.prefixCls}-entry-thumb__img--upload`),onClick:a[0]||(a[0]=c=>e.openUpload())},[d(r,{name:"cloud-upload"}),ne(" \u4E0A\u4F20 ")],2),e.getProps.showPreview?(b(),_("div",{key:0,class:k(`${e.prefixCls}-entry-thumb__img--preview`),onClick:a[1]||(a[1]=c=>e.openPreview())},[d(r,{name:"eye"}),ne(" \u9884\u89C8 "),e.fileList.length&&e.showPreviewNumber?(b(),_(se,{key:0},[ne("("+ue(e.fileList.length)+")",1)],64)):$("",!0)],2)):$("",!0)],2)],2)):(b(),_("div",{key:1,class:k(`${e.prefixCls}-entry-thumb__btn`),onClick:a[2]||(a[2]=c=>e.openUpload())},[d(r,{name:"cloud-upload"})],2))],6)):(b(),I(i,{key:1,class:k(`${e.prefixCls}-entry-simple`)},{default:S(()=>[d(f,{type:"primary",onClick:a[3]||(a[3]=c=>e.openUpload())},{default:S(()=>[d(r,{name:"cloud-upload",class:"mr-1"}),fs]),_:1}),e.showPreview?(b(),I(m,{key:0,placement:"bottom"},{content:S(()=>[ne(" \u5DF2\u4E0A\u4F20 "),e.fileList.length?(b(),_(se,{key:0},[ne(ue(e.fileList.length),1)],64)):$("",!0)]),default:S(()=>[e.getProps.showPreview?(b(),I(f,{key:0,onClick:a[4]||(a[4]=c=>e.openPreview())},{default:S(()=>[d(r,{name:"eye"}),e.fileList.length&&e.showPreviewNumber?(b(),_(se,{key:0},[ne(ue(e.fileList.length),1)],64)):$("",!0)]),_:1})):$("",!0)]),_:1})):$("",!0)]),_:1},8,["class"])),d(h,me(e.getBindValues,{prefixCls:`${e.prefixCls}-upload-modal`,onRegister:e.registerUploadModal,onChange:e.handleChange,onDelete:e.handleDelete}),null,16,["prefixCls","onRegister","onChange","onDelete"]),d(y,{prefixCls:`${e.prefixCls}-preview-modal`,onRegister:e.registerPreviewModal,onListChange:e.handlePreviewChange,onDelete:e.handlePreviewDelete},null,8,["prefixCls","onRegister","onListChange","onDelete"])],64)}const vs=Ee(ds,[["render",ms]]),Fs=Xt(vs),{uploadUrl:gs=""}=Gt();function Ss(e,a){return Wt.uploadFile({url:gs,onUploadProgress:a},e)}export{Fs as B,Ss as u};
