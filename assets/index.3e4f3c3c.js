var ye=Object.defineProperty,we=Object.defineProperties;var Ue=Object.getOwnPropertyDescriptors;var K=Object.getOwnPropertySymbols;var Ce=Object.prototype.hasOwnProperty,Se=Object.prototype.propertyIsEnumerable;var X=(e,t,l)=>t in e?ye(e,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[t]=l,B=(e,t)=>{for(var l in t||(t={}))Ce.call(t,l)&&X(e,l,t[l]);if(K)for(var l of K(t))Se.call(t,l)&&X(e,l,t[l]);return e},F=(e,t)=>we(e,Ue(t));var T=(e,t,l)=>new Promise((u,a)=>{var p=o=>{try{s(l.next(o))}catch(n){a(n)}},d=o=>{try{s(l.throw(o))}catch(n){a(n)}},s=o=>o.done?u(o.value):Promise.resolve(o.value).then(p,d);s((l=l.apply(e,t)).next())});import{e as N,_ as A,i as Z,f as Re,au as _e,ao as J,I as Ee,w as Le}from"./index.a180eed7.js";import{u as Be,B as Q,a as ee,b as te}from"./index.2a498586.js";import{y as _,u as R,x as M,bY as Ie,X as v,z as E,A as D,Y as O,a9 as x,$ as r,bZ as $e,b_ as G,aI as k,bA as ne,O as H,W as Pe,b$ as Ne,c0 as Me,I as ke,M as j,R as Fe,a2 as C,aa as I,F as $,D as Te,a0 as W,a6 as Ae,c1 as De,a7 as oe,o as Oe}from"./vendor.5e678e09.js";import{p as ae}from"./propTypes.13e00d90.js";import{b as xe}from"./uuid.2b29000c.js";import{d as je}from"./download.86b751ed.js";const{t:Y}=N();function ze({acceptRef:e,helpTextRef:t,maxNumberRef:l,maxSizeRef:u}){const a=_(()=>{const s=R(e);return s&&s.length>0?s:[]}),p=_(()=>R(a).map(s=>s.indexOf("/")>0||s.startsWith(".")?s:`.${s}`).join(",")),d=_(()=>{const s=R(t);if(s)return s;const o=[],n=R(e);n.length>0&&o.push(Y("component.upload.accept",[n.join(",")]));const m=R(u);m&&o.push(Y("component.upload.maxSize",[m]));const g=R(l);return g&&g!==1/0&&o.push(Y("component.upload.maxNumber",[g])),o.join("\uFF0C")});return{getAccept:a,getStringAccept:p,getHelpText:d}}var h;(function(e){e.SUCCESS="success",e.ERROR="error",e.UPLOADING="uploading"})(h||(h={}));const le={api:{type:Function,default:null,required:!0},helpText:{type:String,default:""},maxSize:{type:Number,default:2},maxNumber:{type:Number,default:1/0},accept:{type:Array,default:()=>[]},multiple:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},uploadParams:{type:Object,default:{}}},Ve=F(B({},le),{modelValue:{type:Array,default:()=>[]},showPreviewNumber:{type:Boolean,default:!0},emptyHidePreview:{type:Boolean,default:!1}}),Ge={modelValue:{type:Array,default:()=>[]}},He={columns:{type:[Array],default:null},actionColumn:{type:Object,default:null},dataSource:{type:Array,default:null}};function We(e,t){const l=t.join("|");return new RegExp("\\.("+l+")$","i").test(e.name)}function Ye(e){return se(e.name)}function se(e){return/\.(jpg|jpeg|png|gif|webp|svg)$/i.test(e)}function qe(e){return new Promise((t,l)=>{const u=new FileReader;u.readAsDataURL(e),u.onload=()=>t({result:u.result,file:e}),u.onerror=a=>l(a)})}const Ke=M({components:{ElImage:Ie},props:{fileUrl:ae.string.def(""),fileName:ae.string.def("")}}),Xe={class:"thumb"};function Ze(e,t,l,u,a,p){const d=v("ElImage");return E(),D("span",Xe,[e.fileUrl?(E(),O(d,{key:0,src:e.fileUrl,"preview-src-list":[e.fileUrl],width:104},null,8,["src","preview-src-list"])):x("",!0)])}var re=A(Ke,[["render",Ze]]);const{t:b}=N();function Je(){return[{dataIndex:"thumbUrl",title:b("component.upload.legend"),width:100,customRender:({record:e})=>{const{thumbUrl:t}=e||{};return t&&r(re,{fileUrl:t},null)}},{dataIndex:"name",title:b("component.upload.fileName"),align:"left",customRender:({text:e,record:t})=>{const{percent:l,status:u}=t||{};console.log("record",t);let a;return u===h.ERROR?a="exception":u===h.UPLOADING?a="":u===h.SUCCESS&&(a="success"),r("span",null,[r("p",{class:"truncate mb-1",title:e},[e]),r($e,{percentage:l,"text-inside":!0,"stroke-width":24,status:a},null)])}},{dataIndex:"size",title:b("component.upload.fileSize"),width:100,customRender:({text:e=0})=>e&&(e/1024).toFixed(2)+"KB"},{dataIndex:"status",title:b("component.upload.fileStatue"),width:100,customRender:({text:e})=>e===h.SUCCESS?r(G,{type:"success"},{default:()=>b("component.upload.uploadSuccess")}):e===h.ERROR?r(G,{type:"danger"},{default:()=>b("component.upload.uploadError")}):e===h.UPLOADING?r(G,null,{default:()=>b("component.upload.uploading")}):e}]}function Qe(e){return{width:120,title:b("component.upload.operating"),dataIndex:"action",fixed:!1,customRender:({record:t})=>r(k,{type:"danger",onClick:e.bind(null,t)},{default:()=>b("component.upload.del")})}}function et(){return[{dataIndex:"url",title:b("component.upload.legend"),width:100,customRender:({record:e})=>{const{url:t}=e||{};return se(t)&&r(re,{fileUrl:t},null)}},{dataIndex:"name",title:b("component.upload.fileName"),align:"left"}]}function tt({handleRemove:e,handleDownload:t}){return{width:200,title:b("component.upload.operating"),dataIndex:"action",fixed:!1,customRender:({record:l})=>r(ne,null,{default:()=>[r(k,{type:"danger",onClick:e.bind(null,l)},{default:()=>b("component.upload.del")}),r(k,{type:"success",onClick:t.bind(null,l)},{default:()=>b("component.upload.download")})]})}}var ue=M({name:"FileList",props:He,setup(e){const t=Be();return H(()=>e.dataSource,()=>{Pe(()=>{var l;(l=t==null?void 0:t.redoModalHeight)==null||l.call(t)})}),()=>{const{columns:l,actionColumn:u,dataSource:a}=e,p=[...l,u];return r("table",{class:"file-table"},[r("colgroup",null,[p.map(d=>{const{width:s=0,dataIndex:o}=d,n={width:`${s}px`,minWidth:`${s}px`};return r("col",{style:s?n:{},key:o},null)})]),r("thead",null,[r("tr",{class:"file-table-tr"},[p.map(d=>{const{title:s="",align:o="center",dataIndex:n}=d;return r("th",{class:["file-table-th",o],key:n},[s])})])]),r("tbody",null,[a.map((d={},s)=>r("tr",{class:"file-table-tr",key:`${s+d.name||""}`},[p.map(o=>{const{dataIndex:n="",customRender:m,align:g="center"}=o,L=m&&Z(m);return r("td",{class:["file-table-td",g],key:n},[L?m==null?void 0:m({text:d[n],record:d}):d[n]])})]))])])}}});const nt=M({components:{ElButton:k,ElUpload:Ne,ElAlert:Me,BasicModal:Q,FileList:ue},props:F(B({},le),{previewFileList:{type:Array,default:()=>[]}}),emits:["change","register","delete"],setup(e,{emit:t}){const l=ke({fileList:[]}),u=j(!1),a=j([]),{accept:p,helpText:d,maxNumber:s,maxSize:o}=Fe(e),{t:n}=N(),[m,{closeModal:g}]=ee(),{getAccept:L,getStringAccept:z,getHelpText:V}=ze({acceptRef:p,helpTextRef:d,maxNumberRef:s,maxSizeRef:o}),{createMessage:c}=Re(),ie=_(()=>a.value.length>0&&!a.value.every(i=>i.status===h.SUCCESS)),de=_(()=>{const i=a.value.some(f=>f.status===h.SUCCESS);return{disabled:u.value||a.value.length===0||!i}}),ce=_(()=>{const i=a.value.some(f=>f.status===h.ERROR);return u.value?n("component.upload.uploading"):n(i?"component.upload.reUploadFailed":"component.upload.startUpload")});function pe(i){const{size:f,name:y}=i,{maxSize:w,maxNumber:S,previewFileList:U}=e,P=R(L);if(a.value.length+(U==null?void 0:U.length)>=S)return c.warning(n("component.upload.maxNumber",[S]));if(w&&i.size/1024/1024>=w)return c.error(n("component.upload.maxSizeMultiple",[w])),!1;if(P.length>0&&!We(i,P))return c.error(n("component.upload.acceptUpload",[P.join(",")])),!1;const q={uuid:xe(),file:i,size:f,name:y,percent:0,type:y.split(".").pop()};return Ye(i)?qe(i).then(({result:be})=>{a.value=[...R(a),B({thumbUrl:be},q)]}):a.value=[...R(a),q],!1}function me(i){const f=a.value.findIndex(y=>y.uuid===i.uuid);f!==-1&&a.value.splice(f,1),t("delete",i)}function fe(i){return T(this,null,function*(){var y;const{api:f}=e;if(!f||!Z(f))return _e("upload api must exist and be a function");try{i.status=h.UPLOADING;const w=function(U){const P=U.loaded/U.total*100|0;i.percent=P},{data:S}=yield(y=e.api)==null?void 0:y.call(e,F(B({},e.uploadParams||{}),{file:i.file}),w);return i.status=h.SUCCESS,i.responseData=S,{success:!0,error:null}}catch(w){return console.log(w),i.status=h.ERROR,{success:!1,error:w}}})}function ge(){return T(this,null,function*(){var f;const{maxNumber:i}=e;if(a.value.length+((f=e.previewFileList)==null?void 0:f.length)>i)return c.warning(n("component.upload.maxNumber",[i]));try{u.value=!0;const y=a.value.filter(U=>U.status!==h.SUCCESS)||[],w=yield Promise.all(y.map(U=>fe(U)));u.value=!1;const S=w.filter(U=>!U.success);if(S.length>0)throw S}catch(y){throw u.value=!1,y}})}function he(){const{maxNumber:i}=e;if(a.value.length>i)return c.warning(n("component.upload.maxNumber",[i]));if(u.value)return c.warning(n("component.upload.saveWarn"));const f=[];for(const y of a.value){const{status:w,responseData:S}=y;w===h.SUCCESS&&S&&f.push(S.url)}if(f.length<=0)return c.warning(n("component.upload.saveError"));a.value=[],g(),t("change",f)}function ve(){return T(this,null,function*(){return u.value?(c.warning(n("component.upload.uploadWait")),!1):(a.value=[],!0)})}return{columns:Je(),actionColumn:Qe(me),register:m,closeModal:g,getHelpText:V,getStringAccept:z,getOkButtonProps:de,beforeUpload:pe,fileListRef:a,state:l,isUploadingRef:u,handleStartUpload:ge,handleOk:he,handleCloseFunc:ve,getIsSelectFile:ie,getUploadBtnText:ce,t:n}}}),ot={class:"upload-modal-toolbar"};function at(e,t,l,u,a,p){const d=v("el-button"),s=v("ElAlert"),o=v("ElButton"),n=v("ElUpload"),m=v("FileList"),g=v("BasicModal");return E(),O(g,W({title:e.t("component.upload.upload"),okText:e.t("component.upload.save")},e.$attrs,{onRegister:e.register,onOk:e.handleOk,closeFunc:e.handleCloseFunc,maskClosable:!1,keyboard:!1,wrapClassName:"upload-modal",confirmButton:e.getOkButtonProps,cancelButton:{disabled:e.isUploadingRef}}),{centerFooter:C(()=>[r(d,{onClick:e.handleStartUpload,type:"success",disabled:!e.getIsSelectFile,loading:e.isUploadingRef},{default:C(()=>[I($(e.getUploadBtnText),1)]),_:1},8,["onClick","disabled","loading"])]),default:C(()=>[Te("div",ot,[r(s,{title:e.getHelpText,type:"info",closable:!1,class:"upload-modal-toolbar__text"},null,8,["title"]),r(n,{action:"NotUrl",accept:e.getStringAccept,multiple:e.multiple,limit:e.maxNumber,disabled:e.isUploadingRef||e.fileListRef.length+e.previewFileList.length>=e.maxNumber,"show-file-list":!1,"before-upload":e.beforeUpload,class:"upload-modal-toolbar__btn"},{default:C(()=>[r(o,{type:"primary",disabled:e.isUploadingRef||e.fileListRef.length+e.previewFileList.length>=e.maxNumber},{default:C(()=>[I($(e.t("component.upload.choose")),1)]),_:1},8,["disabled"])]),_:1},8,["accept","multiple","limit","disabled","before-upload"])]),r(m,{dataSource:e.fileListRef,columns:e.columns,actionColumn:e.actionColumn},null,8,["dataSource","columns","actionColumn"])]),_:1},16,["title","okText","onRegister","onOk","closeFunc","confirmButton","cancelButton"])}var lt=A(nt,[["render",at]]);const st=M({components:{BasicModal:Q,FileList:ue},props:Ge,emits:["list-change","register","delete"],setup(e,{emit:t}){const{t:l}=N(),[u,{closeModal:a}]=ee(),p=j([]);H(()=>e.modelValue,o=>{J(o)||(o=[]),p.value=o.filter(n=>!!n).map(n=>({url:n,type:n.split(".").pop()||"",name:n.split("/").pop()||""}))},{immediate:!0});function d(o){const n=p.value.findIndex(m=>m.url===o.url);if(n!==-1){const m=p.value.splice(n,1);t("delete",m[0].url),t("list-change",p.value.map(g=>g.url))}}function s(o){const{url:n}=o;je({url:n})}return{t:l,register:u,closeModal:a,fileListRef:p,columns:et(),actionColumn:tt({handleRemove:d,handleDownload:s})}}});function rt(e,t,l,u,a,p){const d=v("FileList"),s=v("BasicModal");return E(),O(s,W({width:800,title:e.t("component.upload.preview"),wrapClassName:"upload-preview-modal"},e.$attrs,{onRegister:e.register,showConfirm:!1}),{default:C(()=>[r(d,{dataSource:e.fileListRef,columns:e.columns,actionColumn:e.actionColumn},null,8,["dataSource","columns","actionColumn"])]),_:1},16,["title","onRegister"])}var ut=A(st,[["render",rt]]);const it=M({name:"BasicUpload",components:{ElTooltip:Ae,ElButton:k,ElButtonGroup:ne,UploadModal:lt,UploadPreviewModal:ut,Icon:Ee},props:Ve,emits:["change","delete","preview-delete","update:value"],setup(e,{emit:t,attrs:l}){const{t:u}=N(),[a,{openModal:p}]=te(),[d,{openModal:s}]=te(),o=j([]),n=_(()=>{const{emptyHidePreview:c}=e;return c&&c?o.value.length>0:!0}),m=_(()=>{const c=B(B({},l),e);return Oe(c,"onChange","modelValue")});H(()=>e.modelValue,(c=[])=>{o.value=J(c)?c:[]},{immediate:!0});function g(c){o.value=[...R(o),...c||[]],t("update:value",o.value),t("change",o.value)}function L(c){o.value=[...c||[]],t("update:value",o.value),t("change",o.value)}function z(c){t("delete",c)}function V(c){t("preview-delete",c)}return{registerUploadModal:a,openUploadModal:p,handleChange:g,handlePreviewChange:L,registerPreviewModal:d,openPreviewModal:s,UploadFilled:De,fileList:o,showPreview:n,bindValue:m,handleDelete:z,handlePreviewDelete:V,t:u}}}),dt=I();function ct(e,t,l,u,a,p){const d=v("ElButton"),s=v("Icon"),o=v("ElTooltip"),n=v("ElButtonGroup"),m=v("UploadModal"),g=v("UploadPreviewModal");return E(),D("div",null,[r(n,null,{default:C(()=>[r(d,{type:"primary",onClick:t[0]||(t[0]=L=>e.openUploadModal()),icon:e.UploadFilled},{default:C(()=>[I($(e.t("component.upload.upload")),1)]),_:1},8,["icon"]),e.showPreview?(E(),O(o,{key:0,placement:"bottom"},{content:C(()=>[I($(e.t("component.upload.uploaded"))+" ",1),e.fileList.length?(E(),D(oe,{key:0},[I($(e.fileList.length),1)],64)):x("",!0)]),default:C(()=>[r(d,{onClick:t[1]||(t[1]=L=>e.openPreviewModal())},{default:C(()=>[r(s,{icon:"bi:eye",size:"12"}),dt,e.fileList.length&&e.showPreviewNumber?(E(),D(oe,{key:0},[I($(e.fileList.length),1)],64)):x("",!0)]),_:1})]),_:1})):x("",!0)]),_:1}),r(m,W(e.bindValue,{previewFileList:e.fileList,onRegister:e.registerUploadModal,onChange:e.handleChange,onDelete:e.handleDelete}),null,16,["previewFileList","onRegister","onChange","onDelete"]),r(g,{value:e.fileList,onRegister:e.registerPreviewModal,onListChange:e.handlePreviewChange,onDelete:e.handlePreviewDelete},null,8,["value","onRegister","onListChange","onDelete"])])}var pt=A(it,[["render",ct]]);const wt=Le(pt);export{wt as B};
