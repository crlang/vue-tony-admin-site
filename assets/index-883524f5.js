var V=(n,u,p)=>new Promise((s,m)=>{var a=d=>{try{v(p.next(d))}catch(_){m(_)}},o=d=>{try{v(p.throw(d))}catch(_){m(_)}},v=d=>d.done?s(d.value):Promise.resolve(d.value).then(a,o);v((p=p.apply(n,u)).next())});import{a as q,j as G,w as y,b as J,_ as Q}from"./index-795cdaa0.js";import{r as $,ad as W,C as Z,u as e,n as F,E as L,p as S,q as x,t as r,S as f,f as j,w as P,I as X,J as H,L as h,a0 as Y,K as N,T as z,R as ee,a7 as ne,Q as te,O as se,U as oe,a4 as ae,ac as U}from"./vue-d691a816.js";import{g as le,d as re,v as ue}from"./index-84e8d8c1.js";import{d as ie,a$ as D,u as ce,Z as pe,w as de}from"./elementui-66980f2a.js";import{u as fe}from"./index-22989de9.js";import"./lock-a612cd3d.js";import"./index-a2d8523e.js";import"./useTimeout-ff985c90.js";import"./index-1d31dc0e.js";import"./useWindowSizeFn-f51aba85.js";import"./index-d5a424e4.js";function he(){const n=$([]);return W(()=>{n.value=[]}),[n,p=>s=>{n.value[p]=s}]}function me(n){return["$","(",")","*","+",".","[","]","?","\\","^","{","}","|"].includes(n)?`\\${n}`:n}function ve(n){const p=["",...[...n].map(s=>me(s)),""].join(".*");return new RegExp(p)}function _e(n,u,p){const s=$([]),m=$(""),a=$(-1);let o=[];const v=q(),d=ce(_,200);Z(()=>V(this,null,function*(){const l=yield le();o=ie(l)}));function _(l){if(m.value=l.trim(),!l){s.value=[];return}const i=ve(e(m)),c=G(o,t=>i.test(t.name)&&!t.hideMenu);s.value=R(c,i),a.value=0}function R(l,i,c){const t=[];return l.forEach(g=>{const{name:w,path:M,icon:K,children:C,hideMenu:O,meta:k}=g;!O&&i.test(w)&&(!(C!=null&&C.length)||k!=null&&k.hideChildrenInMenu)&&t.push({name:c!=null&&c.name?`${c.name} > ${w}`:w,path:M,icon:K}),!(k!=null&&k.hideChildrenInMenu)&&Array.isArray(C)&&C.length&&t.push(...R(C,i,g))}),t}function A(l){const i=l.target.dataset.index;a.value=Number(i)}function T(){s.value.length&&(a.value--,a.value<0&&(a.value=s.value.length-1),E())}function B(){s.value.length&&(a.value++,a.value>s.value.length-1&&(a.value=0),E())}function E(){const l=e(n);if(!l||!Array.isArray(l)||l.length===0||!e(u))return;const i=e(a),c=l[i];if(!c)return;const t=e(u);if(!t)return;const g=c.offsetTop+c.offsetHeight,w=t.offsetHeight,{start:M}=fe({el:t,duration:100,to:g-w});M()}function I(){return V(this,null,function*(){if(!s.value.length)return;const l=e(s),i=e(a);if(l.length===0||i<0)return;const c=l[i];b(),yield F(),v(c.path)})}function b(){s.value=[],p("close")}return D("Enter",I),D("ArrowUp",T),D("ArrowDown",B),D("Escape",b),{handleSearch:d,searchResult:s,keyword:m,activeIndex:a,handleMouseenter:A,handleEnter:I}}const ge=r("span",null,"确认",-1),we=r("span",null,"切换",-1),$e=r("span",null,"ESC",-1),Me=L({__name:"AppSearchFooter",setup(n){return(u,p)=>(S(),x("div",null,[r("div",null,[r("span",null,[f(e(y),{name:"enter"})]),ge]),r("div",null,[r("span",null,[f(e(y),{name:"arrowup"})]),r("span",null,[f(e(y),{name:"arrowdown"})]),we]),r("div",null,[r("span",null,[f(e(y),{name:"close"})]),$e])]))}}),Se=["data-index"],ye=L({__name:"AppSearchModal",props:{visible:{type:Boolean}},emits:["close"],setup(n,{emit:u}){const p=n,s=$(null),m=$(null),a=$(""),{prefixCls:o}=J("header-search-modal"),[v,d]=he(),{getIsMobile:_}=re(),{handleSearch:R,searchResult:A,keyword:T,activeIndex:B,handleEnter:E,handleMouseenter:I}=_e(v,s,u),b=j(()=>!T||e(A).length===0),l=j(()=>[o,{[`${o}--mobile`]:e(_)}]);P(()=>p.visible,c=>{c&&F(()=>{var t;a.value="",(t=e(m))==null||t.focus()})});function i(){A.value=[],u("close")}return(c,t)=>(S(),X(ae,{to:"body"},[f(oe,{name:"zoom-fade",mode:"out-in"},{default:H(()=>[n.visible?(S(),x("div",{key:0,class:h(e(l)),onClick:t[3]||(t[3]=Y(()=>{},["stop"]))},[N((S(),x("div",{class:h(`${e(o)}-content`)},[r("div",{class:h(`${e(o)}-input__wrapper`)},[f(e(pe),{class:h(`${e(o)}-input`),placeholder:"搜索",ref_key:"inputRef",ref:m,clearable:"",modelValue:a.value,"onUpdate:modelValue":t[0]||(t[0]=g=>a.value=g),onInput:e(R)},{prefix:H(()=>[f(e(y),{name:"search"})]),_:1},8,["class","modelValue","onInput"]),r("span",{class:h(`${e(o)}-cancel`),onClick:i},"取消",2)],2),N(r("div",{class:h(`${e(o)}-nodata`)},"暂无搜索结果",2),[[z,e(b)]]),N(r("ul",{class:h(`${e(o)}-list`),ref_key:"scrollWrap",ref:s},[(S(!0),x(ee,null,ne(e(A),(g,w)=>(S(),x("li",{ref_for:!0,ref:e(d)(w),key:g.path,"data-index":w,onMouseenter:t[1]||(t[1]=(...M)=>e(I)&&e(I)(...M)),onClick:t[2]||(t[2]=(...M)=>e(E)&&e(E)(...M)),class:h([`${e(o)}-list__item`,{[`${e(o)}-list__item--active`]:e(B)===w}])},[r("div",{class:h(`${e(o)}-list__item-text`)},te(g.name),3),r("div",{class:h(`${e(o)}-list__item-enter`)},[f(e(y),{name:"enter",size:20})],2)],42,Se))),128))],2),[[z,!e(b)]]),f(Me,{class:h(`${e(o)}-footer`)},null,8,["class"])],2)),[[e(ue),i]])],2)):se("",!0)]),_:1})]))}});const Ce=L({name:"AppSearch",components:{ElTooltip:de,AppSearchModal:ye,SvgIcon:y},setup(){return{showModal:$(!1)}}});function ke(n,u,p,s,m,a){const o=U("SvgIcon"),v=U("ElTooltip"),d=U("AppSearchModal");return S(),x("div",{onClick:u[1]||(u[1]=_=>n.showModal=!0)},[f(v,{effect:"dark",content:"搜索",placement:"bottom-end"},{default:H(()=>[r("span",null,[f(o,{name:"search"})])]),_:1}),f(d,{onClose:u[0]||(u[0]=_=>n.showModal=!1),visible:n.showModal},null,8,["visible"])])}const He=Q(Ce,[["render",ke]]);export{He as default};
