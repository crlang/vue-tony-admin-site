var $=Object.defineProperty,B=Object.defineProperties;var k=Object.getOwnPropertyDescriptors;var b=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;var F=(e,a,t)=>a in e?$(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t,V=(e,a)=>{for(var t in a||(a={}))R.call(a,t)&&F(e,t,a[t]);if(b)for(var t of b(a))I.call(a,t)&&F(e,t,a[t]);return e},E=(e,a)=>B(e,k(a));var g=(e,a,t)=>new Promise((o,u)=>{var s=l=>{try{r(t.next(l))}catch(d){u(d)}},c=l=>{try{r(t.throw(l))}catch(d){u(d)}},r=l=>l.done?o(l.value):Promise.resolve(l.value).then(s,c);r((t=t.apply(e,a)).next())});import{_ as L,I as T}from"./index-795cdaa0.js";import{X as j,Y as q,o as G,a9 as J}from"./elementui-66980f2a.js";import{E as M,r as m,f as w,u as f,b as N,w as A,o as P,ac as C,p as y,I as O,J as U,q as X,R as Y,a7 as z,G as D}from"./vue-d691a816.js";const H=M({name:"ApiSelect",components:{ElSelect:j,ElOption:q},inheritAttrs:!1,props:{modelValue:{type:[Array,String,Number],default:""},api:{type:Function,default:null},params:{type:Object,default:()=>({})},resultField:{type:String,default:""},labelField:{type:String,default:"label"},valueField:{type:String,default:"value"},valueToString:{type:Boolean},immediate:{type:Boolean,default:!1}},emits:["option-change","change","update:modelValue"],setup(e,{emit:a}){const t=m([]),o=m(!1),u=m(!0),s=m(),c=w(()=>{const{labelField:n,valueField:i,valueToString:_}=e;return f(t).reduce((v,p)=>{if(p){const S=p[i];v.push(E(V({},G(p,[n,i])),{label:p[n],value:_?`${S}`:S}))}return v},[])}),r=w(()=>f(o)?"请等待数据加载完成...":"数据为空");N(()=>{s.value=e.modelValue||"",e.immediate&&l()}),A(()=>e.params,()=>{!f(u)&&l()},{deep:!0}),A(()=>f(s),n=>{a("update:modelValue",n),a("change",n)});function l(){return g(this,null,function*(){const n=e.api;if(!(!n||typeof n!="function")){t.value=[];try{o.value=!0;const i=yield n(e.params);if(Array.isArray(i)){t.value=i,h();return}e.resultField&&(t.value=J(i,e.resultField)||[]),h()}catch(i){}finally{o.value=!1}}})}function d(){return g(this,null,function*(){!e.immediate&&f(u)&&(yield l(),u.value=!1)})}function h(){a("option-change",f(c))}return P(()=>{d()}),{innerValueRef:s,getOptions:c,loading:o,getSelectEmpty:r,handleFetch:d}}});function K(e,a,t,o,u,s){const c=C("ElOption"),r=C("ElSelect");return y(),O(r,D({onVisibleChange:e.handleFetch,clearable:""},e.$attrs,{"no-data-text":e.getSelectEmpty,modelValue:e.innerValueRef,"onUpdate:modelValue":a[0]||(a[0]=l=>e.innerValueRef=l)}),{default:U(()=>[(y(!0),X(Y,null,z(e.getOptions,l=>(y(),O(c,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},16,["onVisibleChange","no-data-text","modelValue"])}const Q=L(H,[["render",K]]),ae=T(Q);export{ae as A};
