var H=(n,t,p)=>new Promise((a,v)=>{var l=d=>{try{s(p.next(d))}catch(_){v(_)}},h=d=>{try{s(p.throw(d))}catch(_){v(_)}},s=d=>d.done?a(d.value):Promise.resolve(d.value).then(l,h);s((p=p.apply(n,t)).next())});import{y as V,z as w,A as M,K as i,R as f,u as e,Q as S,a as k,ab as X,x as Z,U as K,l as G,b as q,G as P,H as U,I as F,L as m,J as O,F as Y,a3 as ee,X as ne,O as te,T as se,a1 as oe,Z as L}from"./ex-pkg-@vue.dfd8e273.js";import{e as R,I as j,k as ae,bf as le,H as re,bg as ce,u as ie,_ as ue}from"./index.54cb4205.js";import{g as pe,d as de,C as fe}from"./index.a116c73f.js";import{u as me,i as D}from"./ex-pkg-@vueuse.e5d644bd.js";import{c6 as he}from"./ex-pkg-vendor.ab2d902e.js";import{f as ve,d as ge}from"./ex-pkg-element-plus.e1a09009.js";import{S as W}from"./ex-pkg-@element-plus.e8ce6c8b.js";import"./ex-pkg-@iconify.345c6dc9.js";import"./ex-pkg-mockjs.0bec78f1.js";import"./ex-pkg-@popperjs.f3a17871.js";import"./index.8961b4fe.js";import"./useWindowSizeFn.732207ab.js";import"./propTypes.6bd760c6.js";import"./lock.e2768128.js";const _e=V({setup(n){const{t}=R();return(p,a)=>(w(),M("div",null,[i("div",null,[i("span",null,[f(e(j),{icon:"uil:enter"})]),i("span",null,S(e(t)("component.app.toSearch")),1)]),i("div",null,[i("span",null,[f(e(j),{icon:"ion:arrow-up-outline"})]),i("span",null,[f(e(j),{icon:"ion:arrow-down-outline"})]),i("span",null,S(e(t)("component.app.toNavigate")),1)]),i("div",null,[i("span",null,[f(e(j),{icon:"mdi:keyboard-esc"})]),i("span",null,S(e(t)("common.closeText")),1)])]))}});function xe(){const n=k([]);return X(()=>{n.value=[]}),[n,p=>a=>{n.value[p]=a}]}function ke(n){return["$","(",")","*","+",".","[","]","?","\\","^","{","}","|"].includes(n)?`\\${n}`:n}function be(n){const t=[...n].map(a=>ke(a)),p=["",...t,""].join(".*");return new RegExp(p)}function we(n,t,p){const a=k([]),v=k(""),l=k(-1);let h=[];const{t:s}=R(),d=ae(),_=me(B,200);Z(()=>H(this,null,function*(){const r=yield pe();h=he(r),le(h,c=>{c.name=s(c.name)})}));function B(r){if(v.value=r.trim(),!r){a.value=[];return}const c=be(e(v)),u=re(h,o=>c.test(o.name)&&!o.hideMenu);a.value=E(u,c),l.value=0}function E(r,c,u){const o=[];return r.forEach(g=>{const{name:x,path:b,icon:J,children:$,hideMenu:Q,meta:y}=g;!Q&&c.test(x)&&(!($==null?void 0:$.length)||(y==null?void 0:y.hideChildrenInMenu))&&o.push({name:(u==null?void 0:u.name)?`${u.name} > ${x}`:x,path:b,icon:J}),!(y==null?void 0:y.hideChildrenInMenu)&&Array.isArray($)&&$.length&&o.push(...E($,c,g))}),o}function C(r){const c=r.target.dataset.index;l.value=Number(c)}function N(){!a.value.length||(l.value--,l.value<0&&(l.value=a.value.length-1),I())}function z(){!a.value.length||(l.value++,l.value>a.value.length-1&&(l.value=0),I())}function I(){const r=e(n);if(!r||!Array.isArray(r)||r.length===0||!e(t))return;const c=e(l),u=r[c];if(!u)return;const o=e(t);if(!o)return;const g=u.offsetTop+u.offsetHeight,x=o.offsetHeight,{start:b}=ce({el:o,duration:100,to:g-x});b()}function T(){return H(this,null,function*(){if(!a.value.length)return;const r=e(a),c=e(l);if(r.length===0||c<0)return;const u=r[c];A(),yield K(),d(u.path)})}function A(){a.value=[],p("close")}return D("Enter",T),D("ArrowUp",N),D("ArrowDown",z),D("Escape",A),{handleSearch:_,searchResult:a,keyword:v,activeIndex:l,handleMouseenter:C,handleEnter:T}}const $e=["data-index"],ye=V({props:{visible:{type:Boolean}},emits:["close"],setup(n,{emit:t}){const p=n,a=k(null),v=k(null),l=k(""),{t:h}=R(),{prefixCls:s}=ie("header-search-modal"),[d,_]=xe(),{getIsMobile:B}=de(),{handleSearch:E,searchResult:C,keyword:N,activeIndex:z,handleEnter:I,handleMouseenter:T}=we(d,a,t),A=G(()=>!N||e(C).length===0),r=G(()=>[s,{[`${s}--mobile`]:e(B)}]);q(()=>p.visible,u=>{u&&K(()=>{var o;l.value="",(o=e(v))==null||o.focus()})});function c(){C.value=[],t("close")}return(u,o)=>(w(),P(oe,{to:"body"},[f(se,{name:"zoom-fade",mode:"out-in"},{default:U(()=>[n.visible?(w(),M("div",{key:0,class:m(e(r)),onClick:o[3]||(o[3]=ne(()=>{},["stop"]))},[F((w(),M("div",{class:m(`${e(s)}-content`)},[i("div",{class:m(`${e(s)}-input__wrapper`)},[f(e(ve),{class:m(`${e(s)}-input`),placeholder:e(h)("common.searchText"),ref_key:"inputRef",ref:v,clearable:"",modelValue:l.value,"onUpdate:modelValue":o[0]||(o[0]=g=>l.value=g),onInput:e(E)},{prefix:U(()=>[f(e(W))]),_:1},8,["class","placeholder","modelValue","onInput"]),i("span",{class:m(`${e(s)}-cancel`),onClick:c},S(e(h)("common.cancelText")),3)],2),F(i("div",{class:m(`${e(s)}-nodata`)},S(e(h)("component.app.searchNotData")),3),[[O,e(A)]]),F(i("ul",{class:m(`${e(s)}-list`),ref_key:"scrollWrap",ref:a},[(w(!0),M(Y,null,ee(e(C),(g,x)=>(w(),M("li",{ref_for:!0,ref:e(_)(x),key:g.path,"data-index":x,onMouseenter:o[1]||(o[1]=(...b)=>e(T)&&e(T)(...b)),onClick:o[2]||(o[2]=(...b)=>e(I)&&e(I)(...b)),class:m([`${e(s)}-list__item`,{[`${e(s)}-list__item--active`]:e(z)===x}])},[i("div",{class:m(`${e(s)}-list__item-icon`)},[f(e(j),{icon:g.icon||"mdi:form-select",size:20},null,8,["icon"])],2),i("div",{class:m(`${e(s)}-list__item-text`)},S(g.name),3),i("div",{class:m(`${e(s)}-list__item-enter`)},[f(e(j),{icon:"uil:enter",size:20})],2)],42,$e))),128))],2),[[O,!e(A)]]),f(_e,{class:m(`${e(s)}-footer`)},null,8,["class"])],2)),[[e(fe),c]])],2)):te("",!0)]),_:1})]))}}),Me=V({name:"AppSearch",components:{ElTooltip:ge,AppSearchModal:ye,Search:W},setup(){const n=k(!1),{t}=R();return{t,showModal:n}}});function Se(n,t,p,a,v,l){const h=L("Search"),s=L("ElTooltip"),d=L("AppSearchModal");return w(),M("div",{onClick:t[1]||(t[1]=_=>n.showModal=!0)},[f(s,{effect:"dark",content:n.t("common.searchText"),placement:"bottom-end"},{default:U(()=>[i("span",null,[f(h)])]),_:1},8,["content"]),f(d,{onClose:t[0]||(t[0]=_=>n.showModal=!1),visible:n.showModal},null,8,["visible"])])}var Le=ue(Me,[["render",Se]]);export{Le as default};
