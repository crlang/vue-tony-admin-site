import{d as E,r as _,c as M,Z as L,U as $,ac as w,b as h,h as i,P as j,m as k,al as O,dV as D,W as P}from"./index.a812ffa9.js";import{I as S}from"./index.c229c7c5.js";import{b as N,a as V,E as W}from"./index.2271c5c3.js";function A(r){return typeof r=="function"||Object.prototype.toString.call(r)==="[object Object]"&&!j(r)}const H=E({name:"ContextMenu",props:{items:{type:Array,default(){return[]}},width:{type:Number,default:156},event:{type:Object,default:null},styles:Object,showIcon:{type:Boolean,default:!0},axis:{type:Object,default(){return{x:0,y:0}}}},setup(r){const n=_(null),d=_(!1),{prefixCls:f}=k("context-menu"),y=M(()=>{const{axis:t,items:e,styles:s,width:o}=r,{x:l,y:c}=t||{x:0,y:0},m=(e||[]).length*44,b=o,v=document.body,C=v.clientWidth<l+b?l-b:l,I=v.clientHeight<c+m?c-m:c;return{...s,width:`${o}px`,left:`${C+1}px`,top:`${I+1}px`}}),p=t=>{const{item:e,handler:s,showIcon:o}=t;return i("div",{class:`${f}__text`,onClick:s.bind(null,e)},[o&&e.icon&&i(S,{class:"mr-2",name:e.icon},null),i("span",null,[e.label])])};function x(t,e){const{handler:s,disabled:o}=t;o||(d.value=!1,e==null||e.stopPropagation(),e==null||e.preventDefault(),s==null||s())}function u(t){return t.map(e=>{const{disabled:s,label:o,children:l,divider:c=!1}=e,m={item:e,handler:x,showIcon:r.showIcon};return!l||l.length===0?i(O,null,[i(V,{disabled:s,class:`${f}__item ${c?"is-divider":""}`,index:o},{default:()=>[i(p,m,null)]})]):h(d)?i(W,{index:o,disabled:s,"popper-class":`${f}__popup`},{title:()=>i(p,m,null),default:()=>u(l)}):null})}return L(()=>{$(()=>d.value=!0)}),w(()=>{const t=h(n);t&&document.body.removeChild(t)}),()=>{let t;if(!h(d))return null;const{items:e}=r;return i(N,{"default-active":"12",mode:"vertical",collapse:!0,"unique-opened":!0,"menu-trigger":"hover",class:f,ref:n,style:h(y)},A(t=u(e))?t:{default:()=>[t]})}}});const a={domList:[],resolve:()=>{}},R=function(r){const{event:n=null,showIcon:d=!0,styles:f={},items:y,width:p}=r||{};if(n&&(n==null||n.preventDefault()),!(typeof window>"u"))return new Promise(x=>{const u=document.body,t=document.createElement("div"),e={event:n,styles:f,showIcon:d,items:y,width:p,axis:{x:(n==null?void 0:n.clientX)||0,y:(n==null?void 0:n.clientY)||0}},s=i(H,e);D(s,t);const o=function(){a.resolve("")};a.domList.push(t);const l=function(){a.domList.forEach(c=>{try{c&&u.removeChild(c)}catch(m){}}),u.removeEventListener("click",o),u.removeEventListener("scroll",o)};a.resolve=function(c){l(),x(c)},l(),u.appendChild(t),u.addEventListener("click",o),u.addEventListener("scroll",o)})},g=function(){a&&(a.resolve(""),a.domList=[])};function F(r=!0){return P()&&r&&w(()=>{g()}),[R,g]}export{F as u};
