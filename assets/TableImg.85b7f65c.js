var kt=Object.defineProperty,_t=Object.defineProperties;var Tt=Object.getOwnPropertyDescriptors;var Xe=Object.getOwnPropertySymbols;var Et=Object.prototype.hasOwnProperty,$t=Object.prototype.propertyIsEnumerable;var Ze=(e,t,o)=>t in e?kt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,k=(e,t)=>{for(var o in t||(t={}))Et.call(t,o)&&Ze(e,o,t[o]);if(Xe)for(var o of Xe(t))$t.call(t,o)&&Ze(e,o,t[o]);return e},se=(e,t)=>_t(e,Tt(t));var ae=(e,t,o)=>new Promise((s,a)=>{var m=l=>{try{u(o.next(l))}catch(r){a(r)}},f=l=>{try{u(o.throw(l))}catch(r){a(r)}},u=l=>l.done?s(l.value):Promise.resolve(l.value).then(m,f);u((o=o.apply(e,t)).next())});import{M as A,aj as Re,y as _,u as n,O as be,g as Ne,aY as Rt,t as we,I as qe,bm as Ue,V as It,W as Je,H as Ft,K as At,x as te,am as Qe,aV as xe,bO as Pt,aI as Dt,a6 as je,aX as et,c3 as Bt,R as Ot,X as v,z as S,Y as P,a2 as F,$ as K,D as ie,aa as Pe,F as ue,G as L,A as X,ao as De,a7 as Be,aq as zt,ar as Vt,ap as Kt,c4 as Lt,bf as Nt,a9 as W,a3 as Se,al as jt,bT as Mt,br as Ht,bP as Ut,bt as Wt,bK as Gt,k as tt,bC as nt,c5 as Yt,bz as Xt,d as Zt,s as qt,bd as We,B as Ge,C as ot,a0 as re,o as Ye,c6 as Jt,c2 as Qt,c7 as xt,ac as lt,aJ as ke,aK as en,c8 as tn,bY as nn,S as on}from"./vendor.5e678e09.js";import{A as ln,B as sn}from"./BasicForm.b7b18809.js";import{u as an}from"./useForm.5f193a64.js";import{aw as rn,Q as ce,ax as st,ao as Me,j as He,i as ne,ay as cn,az as un,x as dn,aA as fn,Y as gn,I as pn,u as _e,_ as oe,e as Ie,Z as at,ah as mn,ac as it,an as hn}from"./index.a180eed7.js";import{b as rt}from"./uuid.2b29000c.js";import{p as I}from"./propTypes.13e00d90.js";import{C as Cn}from"./clickOutside.d6da8543.js";const{table:bn}=rn,{pageSizeOptions:Sn,pageLayoutOptions:yn,defaultPageSize:vn,fetchSetting:wn,defaultSortFn:Io,defaultFilterFn:Fo}=bn,de="key",kn=Sn,_n=yn,Fe=vn,ct=wn,Tn="center",ut="INDEX",Oe="ACTION";function En(e){const t=A({}),o=A(!0);Re(()=>{const{pagination:l,api:r}=n(e);(l||r)&&(t.value=k(k({},n(t)),l!=null?l:{}))});const s=_(()=>{const{pagination:l,api:r}=n(e);return!n(o)||!l&&!r?!1:k(k({page:1,defaultCurrentPage:1,size:Fe,defaultPageSize:Fe,pageSizes:kn,layout:_n},l!=null?l:{}),n(t))});function a(l){const r=n(s);t.value=k(k({},ce(r)?{}:r),l),setTimeout(()=>{},300)}function m(){return n(s)}function f(){return n(o)}function u(l){return ae(this,null,function*(){o.value=l})}return{getPagination:m,getPaginationInfo:s,setShowPagination:u,getShowPagination:f,setPagination:a}}function dt(e,t){const{key:o,dataIndex:s,children:a}=e;e.align=e.align||Tn,t&&(o||(e.key=s),ce(e.ellipsis)||Object.assign(e,{ellipsis:t})),a&&a.length&&ft(a,!!t)}function ft(e,t){!e||e.forEach(o=>{const{children:s}=o;dt(o,t),ft(s,t)})}function $n(e,t){const{actionColumn:o}=n(e);if(!o)return;const s=t.findIndex(a=>a.flag===Oe);s===-1&&t.push(se(k(se(k({},t[s]),{fixed:"right"}),o),{flag:Oe}))}function Rn(e){const t=A(n(e).columns);let o=n(e).columns;const s=_(()=>{const h=Ne(n(t));if($n(e,h),!h)return[];const{ellipsis:p}=n(e);return h.forEach(g=>{const{customRender:T,slots:i}=g;dt(g,Reflect.has(g,"ellipsis")?!!g.ellipsis:!!p&&!T&&!i)}),h});function a(h){const p=h.ifShow;let g=!0;return ce(p)&&(g=p),ne(p)&&(g=p(h)),g}const{hasPermission:m}=st(),f=_(()=>{const h=gt(n(s));return Ne(h).filter(g=>m(g.auth)&&a(g)).map(g=>{const{slots:T,dataIndex:i,customRender:E,format:$,edit:N,editRow:G,flag:Y}=g;(!T||!(T==null?void 0:T.title))&&(g.slots=k({title:`header-${i}`},T||{}),g.customTitle=g.title,Reflect.deleteProperty(g,"title"));const Z=[ut,Oe].includes(Y);return!E&&$&&!N&&!Z&&(g.customRender=({text:y,record:O,index:c})=>In(y,$,O,c)),(N||G)&&!Z&&(g.customRender=renderEditCell(g)),g})});be(()=>n(e).columns,h=>{var p;t.value=h,o=(p=h==null?void 0:h.filter(g=>!g.flag))!=null?p:[]});function u(h,p){!h||!p||o.forEach(g=>{if(g.dataIndex===h){Object.assign(g,p);return}})}function l(h){const p=Ne(h);if(!Me(p))return;if(p.length<=0){t.value=[];return}const g=p[0],T=o.map(i=>i.dataIndex);if(!He(g))t.value=p;else{const i=p,E=[];o.forEach($=>{i.includes($.dataIndex||$.key)?E.push(se(k({},$),{defaultHidden:!1})):E.push(se(k({},$),{defaultHidden:!0}))}),Rt(T,p)||E.sort(($,N)=>T.indexOf($.dataIndex)-T.indexOf(N.dataIndex)),t.value=E}}function r(h){const{ignoreIndex:p,ignoreAction:g,sort:T}=h||{};let i=we(n(s));return p&&(i=i.filter(E=>E.flag!==ut)),g&&(i=i.filter(E=>E.flag!==Oe)),T&&(i=gt(i)),i}function b(){return o}return{getColumnsRef:s,getCacheColumns:b,getColumns:r,setColumns:l,getViewColumns:f,setCacheColumnsByField:u}}function gt(e){const t=[],o=[],s=[];for(const a of e){if(a.fixed==="left"){t.push(a);continue}if(a.fixed==="right"){o.push(a);continue}s.push(a)}return[...t,...s,...o].filter(a=>!a.defaultHidden)}function In(e,t,o,s){if(!t)return e;if(ne(t))return t(e,o,s);try{const a="date|";if(He(t)&&t.startsWith(a)){const m=t.replace(a,"");return m?cn(e,m):e}if(un(t))return t.get(e)}catch(a){return e}}function Fn(e,{getPaginationInfo:t,setPagination:o,setLoading:s,getFieldsValue:a,tableData:m},f){const u=qe({sortInfo:{},filterInfo:{}}),l=A([]),r=A({});Re(()=>{m.value=n(l)}),be(()=>n(e).dataSource,()=>{const{dataSource:c,api:C}=n(e);!C&&c&&(l.value=c)},{immediate:!0}),be(()=>n(t),(c,C)=>{C&&(c.page!==(C==null?void 0:C.page)||c.size!==(C==null?void 0:C.size))&&G({page:c.page,size:c.size||Fe})},{immediate:!0});function b(c){!c||!Array.isArray(c)||c.forEach(C=>{C[de]||(C[de]=rt()),C.children&&C.children.length&&b(C.children)})}const h=_(()=>n(e).autoCreateKey&&!n(e).rowKey),p=_(()=>{const{rowKey:c}=n(e);return n(h)?de:c}),g=_(()=>{const c=n(l);if(!c||c.length===0)return n(l);if(n(h)){const C=c[0],D=c[c.length-1];if(C&&D&&(!C[de]||!D[de])){const z=Ne(n(l));z.forEach(H=>{H[de]||(H[de]=rt()),H.children&&H.children.length&&b(H.children)}),l.value=z}}return n(l)});function T(c,C,D){return ae(this,null,function*(){return l.value[c]&&(l.value[c][C]=D),l.value[c]})}function i(c,C){const D=N(c);if(D){for(const z in D)Reflect.has(C,z)&&(D[z]=C[z]);return D}}function E(c){var z,H;if(!l.value||l.value.length===0)return;const D=(Array.isArray(c)?c:[c]).map(j=>l.value.findIndex(x=>x.key===j.key)).filter(j=>j!==void 0).sort((j,x)=>x-j);for(const j of D)n(l).splice(j,1),(z=n(e).dataSource)==null||z.splice(j,1);return o({total:(H=n(e).dataSource)==null?void 0:H.length}),n(e).dataSource}function $(c,C){var D,z;if(!(!l.value||l.value.length===0))return C=C!=null?C:(D=l.value)==null?void 0:D.length,n(l).splice(C,0,c),(z=n(e).dataSource)==null||z.splice(C,0,c),n(e).dataSource}function N(c){if(!l.value||l.value.length===0)return;const C=n(p);if(!C)return;const{childrenColumnName:D="children"}=n(e);return(H=>{let j;return H.some(function x(d){if(typeof C=="function"){if(C(d)===c)return j=d,!0}else if(Reflect.has(d,C)&&d[C]===c)return j=d,!0;return d[D]&&d[D].some(x)}),j})(l.value)}function G(c){return ae(this,null,function*(){var w,R,V,U;const{api:C,searchInfo:D,fetchSetting:z,beforeFetch:H,afterFetch:j,useSearchForm:x,pagination:d}=n(e);if(!(!C||!ne(C)))try{s(!0);const{pageField:M,sizeField:J,listField:ge,totalField:pe}=Object.assign({},ct,z);let q={};const{page:ee=1,size:me=Fe}=(w=n(t))!=null?w:{};ce(d)&&!d||ce(t)?q={}:(q[M]=c&&c.page||ee,q[J]=me);const{sortInfo:le={},filterInfo:he}=u;let Ee=k(k(k(k(k(k(k(k({},q),x?a():{}),D),(R=c==null?void 0:c.searchInfo)!=null?R:{}),le),he),(V=c==null?void 0:c.sortInfo)!=null?V:{}),(U=c==null?void 0:c.filterInfo)!=null?U:{});H&&ne(H)&&(Ee=(yield H(Ee))||Ee);const Ce=yield C(Ee);r.value=Ce;const Ae=Array.isArray(Ce);let ye=Ae?Ce:Ue(Ce,ge);const $e=Ae?0:Ue(Ce,pe),ze=Ae?1:Ue(Ce,M);if($e){const Ve=Math.ceil($e/me);ee>Ve&&(o({page:Ve}),G(c))}j&&ne(j)&&(ye=(yield j(ye))||ye),l.value=ye,o({total:$e||0}),c&&c.page&&o({page:c.page||1}),f("fetch-success",{items:n(ye),page:ze,total:$e})}catch(M){console.error("===fetch error===",M),f("fetch-error",M),l.value=[],o({total:0})}finally{s(!1)}})}function Y(c){l.value=c}function Z(){return g.value}function y(){return r.value}function O(c){return ae(this,null,function*(){yield G(c)})}return It(()=>{dn(()=>{n(e).immediate&&G()},16)}),{getDataSourceRef:g,getDataSource:Z,getRawDataSource:y,getRowKey:p,setTableData:Y,getAutoCreateKey:h,fetch:G,reload:O,updateTableData:T,updateTableDataRecord:i,deleteTableDataRecord:E,insertTableDataRecord:$,findTableDataRecord:N}}function An(e){const t=A(n(e).loading);be(()=>n(e).loading,a=>{t.value=a});const o=_(()=>n(t));function s(a){t.value=a}return{getLoading:o,setLoading:s}}function Pn(e,t,o){const s=A([]),a=A([]),m=_(()=>{const{showCheckboxColumn:i}=n(e);return i?{selectedRowKeys:n(s),hideDefaultSelections:!1,toggleRowSelection:E=>{l(E)}}:null});be(()=>{var i;return(i=n(e).rowSelection)==null?void 0:i.selectedRowKeys},i=>{l(i)}),be(()=>n(s),()=>{Je(()=>{const{rowSelection:i}=n(e);if(i){const{onSelectionChange:E}=i;E&&ne(E)&&E(p(),g())}o("selection-change",{keys:p(),rows:g()})})},{deep:!0});const f=_(()=>n(e).autoCreateKey&&!n(e).rowKey),u=_(()=>{const{rowKey:i}=n(e);return n(f)?de:i});function l(i){var N;s.value=i;const E=fn(we(n(t)).concat(we(n(a))),G=>i.includes(G[n(u)]),{children:(N=e.value.childrenColumnName)!=null?N:"children"}),$=[];i.forEach(G=>{const Y=E.find(Z=>Z[n(u)]===G);Y&&$.push(Y)}),a.value=$}function r(i){a.value=i}function b(){a.value=[],s.value=[]}function h(i){const $=n(s).findIndex(N=>N===i);$!==-1&&n(s).splice($,1)}function p(){return n(s)}function g(){return n(a)}function T(){return n(m)}return{getRowSelection:T,getRowSelectionRef:m,getSelectRows:g,getSelectRowKeys:p,setSelectedRowKeys:l,clearSelectedRowKeys:b,deleteSelectRowByKey:h,setSelectedRows:r}}function Dn(e,t){function o(s,a){const{striped:m,rowClassName:f}=n(e),u=[];return m&&u.push((a||0)%2==1?`${t}-row__striped`:""),f&&ne(f)&&u.push(f(s,a)),u.filter(l=>!!l).join(" ")}return{getRowClassName:o}}function Bn(e,t,o){const s=A([]),a=_(()=>n(e).autoCreateKey&&!n(e).rowKey),m=_(()=>{const{rowKey:b}=n(e);return n(a)?de:b}),f=_(()=>({expandRowKeys:n(s),onExpandChange:b=>{s.value=b,o("expand-change",b)}}));function u(){const b=l();s.value=b}function l(b){const h=[],{childrenColumnName:p}=n(e);return we(b||n(t)).forEach(g=>{h.push(g[n(m)]);const T=g[p||"children"];(T==null?void 0:T.length)&&h.push(...l(T))}),h}function r(){s.value=[]}return{getExpandOption:f,expandAll:u,collapseAll:r}}const pt=Symbol("basic-table");function On(e){At(pt,e)}function Te(){return Ft(pt)}function zn(e,t,o,s){const a=_(()=>{const{formConfig:l}=n(e),{submitButtonOptions:r}=l||{};return se(k({showAdvancedButton:!0},l),{submitButtonOptions:k({loading:n(s)},r)})}),m=_(()=>Object.keys(t).map(r=>r.startsWith("form-")?r:null).filter(r=>!!r));function f(l){var r,b;return l&&(b=(r=l==null?void 0:l.replace)==null?void 0:r.call(l,/form\-/,""))!=null?b:""}function u(l){const{handleSearchInfoFn:r}=n(e);r&&ne(r)&&(l=r(l)||l),o({searchInfo:l,page:1})}return{getFormProps:a,replaceFormSlotKey:f,getFormSlotKeys:m,handleSearchInfoChange:u}}const Vn=te({name:"ColumnSetting",components:{ElPopover:Qe,ElCheckbox:xe,ElCheckboxGroup:Pt,ElButton:Dt,ElTooltip:je,ElDivider:et,Setting:Bt,ScrollContainer:gn,Icon:pn},emits:["columns-change"],setup(e){const{t}=Ie(),o=Te(),s=A([]),a=A([]),m=A(null),f=qe({checkAll:!0,checkedList:[],defaultCheckList:[]}),u=A(!1),l=A(!1),{prefixCls:r}=_e("basic-column-setting"),b=_(()=>n(o==null?void 0:o.getBindValues)||{});Re(()=>{o.getColumns().length&&p()}),Re(()=>{const y=n(b);u.value=!!y.showIndexColumn,l.value=!!y.showCheckboxColumn});function h(){const y=[];return o.getColumns({ignoreIndex:!0,ignoreAction:!0}).forEach(O=>{y.push(O)}),y}function p(){const y=h(),O=o.getColumns({ignoreAction:!0}).map(c=>c.defaultHidden?"":c.prop).filter(Boolean);a.value.length||(a.value=y,s.value=y,f.defaultCheckList=O),f.checkedList=O}function g(y){if(y){const O=[...a.value];f.checkedList=O.map(c=>c.prop),Z(O)}else f.checkedList=[],Z([])}const T=_(()=>{const y=a.value.length,O=f.checkedList.length;return O>0&&O<y});function i(){const y=n(a).filter(c=>c.prop&&f.checkedList.indexOf(c.prop)!==-1),O=a.value.length;f.checkAll=y.length===0?!1:y.length===O,Z(y)}function E(){f.checkedList=[...f.defaultCheckList],f.checkAll=!0,a.value=n(s),Z(o.getCacheColumns())}function $(y){}function N(y){o.setProps({showIndexColumn:y})}function G(y){o.setProps({showCheckboxColumn:y})}function Y(y,O){if(!f.checkedList.includes(y.prop))return;const c=h(),C=y.fixed===O?!1:O,D=c.findIndex(z=>z.prop===y.prop);D!==-1&&(c[D].fixed=C),y.fixed=C,C&&!y.width&&(y.width=100),Z(c)}function Z(y){o.setColumns(y)}return se(k({t},Ot(f)),{indeterminate:T,onCheckAllChange:g,handleChange:i,plainOptions:a,reset:E,prefixCls:r,columnListRef:m,handleVisibleChange:$,checkIndex:u,checkSelect:l,handleIndexCheckChange:N,handleSelectCheckChange:G,handleColumnFixed:Y})}});function Kn(e,t,o,s,a,m){const f=v("ElCheckbox"),u=v("ElButton"),l=v("Icon"),r=v("ElTooltip"),b=v("ElDivider"),h=v("ElCheckboxGroup"),p=v("ScrollContainer"),g=v("Setting"),T=v("ElPopover");return S(),P(T,{trigger:"click",width:330,onShow:t[2]||(t[2]=i=>e.handleVisibleChange(!0)),onHide:t[3]||(t[3]=i=>e.handleVisibleChange(!1)),"popper-class":`${e.prefixCls}__cloumn-list`},{reference:F(()=>[K(g,{title:e.t("component.table.settingColumn")},null,8,["title"])]),default:F(()=>[ie("div",{class:L(`${e.prefixCls}__popover-title`)},[K(f,{indeterminate:e.indeterminate,modelValue:e.checkAll,"onUpdate:modelValue":t[0]||(t[0]=i=>e.checkAll=i),onChange:e.onCheckAllChange},{default:F(()=>[Pe(ue(e.t("component.table.settingColumnShow")),1)]),_:1},8,["indeterminate","modelValue","onChange"]),K(u,{size:"small",type:"text",onClick:e.reset},{default:F(()=>[Pe(ue(e.t("common.resetText")),1)]),_:1},8,["onClick"])],2),K(p,null,{default:F(()=>[K(h,{modelValue:e.checkedList,"onUpdate:modelValue":t[1]||(t[1]=i=>e.checkedList=i),onChange:e.handleChange,ref:"columnListRef"},{default:F(()=>[(S(!0),X(Be,null,De(e.plainOptions,i=>(S(),X("div",{key:i.value,class:L(`${e.prefixCls}__check-item`)},[K(f,{label:i.prop},{default:F(()=>[Pe(ue(i.label),1)]),_:2},1032,["label"]),K(r,{placement:"bottom-start",content:e.t("component.table.settingFixedLeft")},{default:F(()=>[K(l,{icon:"line-md:arrow-align-left",class:L([`${e.prefixCls}__fixed-left`,{active:i.fixed==="left",disabled:!e.checkedList.includes(i.prop)}]),onClick:E=>e.handleColumnFixed(i,"left")},null,8,["class","onClick"])]),_:2},1032,["content"]),K(b,{direction:"vertical"}),K(r,{placement:"bottom-start",content:e.t("component.table.settingFixedRight")},{default:F(()=>[K(l,{icon:"line-md:arrow-align-left",class:L([`${e.prefixCls}__fixed-right`,{active:i.fixed==="right",disabled:!e.checkedList.includes(i.prop)}]),onClick:E=>e.handleColumnFixed(i,"right")},null,8,["class","onClick"])]),_:2},1032,["content"])],2))),128))]),_:1},8,["modelValue","onChange"])]),_:1})]),_:1},8,["popper-class"])}var Ln=oe(Vn,[["render",Kn]]);const Nn=te({name:"SizeSetting",components:{ElTooltip:je,ElDropdown:zt,ElDropdownItem:Vt,ElDropdownMenu:Kt,SvgIcon:at},setup(){const e=Te(),{t}=Ie();function o(s){e.setProps({size:s})}return{handleTitleClick:o,t}}});function jn(e,t,o,s,a,m){const f=v("SvgIcon"),u=v("ElDropdownItem"),l=v("ElDropdownMenu"),r=v("ElDropdown"),b=v("ElTooltip");return S(),P(b,{placement:"top",content:e.t("component.table.settingDens")},{default:F(()=>[K(r,{trigger:"click",onCommand:e.handleTitleClick},{dropdown:F(()=>[K(l,null,{default:F(()=>[K(u,{command:"default"},{default:F(()=>[ie("span",null,ue(e.t("component.table.settingDensDefault")),1)]),_:1}),K(u,{command:"large"},{default:F(()=>[ie("span",null,ue(e.t("component.table.settingDensLarge")),1)]),_:1}),K(u,{command:"small"},{default:F(()=>[ie("span",null,ue(e.t("component.table.settingDensSmall")),1)]),_:1})]),_:1})]),default:F(()=>[K(f,{size:"0",name:"colum-height"})]),_:1},8,["onCommand"])]),_:1},8,["content"])}var Mn=oe(Nn,[["render",jn]]);const Hn=te({name:"RedoSetting",components:{ElTooltip:je,Refresh:Lt},setup(){const e=Te(),{t}=Ie();function o(){e.reload()}return{redo:o,t}}});function Un(e,t,o,s,a,m){const f=v("Refresh"),u=v("ElTooltip");return S(),P(u,{placement:"top",content:e.t("common.redo")},{default:F(()=>[K(f,{onClick:e.redo},null,8,["onClick"])]),_:1},8,["content"])}var Wn=oe(Hn,[["render",Un]]);const Gn=te({name:"FullScreenSetting",components:{ElTooltip:je,SvgIcon:at},setup(){const e=Te(),{t}=Ie(),{toggle:o,isFullscreen:s}=Nt(e.wrapRef);return{toggle:o,isFullscreen:s,t}}});function Yn(e,t,o,s,a,m){const f=v("SvgIcon"),u=v("ElTooltip");return S(),P(u,{placement:"top",content:e.t("component.table.settingFullScreen")},{default:F(()=>[e.isFullscreen?(S(),P(f,{key:1,size:"0",name:"fullscreen-exit",onClick:e.toggle},null,8,["onClick"])):(S(),P(f,{key:0,size:"0",name:"fullscreen",onClick:e.toggle},null,8,["onClick"]))]),_:1},8,["content"])}var Xn=oe(Gn,[["render",Yn]]);const Zn=te({name:"TableSetting",components:{ColumnSetting:Ln,SizeSetting:Mn,RedoSetting:Wn,FullScreenSetting:Xn},props:{setting:{type:Object,default:()=>({})}},emits:["columns-change"],setup(e,{emit:t}){const{t:o}=Ie(),s=Te(),a=_(()=>k({redo:!0,size:!0,setting:!0,fullScreen:!0},e.setting));function m(u){t("columns-change",u)}function f(){return s?n(s.wrapRef):document.body}return{getSetting:a,t:o,handleColumnChange:m,getTableContainer:f}}}),qn={class:"table-settings"};function Jn(e,t,o,s,a,m){const f=v("RedoSetting"),u=v("SizeSetting"),l=v("ColumnSetting"),r=v("FullScreenSetting");return S(),X("div",qn,[e.getSetting.redo?(S(),P(f,{key:0})):W("",!0),e.getSetting.size?(S(),P(u,{key:1})):W("",!0),e.getSetting.setting?(S(),P(l,{key:2,onColumnsChange:e.handleColumnChange},null,8,["onColumnsChange"])):W("",!0),e.getSetting.fullScreen?(S(),P(r,{key:3})):W("",!0)])}var Qn=oe(Zn,[["render",Jn]]);const xn=te({name:"BasicTableTitle",components:{BasicTitle:mn},props:{title:{type:[Function,String]},getSelectRows:{type:Function},helpMessage:{type:[String,Array]}},setup(e){const{prefixCls:t}=_e("basic-table-title");return{getTitle:_(()=>{const{title:s,getSelectRows:a=()=>{}}=e;let m=s;return ne(s)&&(m=s({selectRows:a()})),m}),prefixCls:t}}});function eo(e,t,o,s,a,m){const f=v("BasicTitle");return e.getTitle?(S(),P(f,{key:0,class:L(e.prefixCls),helpMessage:e.helpMessage},{default:F(()=>[Pe(ue(e.getTitle),1)]),_:1},8,["class","helpMessage"])):W("",!0)}var to=oe(xn,[["render",eo]]);const no=te({name:"BasicTableHeader",components:{ElDivider:et,TableTitle:to,TableSetting:Qn},props:{title:{type:[Function,String]},tableSetting:{type:Object},showTableSetting:{type:Boolean},titleHelpMessage:{type:[String,Array],default:""}},emits:["columns-change"],setup(e,{emit:t}){const{prefixCls:o}=_e("basic-table-header");function s(a){t("columns-change",a)}return{prefixCls:o,handleColumnChange:s}}});function oo(e,t,o,s,a,m){const f=v("TableTitle"),u=v("ElDivider"),l=v("TableSetting");return S(),X("div",{class:L(e.prefixCls)},[e.$slots.headerTop?(S(),X("div",{key:0,class:L(`${e.prefixCls}__top`)},[Se(e.$slots,"headerTop")],2)):W("",!0),ie("div",{class:L(`${e.prefixCls}__inner`)},[ie("div",{class:L(`${e.prefixCls}__title`)},[e.$slots.tableTitle?Se(e.$slots,"tableTitle",{key:0}):e.title?(S(),P(f,{key:1,helpMessage:e.titleHelpMessage,title:e.title},null,8,["helpMessage","title"])):W("",!0)],2),ie("div",{class:L(`${e.prefixCls}__toolbar`)},[Se(e.$slots,"toolbar"),e.$slots.toolbar&&e.showTableSetting?(S(),P(u,{key:0,direction:"vertical"})):W("",!0),e.showTableSetting?(S(),P(l,{key:1,setting:e.tableSetting,onColumnsChange:e.handleColumnChange},null,8,["setting","onColumnsChange"])):W("",!0)],2)],2)],2)}var lo=oe(no,[["render",oo]]),so=te({name:"TableRender",props:{render:[Object,Function,String,Number]},setup(e){return()=>e.render()}});const ao={clickToRowSelect:I.bool.def(!0),tableSetting:I.shape({}),inset:I.bool,showTableSetting:I.bool,autoCreateKey:I.bool.def(!0),striped:I.bool.def(!0),showSummary:I.bool,summaryFunc:{type:[Function,Array],default:null},summaryData:{type:Array,default:null},indentSize:I.number.def(24),canColDrag:I.bool.def(!0),api:{type:Function,default:null},beforeFetch:{type:Function,default:null},afterFetch:{type:Function,default:null},handleSearchInfoFn:{type:Function,default:null},fetchSetting:{type:Object,default:()=>ct},immediate:I.bool.def(!0),emptyDataIsShowTable:I.bool.def(!0),searchInfo:{type:Object,default:null},useSearchForm:I.bool,formConfig:{type:Object,default:null},columns:{type:[Array],default:()=>[]},showIndexColumn:I.bool.def(!1),indexColumnProps:{type:Object,default:null},actionColumn:{type:Object,default:null},showCheckboxColumn:I.bool.def(!1),ellipsis:I.bool.def(!0),clearSelectOnPageChange:I.bool,title:{type:[String,Function],default:null},titleHelpMessage:{type:[String,Array]},maxHeight:I.number,dataSource:{type:Array,default:null},rowKey:{type:[String,Function],default:""},pagination:{type:Object,default:null},loading:I.bool,beforeEditSubmit:{type:Function}},fe=new Map;fe.set("ElInput",jt);fe.set("ElInputNumber",Mt);fe.set("ElSelect",Ht);fe.set("ApiSelect",ln);fe.set("ElSwitch",Ut);fe.set("ElCheckbox",xe);fe.set("ElDatePicker",Wt);fe.set("ElTimePicker",Gt);const io=({component:e="ElInput",rule:t=!0,ruleMessage:o,popoverVisible:s},{attrs:a})=>{const m=fe.get(e),f=tt(m,a);return t?tt(Qe,{popperClass:"edit-cell-rule-popover",visible:!!s},{reference:()=>f,default:()=>o}):f};const ro=te({name:"EditableCell",components:{Edit:nt,Close:Yt,Check:Xt,CellComponent:io},directives:{clickOutside:Cn},props:{value:{type:[String,Number,Boolean,Object],default:""},record:{type:Object},column:{type:Object,default:()=>({})},index:I.number},setup(e){const t=Te(),o=A(!1),s=A(),a=A(!1),m=A(""),f=A([]),u=A(e.value),l=A(e.value),r=A(!1),{t:b}=Ie(),{prefixCls:h}=_e("editable-cell"),p=_(()=>{var d;return((d=e.column)==null?void 0:d.editComponent)||"ElInput"}),g=_(()=>{var d;return(d=e.column)==null?void 0:d.editRule}),T=_(()=>n(m)&&n(a)),i=_(()=>{const d=n(p);return["ElCheckbox","ElSwitch"].includes(d)}),E=_(()=>{var J,ge;const d=(ge=(J=e.column)==null?void 0:J.editComponentProps)!=null?ge:{},w=n(p),R={};w==="ApiSelect"&&(R.cache=!0);const V={oninput:(...pe)=>{var le;const[q]=pe,ee=q?q.target:null,me=(le=ee==null?void 0:ee.value)!=null?le:ee!=null?ee:q;u.value=me}},M=w&&["ElInputNumber"].includes(w)?Number(n(u)):n(u);return se(k(k(k({size:"small",placeholder:b("common.inputText")},R),V),Ye(d,"onChange")),{modelValue:M})}),$=_(()=>{const{record:d,column:w}=e;try{if(w.prop&&d&&d[w.prop])return d[w.prop]}catch(R){}return""}),N=_(()=>n(i)||n(Y)?{}:{width:"calc(100% - 48px)"}),G=_(()=>{const{align:d="center"}=e.column;return`edit-cell-align-${d}`}),Y=_(()=>{const{editable:d}=e.record||{};return!!d});Re(()=>{l.value=e.value||n($),u.value=e.value||n($)}),Re(()=>{const{editable:d}=e.column;(ce(d)||ce(n(Y)))&&(o.value=!!d||n(Y))});function Z(){var d;n(Y)||n((d=e.column)==null?void 0:d.editRow)||(m.value="",o.value=!0,Je(()=>{var R;const w=n(s);(R=w==null?void 0:w.focus)==null||R.call(w)}))}function y(w){return ae(this,arguments,function*(d){var U,M,J;const R=n(p);d?(d==null?void 0:d.target)&&Reflect.has(d.target,"value")?u.value=d.target.value:R==="ElCheckbox"?u.value=d.target.checked:(He(d)||ce(d)||it(d))&&(u.value=d):u.value=d;const V=(M=(U=e.column)==null?void 0:U.editComponentProps)==null?void 0:M.onChange;V&&ne(V)&&V(...arguments),(J=t.emit)==null||J.call(t,"edit-change",{column:e.column,value:n(u),record:we(e.record)}),O()})}function O(){return ae(this,null,function*(){const{column:d,record:w}=e,{editRule:R}=d,V=n(u);if(R){if(ce(R)&&!V&&!it(V))return a.value=!0,m.value=b("common.inputText"),!1;if(ne(R)){const U=yield R(V,w);return U?(m.value=U,a.value=!0,!1):(m.value="",!0)}}return m.value="",!0})}function c(d=!0){return ae(this,null,function*(){if(d&&!(yield O()))return!1;const{column:w,index:R,record:V}=e;if(!V)return!1;const{label:U,prop:M}=w,J=n(u);if(!U||!M)return;const ge=M||U;if(!V.editable){const{getBindValues:pe}=t,{beforeEditSubmit:q,columns:ee}=n(pe);if(q&&ne(q)){r.value=!0;const me=ee.map(he=>he.prop).filter(he=>!!he);let le=!0;try{le=yield q({record:Zt(V,me),index:R,key:M,value:J})}catch(he){le=!1}finally{r.value=!1}if(le===!1)return}}qt(V,ge,J),o.value=!1})}function C(){return ae(this,null,function*(){var d;((d=e.column)==null?void 0:d.editRow)||c()})}function D(){c()}function z(){var M;o.value=!1,u.value=l.value;const{column:d,index:w,record:R}=e,{label:V,prop:U}=d;(M=t.emit)==null||M.call(t,"edit-cancel",{record:R,index:w,key:U||V,value:n(u)})}function H(){var w;if(((w=e.column)==null?void 0:w.editable)||n(Y))return;n(p).includes("Input")&&z()}function j(d){f.value=d}function x(d,w){var R;e.record&&(Me(e.record[d])?(R=e.record[d])==null||R.push(w):e.record[d]=[w])}return e.record&&(x("submitCbs",c),x("validCbs",O),x("cancelCbs",z),e.column.prop&&(e.record.editValueRefs||(e.record.editValueRefs={}),e.record.editValueRefs[e.column.prop]=u),e.record.onCancelEdit=()=>{var d,w;Me((d=e.record)==null?void 0:d.cancelCbs)&&((w=e.record)==null||w.cancelCbs.forEach(R=>R()))},e.record.onSubmitEdit=()=>ae(this,null,function*(){var d,w,R,V,U;if(Me((d=e.record)==null?void 0:d.submitCbs))return((R=(w=e.record)==null?void 0:w.onValid)==null?void 0:R.call(w))?((((V=e.record)==null?void 0:V.submitCbs)||[]).forEach(J=>J(!1,!1)),(U=t.emit)==null||U.call(t,"edit-row-end"),!0):void 0})),{isEdit:o,prefixCls:h,handleEdit:Z,currentValueRef:u,handleSubmit:c,handleChange:y,handleCancel:z,elRef:s,getComponent:p,getRule:g,onClickOutside:H,ruleMessage:m,getRuleVisible:T,getComponentProps:E,handleOptionsChange:j,getWrapperStyle:N,getWrapperClass:G,getRowEditable:Y,getValues:$,handleEnter:C,handleSubmitClick:D,spinning:r}}}),co=["title"];function uo(e,t,o,s,a,m){var p;const f=v("Edit"),u=v("CellComponent"),l=v("Check"),r=v("Close"),b=We("loading"),h=We("click-outside");return S(),X("div",{class:L(e.prefixCls)},[Ge(ie("div",{class:L({[`${e.prefixCls}__normal`]:!0,"ellipsis-cell":!0}),onClick:t[0]||(t[0]=(...g)=>e.handleEdit&&e.handleEdit(...g))},[ie("div",{class:"cell-content",title:(p=e.getValues)!=null?p:""},ue(e.getValues?e.getValues:"\xA0"),9,co),e.column.editRow?W("",!0):(S(),P(f,{key:0,class:L(`${e.prefixCls}__normal-icon`)},null,8,["class"]))],2),[[ot,!e.isEdit]]),e.isEdit?Ge((S(),X("div",{key:0,class:L(`${e.prefixCls}__wrapper`)},[K(u,re(e.getComponentProps,{component:e.getComponent,style:e.getWrapperStyle,popoverVisible:e.getRuleVisible,rule:e.getRule,ruleMessage:e.ruleMessage,class:e.getWrapperClass,ref:"elRef"}),null,16,["component","style","popoverVisible","rule","ruleMessage","class"]),e.getRowEditable?W("",!0):(S(),X("div",{key:0,class:L(`${e.prefixCls}__action`)},[K(l,{class:L([`${e.prefixCls}__icon`]),onClick:e.handleSubmitClick},null,8,["class","onClick"]),K(r,{class:L(`${e.prefixCls}__icon `),onClick:e.handleCancel},null,8,["class","onClick"])],2))],2)),[[b,e.spinning],[h,e.onClickOutside]]):W("",!0)],2)}var fo=oe(ro,[["render",uo]]);const go=te({components:{ElTable:Jt,ElTableColumn:Qt,ElPagination:xt,BasicForm:sn,TableHeader:lo,EditableCell:fo,TableRender:so},props:ao,emits:["fetch-success","fetch-error","register","edit-cancel","edit-row-end","edit-change","columns-change","select","select-all","selection-change","cell-mouse-enter","cell-mouse-leave","cell-contextmenu","cell-click","cell-dblclick","row-click","row-contextmenu","row-dblclick","header-click","header-contextmenu","sort-change","filter-change","current-change","header-dragend","expand-change"],setup(e,{attrs:t,emit:o,slots:s,expose:a}){const m=A(),f=A([]),u=A(null),l=A(),r=A({page:1,size:Fe}),{prefixCls:b}=_e("basic-table"),[h,p]=an(),g=_(()=>k(k({},e),n(l))),{getLoading:T,setLoading:i}=An(g),{getPaginationInfo:E,getPagination:$,setPagination:N,setShowPagination:G,getShowPagination:Y}=En(g),{getRowSelection:Z,getRowSelectionRef:y,getSelectRows:O,clearSelectedRowKeys:c,getSelectRowKeys:C,deleteSelectRowByKey:D,setSelectedRowKeys:z}=Pn(g,f,o),{getDataSourceRef:H,getDataSource:j,getRawDataSource:x,setTableData:d,updateTableDataRecord:w,deleteTableDataRecord:R,insertTableDataRecord:V,findTableDataRecord:U,fetch:M,getRowKey:J,reload:ge,updateTableData:pe}=Fn(g,{tableData:f,getPaginationInfo:E,setLoading:i,setPagination:N,getFieldsValue:p.getFieldsValue},o),{getViewColumns:q,getColumns:ee,setCacheColumnsByField:me,setColumns:le,getCacheColumns:he}=Rn(g),{getRowClassName:Ee}=Dn(g,b),{getExpandOption:Ce,expandAll:Ae,collapseAll:ye}=Bn(g,f,o),$e={onColumnsChange:B=>{var Q,ve;o("columns-change",B),(ve=(Q=n(g)).onColumnsChange)==null||ve.call(Q,B)}},ze=_(()=>{const{title:B,showTableSetting:Q,titleHelpMessage:ve,tableSetting:wt}=n(g);return!s.tableTitle&&!B&&!s.toolbar&&!Q&&!He(B)?{}:{title:B,tableSetting:wt,showTableSetting:Q,titleHelpMessage:ve,onColumnsChange:$e.onColumnsChange}}),{getFormProps:Ve,replaceFormSlotKey:mt,getFormSlotKeys:ht,handleSearchInfoChange:Ct}=zn(g,s,M,T),Ke=_(()=>{const B=n(H);let Q=k(se(k(k(k({},t),n(g)),n(ze)),{loading:n(T),rowSelection:n(y),rowKey:n(J),columns:we(n(q)),pagination:n(E),data:B}),n(Ce));return Q=Ye(Q,["title"]),Q}),bt=_(()=>{const B=n(Ke);return[b,t.class,{[`${b}-form-container`]:B.useSearchForm,[`${b}--inset`]:B.inset}]}),St=_(()=>{const{emptyDataIsShowTable:B,useSearchForm:Q}=n(g);return B||!Q?!0:!!n(H).length});function yt(B){l.value=k(k({},n(l)),B),setTimeout(()=>{},300)}function vt(){n(m).toggleAllSelection()}be(()=>n(E),B=>{if(!B)return;const{page:Q,size:ve}=n(r);B.page===Q&&B.size===ve||(B.page!==Q||B.size!==ve)&&(r.value={page:B.page,size:B.size})}),be(()=>n(r),B=>{N({page:B.page,size:B.size||Fe})},{deep:!0});const Le={reload:ge,getSelectRows:O,clearSelectedRowKeys:c,getSelectRowKeys:C,deleteSelectRowByKey:D,setPagination:N,setTableData:d,updateTableDataRecord:w,deleteTableDataRecord:R,insertTableDataRecord:V,findTableDataRecord:U,redoHeight:()=>{},setSelectedRows:()=>{},toggleAllSelection:vt,setSelectedRowKeys:z,setColumns:le,setLoading:i,getDataSource:j,getRawDataSource:x,setProps:yt,getRowSelection:Z,getPaginationRef:$,getColumns:ee,getCacheColumns:he,emit:o,updateTableData:pe,setShowPagination:G,getShowPagination:Y,setCacheColumnsByField:me,expandAll:Ae,collapseAll:ye,getSize:()=>n(Ke).size};return On(se(k({},Le),{wrapRef:u,getBindValues:Ke})),a(Le),o("register",Le,p),{prefixCls:b,tablePagination:r,tableElRef:m,getBindValues:Ke,getLoading:T,registerForm:h,handleSearchInfoChange:Ct,getEmptyDataIsShowTable:St,getRowClassName:Ee,wrapRef:u,tableAction:Le,getHeaderProps:ze,getFormProps:Ve,replaceFormSlotKey:mt,getFormSlotKeys:ht,getWrapperClass:bt,columns:q}}});function po(e,t,o,s,a,m){var T;const f=v("BasicForm"),u=v("TableHeader"),l=v("ElTableColumn"),r=v("TableRender"),b=v("EditableCell"),h=v("ElTable"),p=v("ElPagination"),g=We("loading");return S(),X("div",{ref:"wrapRef",class:L(e.getWrapperClass)},[e.getBindValues.useSearchForm?(S(),P(f,re({key:0,submitOnReset:""},e.getFormProps,{tableAction:e.tableAction,onRegister:e.registerForm,onSubmit:e.handleSearchInfoChange}),lt({_:2},[De(e.getFormSlotKeys,i=>({name:e.replaceFormSlotKey(i),fn:F(E=>[Se(e.$slots,i,ke(en(E||{})))])}))]),1040,["tableAction","onRegister","onSubmit"])):W("",!0),e.getHeaderProps?(S(),P(u,ke(re({key:1},e.getHeaderProps)),lt({_:2},[e.$slots.toolbar?{name:"toolbar",fn:F(()=>[Se(e.$slots,"toolbar")])}:void 0,e.$slots.tableTitle?{name:"tableTitle",fn:F(()=>[Se(e.$slots,"tableTitle")])}:void 0,e.$slots.headerTop?{name:"headerTop",fn:F(()=>[Se(e.$slots,"headerTop")])}:void 0]),1040)):W("",!0),Ge((S(),P(h,re({ref:"tableElRef"},e.getBindValues,{rowClassName:e.getRowClassName}),{default:F(()=>[e.getBindValues.showCheckboxColumn?(S(),P(l,{key:0,type:"selection",width:"50"})):W("",!0),e.getBindValues.showIndexColumn?(S(),P(l,{key:1,label:"\u5E8F\u53F7",type:"index",width:"50"})):W("",!0),(S(!0),X(Be,null,De(e.columns,(i,E)=>(S(),X(Be,{key:i.prop},[i.customRender?(S(),P(l,ke(re({key:0},i)),{default:F($=>[K(r,{render:()=>i.customRender&&i.customRender($.row,E,i)},null,8,["render"])]),_:2},1040)):i.isSlot?Se(e.$slots,i.prop,ke(re({key:1},i))):i.edit?(S(),P(l,ke(re({key:2},i)),{default:F($=>[K(b,{column:i,index:$.$index,record:$.row},null,8,["column","index","record"])]),_:2},1040)):(S(),P(l,ke(re({key:3},i)),null,16))],64))),128))]),_:3},16,["rowClassName"])),[[g,e.getBindValues.loading],[ot,e.getEmptyDataIsShowTable]]),((T=e.getBindValues.data)==null?void 0:T.length)?(S(),X("div",{key:2,class:L(`${e.prefixCls}__pagination`)},[e.getBindValues.pagination?(S(),P(p,re({key:0},e.getBindValues.pagination,{currentPage:e.tablePagination.page,"onUpdate:currentPage":t[0]||(t[0]=i=>e.tablePagination.page=i),pageSize:e.tablePagination.size,"onUpdate:pageSize":t[1]||(t[1]=i=>e.tablePagination.size=i)}),null,16,["currentPage","pageSize"])):W("",!0)],2)):W("",!0)],2)}var Ao=oe(go,[["render",po]]);const mo=te({name:"TableAction",components:{Button:hn},props:{actions:{type:Array,default:null},divider:I.bool.def(!0),outside:I.bool,stopButtonPropagation:I.bool.def(!1)},setup(e){const{prefixCls:t}=_e("basic-table-action");let o={};e.outside||(o=Te());const{hasPermission:s}=st();function a(l){const r=l.ifShow;let b=!0;return ce(r)&&(b=r),ne(r)&&(b=r(l)),b}const m=_(()=>(we(e.actions)||[]).filter(r=>s(r.auth)&&a(r)).map(r=>{const b=k({preIcon:r==null?void 0:r.icon,type:"text",size:"small"},r);return Ye(b,["icon"])})),f=_(()=>{var b,h;const r=(((b=o==null?void 0:o.getColumns)==null?void 0:b.call(o))||[]).find(p=>p.flag===Oe);return(h=r==null?void 0:r.align)!=null?h:"left"});function u(l){if(!e.stopButtonPropagation)return;l.composedPath().find(h=>{var p;return((p=h.tagName)==null?void 0:p.toUpperCase())==="BUTTON"})&&l.stopPropagation()}return{prefixCls:t,getActions:m,getAlign:f,onCellClick:u}}});function ho(e,t,o,s,a,m){const f=v("Button");return S(),X("div",{class:L([e.prefixCls,e.getAlign]),onClick:t[0]||(t[0]=(...u)=>e.onCellClick&&e.onCellClick(...u))},[(S(!0),X(Be,null,De(e.getActions,u=>(S(),P(f,ke(re({key:u==null?void 0:u.id},u)),{default:F(()=>[Pe(ue(u.label||""),1)]),_:2},1040))),128))],2)}var Po=oe(mo,[["render",ho]]);te({name:"EditTableHeaderIcon",components:{Edit:nt},props:{title:{type:String,default:""}}});const Co=te({name:"TableImage",components:{ElBadge:tn,ElImage:nn},props:{imgList:I.arrayOf(I.string),fit:I.string.def(""),index:I.number.def(0),size:I.number.def(40),simpleShow:I.bool,showBadge:I.bool.def(!0)},setup(e){const t=_(()=>{const{size:s}=e,a=`${s}px`;return{height:a,width:a}}),{prefixCls:o}=_e("basic-table-img");return{prefixCls:o,getWrapStyle:t}}});function bo(e,t,o,s,a,m){var l;const f=v("ElImage"),u=v("ElBadge");return((l=e.imgList)==null?void 0:l.length)?(S(),X("div",{key:0,class:L([e.prefixCls,{"simple-show":e.simpleShow}]),style:on(e.getWrapStyle)},[e.simpleShow?(S(),P(u,{key:0,value:e.imgList.length},{default:F(()=>[ie("div",{class:L(`${e.prefixCls}__preview`)},[K(f,{width:e.size,fit:e.fit,src:e.imgList[e.index],"preview-src-list":e.imgList},null,8,["width","fit","src","preview-src-list"])],2)]),_:1},8,["value"])):(S(),X("div",{key:1,class:L(`${e.prefixCls}__thumbs`)},[(S(!0),X(Be,null,De(e.imgList,r=>(S(),P(f,{key:r,width:e.size,fit:e.fit,src:r},null,8,["width","fit","src"]))),128))],2))],6)):W("",!0)}var Do=oe(Co,[["render",bo]]);export{Ao as B,Po as T,Do as a};
