import{d as A,r as f,c as F,b as u,cF as w,aC as B,w as E,cf as C,Z as O,_,e as b,o as m,k as S,i as $,f as k,al as R,bw as D,aD as L,aE as T}from"./index.a812ffa9.js";import{c as j,E as I}from"./index.1a2dfbe3.js";const M=A({name:"ApiSelect",components:{ElSelect:j,ElOption:I},inheritAttrs:!1,props:{modelValue:{type:[Array,String,Number],default:""},api:{type:Function,default:null},params:{type:Object,default:()=>({})},resultField:{type:String,default:""},labelField:{type:String,default:"label"},valueField:{type:String,default:"value"},valueToString:{type:Boolean},immediate:{type:Boolean,default:!1}},emits:["option-change","change","update:modelValue"],setup(e,{emit:n}){const o=f([]),r=f(!1),s=f(!0),i=f(),c=F(()=>{const{labelField:t,valueField:l,valueToString:V}=e;return u(o).reduce((h,d)=>{if(d){const v=d[l];h.push({...w(d,[t,l]),label:d[t],value:V?`${v}`:v})}return h},[])}),p=F(()=>u(r)?"\u8BF7\u7B49\u5F85\u6570\u636E\u52A0\u8F7D\u5B8C\u6210...":"\u6570\u636E\u4E3A\u7A7A");B(()=>{i.value=e.modelValue||"",e.immediate&&a()}),E(()=>e.params,()=>{!u(s)&&a()},{deep:!0}),E(()=>u(i),t=>{n("update:modelValue",t),n("change",t)});async function a(){const t=e.api;if(!(!t||typeof t!="function")){o.value=[];try{r.value=!0;const l=await t(e.params);if(Array.isArray(l)){o.value=l,y();return}e.resultField&&(o.value=C(l,e.resultField)||[]),y()}catch(l){}finally{r.value=!1}}}async function g(){!e.immediate&&u(s)&&(await a(),s.value=!1)}function y(){n("option-change",u(c))}return O(()=>{g()}),{innerValueRef:i,getOptions:c,loading:r,getSelectEmpty:p,handleFetch:g}}});function N(e,n,o,r,s,i){const c=b("ElOption"),p=b("ElSelect");return m(),S(p,L({onVisibleChange:e.handleFetch,clearable:""},e.$attrs,{"no-data-text":e.getSelectEmpty,modelValue:e.innerValueRef,"onUpdate:modelValue":n[0]||(n[0]=a=>e.innerValueRef=a)}),{default:$(()=>[(m(!0),k(R,null,D(e.getOptions,a=>(m(),S(c,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},16,["onVisibleChange","no-data-text","modelValue"])}const P=_(M,[["render",N]]),q=T(P);export{q as A};
